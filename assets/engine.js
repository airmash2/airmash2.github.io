(()=>{var e={763:()=>{window.CountryNames={AL:"Albania",DZ:"Algeria",AD:"Andorra",AQ:"Antarctica",AR:"Argentina",AM:"Armenia",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BH:"Bahrain",BD:"Bangladesh",BY:"Belarus",BE:"Belgium",BT:"Bhutan",BO:"Bolivia",BA:"Bosnia and Herzegovina",BR:"Brazil",BG:"Bulgaria",CA:"Canada",CL:"Chile",CN:"China",CO:"Colombia",COMMUNIST:"Communist",CONFEDERATE:"Confederate",CR:"CostaRica",HR:"Croatia",CU:"Cuba",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DO:"Dominican Republic",KP:"DPRK",EC:"Ecuador",EG:"Egypt",SV:"ElSalvador",EE:"Estonia",EU:"European Union",FI:"Finland",FR:"France",GE:"Georgia",DE:"Germany",GR:"Greece",GT:"Guatemala",HN:"Honduras",HK:"HongKong",HU:"Hungary",IS:"Iceland",IMPERIAL:"Imperial Japan",IN:"India",ID:"Indonesia",IR:"Iran",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JOLLY:"Jolly Roger",JO:"Jordan",KZ:"Kazakhstan",KW:"Kuwait",LV:"Latvia",LB:"Lebanon",LY:"Libyan Arab Jamahiriya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia",MY:"Malaysia",MT:"Malta",MX:"Mexico",MD:"Moldova",MC:"Monaco",ME:"Montenegro",MA:"Morocco",NP:"Nepal",NL:"Netherlands",NZ:"New Zealand",NG:"Nigeria",NO:"Norway",OM:"Oman",PK:"Pakistan",PA:"Panama",PY:"Paraguay",PE:"Peru",PH:"Philippines",PL:"Poland",PT:"Portugal",PR:"PuertoRico",QA:"Qatar",RAINBOW:"Rainbow",RO:"Romania",RU:"Russian Federation",SM:"SanMarino",SA:"Saudi Arabia",RS:"Serbia",SG:"Singapore",SK:"Slovakia",SI:"Slovenia",SO:"Somalia",ZA:"South Africa",KR:"South Korea",ES:"Spain",LK:"Sri Lanka",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan",TZ:"Tanzania",TH:"Thailand",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",UN:"United Nations",US:"United States",UY:"Uruguay",UZ:"Uzbekistan",VE:"Venezuela",VN:"Vietnam"},window.FlagCodeById={1:"SY",2:"TH",3:"TM",4:"TN",5:"TR",6:"TT",7:"TW",8:"TZ",9:"UA",10:"UN",11:"US",12:"UY",13:"UZ",14:"VE",15:"VN",16:"PR",17:"PT",18:"PY",19:"QA",20:"RAINBOW",21:"RO",22:"RS",23:"RU",24:"SA",25:"SE",26:"SG",27:"SI",28:"SK",29:"SM",30:"MK",31:"MO",32:"MT",33:"MX",34:"MY",35:"NG",36:"NL",37:"NO",38:"NP",39:"NZ",40:"OM",41:"PA",42:"PE",43:"JP",44:"KP",45:"KR",46:"KW",47:"KZ",48:"LB",49:"LI",50:"LK",51:"LT",52:"LU",53:"LV",54:"HN",55:"HR",56:"HU",57:"ID",58:"IE",59:"IL",60:"IM",61:"IMPERIAL",62:"IN",63:"IQ",64:"DE",65:"DK",66:"DO",67:"DZ",68:"EC",69:"EE",70:"EG",71:"ES",72:"EU",73:"BH",74:"BO",75:"BR",76:"BT",77:"BY",78:"CA",79:"CH",80:"AD",81:"AE",82:"AL",83:"AM",84:"CL",85:"AQ",86:"CN",87:"AR",88:"FI",89:"CO",90:"AT",91:"IR",92:"FR",93:"COMMUNIST",94:"AU",95:"LY",96:"IS",97:"GB",98:"CONFEDERATE",99:"AZ",100:"MA",101:"IT",102:"GE",103:"CR",104:"BA",105:"PH",106:"MC",107:"JM",108:"GR",109:"CU",110:"BD",111:"SO",112:"PK",113:"MD",114:"JO",115:"GT",116:"CY",117:"BE",118:"ZA",119:"SV",120:"PL",121:"ME",122:"JOLLY",123:"HK",124:"CZ",125:"BG"},window.GameType={FFA:1,CTF:2,BTR:3},window.PlaneType={Predator:1,Goliath:2,Mohawk:3,Tornado:4,Prowler:5},window.MobType={PredatorMissile:1,GoliathMissile:2,MohawkMissile:3,Upgrade:4,TornadoSingleMissile:5,TornadoTripleMissile:6,ProwlerMissile:7,Shield:8,Inferno:9,CarrotMissile:12,MagicCrate:13},window.MissileMobTypeSet={[MobType.PredatorMissile]:!0,[MobType.GoliathMissile]:!0,[MobType.MohawkMissile]:!0,[MobType.TornadoSingleMissile]:!0,[MobType.TornadoTripleMissile]:!0,[MobType.ProwlerMissile]:!0,[MobType.CarrotMissile]:!0},window.CrateMobTypeSet={[MobType.Upgrade]:!0,[MobType.Shield]:!0,[MobType.Inferno]:!0,[MobType.MagicCrate]:!0},window.MobDespawnType={LifetimeEnded:0,Collided:1},window.CrateTextureNameByMobType={[MobType.Upgrade]:"crateUpgrade",[MobType.Shield]:"crateShield",[MobType.Inferno]:"crateRampage",[MobType.MagicCrate]:"crateMagic"}},298:()=>{window.DEVELOPMENT=/^http:\/\/127\.0\.0\.1:[0-9]{1,5}\/?$/.test(window.origin)||new URLSearchParams(window.location.search).has("dev"),window.game={protocol:5,version:"2.0.8",state:0,focus:!0,screenX:0,screenY:0,halfScreenX:0,halfScreenY:0,scale:1,spectatingID:null,myID:null,myType:null,myTeam:null,myUserID:"",myName:"",myOriginalName:"",myScore:0,myPlace:0,myLevel:0,myToken:"",myFlag:"xx",loggedIn:!1,roomName:"",roomNameShort:"",regionName:"",playRegion:"dev",playRoom:"ffa",playHost:"",playPath:"",playInvited:!1,gameType:null,inviteLink:"",lastFlagSet:"xx",reloading:!1,ping:0,lagging:!1,timeFactor:1,timeFactorUncapped:1,time:0,timeNetwork:0,jitter:0,frames:0,shadowX:0,shadowY:0,graphics:{},debug:{},buckets:[],customServerUrl:null,backendHost:"data.airmash.online",server:{}},window.config={skins:{MAX_URL_LENGTH:60,MAX_IMG_BYTES:{512:25e3,256:18e3,128:12e3}},airmashRefugees:{fontSizeMul:1,unicodeWorkaround:!1},settings:{},auth:{},ships:[{},{name:"raptor",turnFactor:.065,accelFactor:.225,maxSpeed:5.5,minSpeed:.001,brakeFactor:.025,energyLight:.6,collisions:[[0,5,23],[0,-15,15],[0,-25,12]]},{name:"spirit",turnFactor:.04,accelFactor:.15,maxSpeed:3.5,minSpeed:.001,brakeFactor:.015,energyLight:.9,collisions:[[0,0,35],[50,14,16],[74,26,14],[30,8,23],[63,22,15],[-50,14,16],[-74,26,14],[-30,8,23],[-63,22,15]]},{name:"mohawk",turnFactor:.07,accelFactor:.275,maxSpeed:6,minSpeed:.001,brakeFactor:.025,energyLight:.3,collisions:[[0,-12,15],[0,0,17],[0,13,15],[0,26,15]]},{name:"tornado",turnFactor:.055,accelFactor:.2,maxSpeed:4.5,minSpeed:.001,brakeFactor:.025,energyLight:.5,collisions:[[0,8,18],[14,12,13],[-14,12,13],[0,-12,16],[0,-26,14],[0,-35,12]]},{name:"prowler",turnFactor:.055,accelFactor:.2,maxSpeed:4.5,minSpeed:.001,brakeFactor:.025,energyLight:.75,collisions:[[0,11,25],[0,-8,18],[19,20,10],[-19,20,10],[0,-20,14]]}],mobs:[{},{exhaust:20,thruster:[.2,.4]},{exhaust:30,thruster:[.3,.6]},{exhaust:18,thruster:[.14,.3]},{},{exhaust:20,thruster:[.2,.4]},{exhaust:20,thruster:[.2,.4]},{exhaust:20,thruster:[.2,.4]},{},{},{},{},{exhaust:18,thruster:[.15,.3],thrusterGlowAlpha:.5,smokeGlowAlpha:.5,thrusterAlpha:.5}],upgrades:{speed:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},defense:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},energy:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]},missile:{cost:[0,1,1,1,1,1],factor:[1,1.05,1.1,1.15,1.2,1.25]}},doodads:[[1009,-2308,1,.9,.2,null,null],[1241,-2490,4,.5,-.2,null,null],[1157,-2379,2,.7,-.1,null,null],[622,-2126,3,.4,null,null,null],[669,-2187,2,.6,null,null,null],[-392,-1669,1,1.1,.1,null,null],[-273,-1746,4,.5,-.1,null,null],[-252,-1504,2,1,null,null,null],[1553,-2016,2,.4,.2,null,null],[1637,-1972,1,.5,.1,null,null],[1736,-1922,2,.5,.7,null,null],[2150,-2406,2,.6,null,null,null],[2238,-2318,3,.9,null,null,null],[2364,-2391,4,.6,0,null,null],[2491,-2682,1,.6,-.1,null,null],[2596,-2671,2,.9,.2,null,null],[-150,-3147,4,.4,-.4,null,null],[-155,-3044,2,.7,0,null,null],[-427,-3600,2,.4,null,null,null],[-259,-2982,2,.5,null,null,null],[-379,-3529,1,.6,.1,1,null],[-665,-3052,2,.5,null,null,null],[20,-1816,4,.5,.3,null,null],[127,-1799,1,.5,null,null,null],[263,-2572,3,.4,.4,null,null],[405,-2570,1,.9,-.2,null,null],[851,-4183,1,1,null,null,null],[754,-3971,2,.9,-.1,1,null],[1757,-5065,4,1.1,null,null,null],[1169,-4453,3,.9,null,null,null],[2054,-5244,3,.9,null,null,null],[1631,-4901,1,.9,0,null,null],[2305,-5281,2,.9,.2,1,null],[1007,-4281,1,.8,.1,null,null],[2766,-5202,1,.8,.1,1,null],[2927,-5204,2,.7,null,1,null],[3206,-5218,2,.3,.6,1,null],[3099,-5193,4,.6,.1,1,null],[1417,-4726,2,1,null,null,null],[2844,-1513,4,.5,.1,null,null],[3206,-1464,1,1,.1,1,null],[2881,-1403,2,.9,null,null,null],[3804,-2025,1,.7,-.1,null,null],[4116,-1778,2,.9,-.3,null,null],[3715,-1508,3,.6,.1,null,null],[4247,-1126,1,.6,.1,1,null],[3860,268,1,.5,.5,1,null],[4334,-1011,2,1.1,-.1,null,null],[3849,349,3,.6,null,null,null],[3956,490,4,.8,-.4,null,null],[4073,667,2,.9,-.5,null,null],[3583,-864,4,.8,.1,.8,15723705],[4135,836,2,1,-.2,null,null],[4785,-743,2,1,.1,null,null],[4993,-839,1,.9,.3,1,null],[5224,-482,3,.7,null,null,null],[5235,-1238,4,1.1,null,1,null],[5419,-1346,2,.6,-.5,.8,null],[6075,-5099,1,.8,null,null,null],[5767,-4953,2,.9,-.3,1,null],[5896,-4967,2,.9,.1,1,null],[5384,-4642,4,.9,null,null,null],[5704,-4857,4,.9,null,null,null],[5563,-4697,2,.9,null,null,null],[5406,-4470,1,1.1,null,null,null],[5352,-3964,3,.9,null,null,null],[5309,-3665,1,1.1,null,null,null],[5247,-3464,4,.9,-.5,null,null],[5300,-3121,1,.9,null,null,null],[3524,-3340,1,1.1,0,null,null],[3661,-3589,2,.9,-.7,null,null],[7236,-1376,2,.6,-.3,null,null],[7624,-1610,2,.8,null,null,null],[7403,-1555,2,.7,null,null,null],[7514,-1568,2,.9,0,null,null],[3660,-2705,1,.9,.2,null,null],[3374,-2813,2,.8,null,null,null],[7347,-1447,1,.9,.1,null,null],[7236,-775,4,.5,-.9,null,null],[7207,-631,2,.9,0,null,null],[7303,-468,1,.9,-.3,null,null],[7262,-1263,4,.9,-.6,null,null],[7404,-350,2,1,.6,null,null],[7589,-305,3,.9,.6,null,null],[7741,-1589,4,1,.2,null,null],[7949,-1594,1,1,-.2,null,null],[8152,-1599,2,1.1,.1,null,null],[8378,-1602,4,1.2,0,null,null],[7873,-321,2,.6,.3,null,null],[8543,-1661,1,.7,0,null,null],[7790,-259,1,1,.1,null,null],[8675,-1573,2,1,.1,null,null],[8163,-245,2,.7,.3,null,null],[8329,-311,2,.7,.5,null,null],[8275,-229,1,1,.1,null,null],[8447,-277,3,1,0,null,null],[8824,-1447,1,.9,-.4,null,null],[7221,-1140,1,.5,-.2,null,null],[8924,-1273,2,.9,-.5,null,null],[6844,-950,3,1,.1,null,null],[8949,-1060,3,1.1,-.3,null,null],[8904,-920,4,.8,-.7,null,null],[8582,-338,2,.7,null,null,null],[8963,-803,1,1,-.4,null,null],[8680,-322,4,.9,0,null,null],[8811,-449,1,.9,-.3,null,null],[8910,-610,2,.9,-.4,null,null],[6855,114,1,.8,null,null,null],[6971,241,2,1,-.1,null,null],[6852,656,2,.5,.3,null,null],[6980,706,1,.9,-.4,null,null],[6946,939,4,1,-.2,null,null],[6027,-560,1,.6,0,null,null],[7521,425,2,.4,.1,null,null],[7599,389,1,.5,-.5,null,null],[5863,-431,2,.9,.1,null,null],[9392,262,2,.9,-.1,null,null],[7521,512,3,.6,null,null,null],[9807,1027,1,.5,-.1,null,null],[9554,237,1,1,-.2,1,null],[9346,392,4,1.2,-.3,null,null],[9789,1142,3,.7,null,null,null],[9747,-532,4,.8,.2,1,null],[8591,347,4,.6,-.2,null,null],[9951,-509,1,1,null,null,null],[9308,2417,1,.5,.1,null,null],[10185,-522,2,.9,null,1,null],[10330,2147,1,.6,0,null,null],[9350,2480,3,.7,null,null,null],[10503,2124,2,.9,null,null,null],[12500,2628,4,.5,.3,null,null],[13188,2864,4,.5,-.1,null,null],[12637,2659,2,.7,.1,null,null],[13262,2899,1,.5,null,null,null],[13777,5168,1,.5,-.3,null,null],[15709,6399,1,.4,null,null,null],[13539,5664,3,.5,null,1,null],[15660,6474,2,.4,-.3,null,null],[13743,5248,2,.7,-.1,null,null],[15482,6600,2,.4,-.1,null,null],[15591,6525,4,.3,null,null,null],[13487,5738,4,.7,null,null,null],[15407,6702,1,.6,.1,null,null],[8171,-2568,2,.5,.1,null,null],[16001,6015,3,.6,null,null,null],[16017,6110,1,.4,null,1,null],[6496,-1491,1,.5,.3,null,null],[6626,-1480,2,.7,null,null,null],[6190,-1022,4,.8,null,null,null],[8325,-2615,2,1,-.3,null,null],[8222,-2412,4,1,null,null,null],[9204,-2288,1,.9,-.1,null,null],[9279,-2216,2,1,null,null,null],[10375,-1558,2,.8,-.3,null,null],[10309,-1421,1,.9,null,null,null],[10247,-1216,4,1.2,-.5,null,null],[10079,-2310,4,.9,.3,null,null],[10320,-2330,3,1,null,null,null],[10942,-2963,2,.9,-.3,null,null],[10807,-2778,4,1.1,-.5,null,null],[12989,-1929,3,.6,null,null,null],[12613,-1181,1,.4,0,1,null],[12559,-1120,2,.5,null,null,null],[11642,-1900,4,.7,-.5,null,null],[11558,-1692,1,.9,-.2,null,null],[11509,-1479,2,.5,null,null,null],[12559,-2673,1,.8,null,null,null],[12446,-2487,4,1,-.5,null,null],[12375,-2303,3,.9,-.2,null,null],[10363,-3514,4,.7,-.4,null,null],[10290,-3340,1,.9,-.2,null,null],[10162,-3207,2,.7,null,null,null],[9003,-3048,4,.9,-.1,null,null],[9161,-3119,1,.6,null,null,null],[14550,-3462,2,.9,-.2,null,null],[14407,-3335,4,.9,-.2,null,null],[14366,-4493,2,.9,.5,null,null],[14477,-4437,3,1,null,null,null],[15305,-4230,4,.9,.1,null,null],[15481,-4283,2,.9,null,null,null],[15349,-5009,4,.4,.3,null,null],[11874,-4879,2,.6,null,null,null],[15453,-4984,1,.7,null,null,null],[11907,-4742,4,.8,-.6,null,null],[12440,-4278,4,.5,.3,null,null],[11980,-4582,2,.9,null,null,null],[12131,-4387,1,1.1,null,null,null],[15681,-4973,4,1,null,null,null],[12591,-4252,1,.8,null,null,null],[12777,-4244,2,.9,.2,null,null],[12969,-4227,3,.9,null,null,null],[15897,-5071,2,.9,-.2,null,null],[13204,-4228,4,1,null,null,null],[11592,-5261,1,.7,.2,null,null],[12743,-4826,1,.4,.3,null,null],[10102,-5078,2,.7,.4,null,null],[12854,-4782,3,.9,.1,null,null],[10191,-5033,1,.7,null,null,null],[10523,-5133,2,1,null,null,null],[10336,-4977,4,1.1,-.3,null,null],[10667,-5250,2,.8,-.1,null,null],[9665,-6403,4,.7,.3,null,null],[10798,-5379,1,.5,null,null,null],[9670,-5547,1,.9,-.1,null,null],[9834,-6369,3,1,null,null,null],[9864,-5572,2,1.1,-.1,null,null],[11362,-3957,2,.9,null,1,null],[11162,-3830,4,1,-.1,null,null],[8922,-6173,4,1,null,null,null],[9003,-5368,1,.5,null,null,null],[8453,-6153,1,.6,.2,null,null],[8954,-5229,3,.9,-.2,null,null],[8905,-5072,1,.8,-.3,null,null],[8704,-3873,3,.9,null,null,null],[8578,-6105,2,.8,.4,null,null],[8508,-3710,1,.7,0,null,null],[8614,-5400,4,.5,null,null,null],[8788,-4922,4,1.1,null,null,null],[8936,-3905,4,.6,.3,null,null],[9701,-4613,4,.9,-.1,null,null],[6973,-4776,2,.6,null,null,null],[7016,-4674,1,.9,null,null,null],[9124,-3853,1,.9,.2,null,null],[7253,-4648,4,.8,.2,null,null],[6602,-4591,1,.6,.2,null,null],[8510,-5322,2,.9,null,null,null],[6687,-3810,4,.7,.3,null,null],[9525,-4492,3,1.1,null,null,null],[7461,-4705,2,.9,null,null,null],[9280,-3812,2,.8,-.3,null,null],[6467,-2811,1,.3,null,null,null],[6842,-3820,1,.8,.3,null,null],[6483,-2725,4,.6,.3,null,null],[7675,-4864,1,1.1,null,null,null],[6991,-2885,4,.9,.2,null,null],[6610,-2664,4,.9,null,null,null],[6822,-2736,2,.9,null,null,null],[6763,-4582,3,.9,null,null,null],[6509,-2490,2,.9,-.3,null,null],[7216,-3865,4,1.1,.2,1,null],[7018,-3708,2,1,.2,null,null],[2254,-3301,1,.8,.5,null,null],[6378,-2310,1,.8,.2,null,null],[7197,-2857,2,.9,null,null,null],[2609,-3483,4,.5,null,null,null],[2449,-3385,2,.9,.3,1,null],[4585,-2889,4,.7,-.2,null,null],[4470,-2768,3,.8,.2,null,null],[4083,-4033,1,.9,.5,1,null],[1568,-2869,1,.4,null,null,null],[4336,-4105,2,1.2,null,null,null],[1977,-1678,2,.5,null,null,null],[1412,-3642,1,.5,0,1,null],[1570,-2792,4,.6,null,null,null],[1932,-1586,1,.6,null,null,null],[1310,-3547,2,.6,0,null,null],[3611,1391,2,1,null,null,null],[3558,2174,2,.9,null,null,null],[3431,1563,1,.9,.3,null,null],[3142,2813,2,.7,null,null,null],[3330,2296,4,1.1,null,null,null],[3001,2818,1,.6,.3,null,null],[3703,2044,1,.4,null,null,null],[2872,3863,1,.9,-.2,null,null],[3125,2942,3,1.1,null,null,null],[2841,4018,4,1.1,.1,null,null],[2402,5140,4,.6,.3,null,null],[2511,5167,3,.8,null,null,null],[-14607,-5112,4,.9,.1,null,null],[-14430,-5180,1,.9,0,null,null],[-14197,-5222,2,1.2,-.1,null,null],[-14895,-4703,4,.5,.2,null,null],[-14797,-4728,2,.4,null,null,null],[-14697,-4739,1,.4,null,null,null],[-13919,-5281,1,1.1,0,null,null],[-13646,-5170,3,.7,null,null,null],[-13400,-5068,2,1.2,.2,null,null],[-13099,-5108,4,1.1,.2,null,null],[-12824,-5092,1,.9,null,null,null],[-12631,-5044,2,.9,-.2,null,null],[-12427,-4914,1,.9,null,null,null],[-12270,-4816,2,.7,-.3,null,null],[-11772,-4983,2,.7,0,null,null],[-11940,-4867,1,.9,null,null,null],[-12091,-4699,3,.9,null,null,null],[-12270,-4529,4,.7,null,null,null],[-12460,-4396,1,.9,.4,null,null],[-13058,-4252,1,.9,null,null,null],[-12894,-4096,4,.7,.2,null,null],[-12738,-4077,2,.7,null,null,null],[-13546,-4341,1,.4,null,null,null],[-13428,-4299,3,.9,null,null,null],[-14679,-4192,1,.7,-.1,null,null],[-14368,-4308,4,.7,-.2,null,null],[-14495,-4133,2,1.1,-.1,null,null],[-12072,-3824,2,.8,-.1,null,null],[-11904,-3648,1,1,0,null,null],[-11654,-3569,3,.7,null,null,null],[-11648,-3357,4,.9,0,null,null],[-11420,-3359,1,.9,null,null,null],[-11296,-3135,2,.7,null,null,null],[-10782,-2838,1,.8,-.1,null,null],[-11410,-3039,1,.3,.6,null,null],[-10581,-2773,2,1.1,.1,null,null],[-11118,-5114,4,.8,.2,null,null],[-10675,-5079,1,.9,null,null,null],[-10205,-4890,1,.8,.1,null,null],[-11543,-4164,4,.8,.3,null,null],[-11287,-4244,2,.5,null,null,null],[-10018,-4747,2,1,-.2,null,null],[-9278,419,3,.5,null,null,null],[-9341,470,4,.5,.3,null,null],[-9180,496,1,.8,.6,null,null],[-11365,-4131,3,1,null,null,null],[-9353,0,3,.6,.3,null,null],[-8975,528,2,1,.1,null,null],[-9413,89,4,.9,null,null,null],[-8230,770,1,.4,null,null,null],[-9231,17,1,.7,0,null,null],[-6808,1667,3,.5,-.2,null,null],[-6694,1622,2,.8,-.4,null,null],[-8285,855,3,.6,null,null,null],[-6793,1796,2,.8,.4,null,null],[-6865,1935,1,.5,-.1,null,null],[-7043,2222,3,.6,-.2,null,null],[-7083,2368,1,.6,-.2,null,null],[-7103,2533,4,.7,-.4,null,null],[-7099,2721,2,.8,-.3,null,null],[-7178,2874,1,.4,null,null,null],[-6964,3110,4,.7,.2,null,null],[-6246,4191,1,.6,-.1,null,null],[-6735,3446,1,.4,.1,null,null],[-6722,3537,4,.7,.4,null,null],[-6396,3388,4,.9,null,null,null],[-6787,3140,2,.9,null,null,null],[-6227,4488,2,.7,-.5,null,null],[-6281,3953,1,.6,.2,null,null],[-6530,3576,1,1.1,null,null,null],[-6147,3994,3,1.1,null,null,null],[-6141,4292,2,1.2,-.3,null,null],[-6377,5578,2,.7,-.5,null,null],[-6152,4569,1,.9,-.2,null,null],[-6222,4769,4,.7,-.5,null,null],[-6266,4956,1,.6,-.2,null,null],[-6233,5414,1,.9,-.4,null,null],[-6347,5646,3,.7,-.1,1,null],[-6400,6066,2,.7,-.2,null,null],[-6411,6261,1,.8,null,null,null],[-6565,7043,1,.6,-.3,null,null],[-6377,6415,4,.9,-.3,null,null],[-6440,6614,1,.7,-.2,null,null],[-5944,1954,3,.5,-.4,null,null],[-6001,2039,1,.8,.2,null,null],[-6467,7070,3,.9,null,null,null],[-4963,3608,1,.6,-.3,1,null],[-4776,3510,2,.4,-.1,1,null],[-5785,1998,2,1.1,-.2,null,null],[-3708,3449,1,.6,-.3,null,null],[-3790,3582,1,.9,null,null,null],[-4031,3697,4,.7,-.1,null,null],[-4859,3634,3,1,null,null,null],[-3850,3730,2,1,.2,null,null],[-4689,4605,4,.9,-.2,null,null],[-3492,2892,1,.6,-.2,null,null],[-4507,4483,1,.6,null,null,null],[-4829,2745,1,.9,-.2,null,null],[-4435,4273,2,.9,-.6,null,null],[-3383,2930,2,.9,null,null,null],[-4888,2821,2,.9,.1,null,null],[-5372,5172,1,.5,null,null,null],[-5036,2981,4,.9,.3,null,null],[-9895,-1942,1,1,.1,null,null],[-9371,-2159,4,.6,null,null,null],[-9995,-1773,4,.9,-.5,null,null],[-5280,5218,4,.9,0,null,null],[-5079,5183,1,.9,-.3,null,null],[-5149,3079,1,.6,.2,null,null],[-9695,-2048,2,1,-.1,null,null],[-5063,5374,2,.9,-.2,null,null],[-9504,-2059,1,1,.2,null,null],[-8948,-2140,4,.7,.3,null,null],[-9262,-2081,2,1.1,.4,null,null],[-9068,-2071,4,1,.2,null,null],[-8861,-2045,2,1.1,0,null,null],[-8654,-2083,1,1,.3,null,null],[-8473,-2048,3,1,0,null,null],[-8283,-1965,1,1,.5,null,null],[-8182,-1863,2,.9,-.2,null,null],[-10037,-1579,1,.9,-.4,null,null],[-10063,-1365,2,.9,-.1,null,null],[-10074,-1190,1,.9,-.4,null,null],[-8167,-1225,1,.5,-.7,null,null],[-8188,-1087,4,.8,-.5,null,null],[-9975,-1022,1,.9,.3,null,null],[-9835,-910,2,1,.1,null,null],[-9709,-848,4,1,.3,null,null],[-9532,-792,2,1,.1,null,null],[-9348,-779,1,1,0,null,null],[-9131,-784,2,1.1,.1,null,null],[-8754,-795,3,.7,null,null,null],[-8587,-797,4,1,0,null,null],[-8424,-856,1,.9,null,null,null],[-8246,-921,2,.9,-.4,null,null],[-8153,-1701,4,.7,-.7,null,null],[-6447,-2137,1,.6,-.2,null,null],[-8153,-1591,1,.5,-.6,null,null],[-7694,-1393,4,1,-.1,null,null],[-6541,-2030,2,.7,null,null,null],[-7135,-1547,2,.7,.1,null,null],[-5885,-2958,1,.6,.3,null,null],[-7171,-1440,1,.8,-.2,null,null],[-5620,-3123,2,.6,-.4,null,null],[-6631,-1866,4,.8,null,null,null],[-5882,-3696,2,.8,-.4,null,null],[-5716,-2944,3,.9,null,null,null],[-5949,-3528,1,.5,-.1,null,null],[-6869,-4052,4,.8,null,null,null],[-7081,-2673,3,.5,null,null,null],[-6725,-4069,1,.6,-.2,null,null],[-10487,-2295,2,.5,.1,1,null],[-7032,-2749,2,.6,-.4,null,null],[-10769,-3817,3,.6,-.2,null,null],[-6607,-4081,2,.5,null,null,null],[-10849,-1824,1,.7,.1,null,null],[-10479,-2146,4,.9,-.1,null,null],[-7003,-2611,4,.9,-.2,null,null],[-10749,-1511,2,.6,-.4,null,null],[-10697,-1953,2,1,.1,null,null],[-10848,-1330,3,.9,null,null,null],[-10912,-1220,4,.5,0,null,null],[-9843,-2685,4,.7,null,null,null],[-10823,-3717,2,.7,null,null,null],[-9697,-2713,1,.6,.3,null,null],[-10080,-3431,2,.4,null,null,null],[-10648,-3844,1,.9,null,null,null],[-9530,-2695,2,1,null,null,null],[-2387,-6791,1,.9,null,null,null],[-8465,-5037,2,.7,null,null,null],[-2550,-6627,2,.9,-.1,null,null],[-9325,-2822,1,.7,-.1,null,null],[-10140,-3346,1,.8,null,null,null],[-8461,-4908,4,.9,null,null,null],[8116,-1076,2,.8,-.3,null,null],[8115,-940,4,.8,-.3,null,null],[-2503,-6359,4,1.4,-.6,null,null],[-9062,-1580,2,.8,-.5,null,null],[8120,-790,1,.8,null,null,null],[-9065,-1444,4,.8,-.3,null,null],[-2615,-6159,1,1,null,null,null],[-2744,-5943,2,1.1,null,null,null],[-3713,-4955,3,.9,null,null,null],[-9061,-1292,1,.8,0,null,null],[-1551,-4718,4,.5,null,null,null],[5251,-6249,1,.5,null,1,null],[5192,-6181,2,.4,-.1,null,null],[-2898,-5732,3,.9,null,null,null],[-1705,-4629,3,.8,null,null,null],[1618,-7035,1,.5,null,null,null],[-3829,-4776,4,.9,null,null,null],[-2851,-5589,4,1.1,-.2,null,null],[-2974,-5399,2,1.1,null,null,null],[-3952,-4568,1,.9,null,null,null],[-4135,-4368,2,1.1,.1,1,null],[-3428,-5104,1,1.1,null,null,null],[-3167,-5254,4,.9,.1,null,null],[-3049,-6916,2,1,null,null,null],[-3097,-6722,1,.9,-.3,null,null],[-3190,-6493,3,1,null,null,null],[-3318,-6284,4,1.1,null,null,null],[-4672,-5861,1,1.1,1,null,null],[-4480,-5668,1,1,null,null,null],[-4294,-5548,2,.9,1.1,null,null],[-3433,-6072,1,1,-.2,null,null],[-3568,-5881,3,1,null,null,null],[-3736,-5698,2,1.2,null,null,null],[-3978,-7517,3,.9,.1,null,null],[-3956,-5572,4,1,null,null,null],[-4103,-5400,1,1,null,null,null],[-4281,-5240,2,1,null,null,null],[-4409,-5034,3,1,null,null,null],[-4475,-4808,4,.9,null,null,null],[-2777,-7546,3,1,.8,null,null],[-2542,-7502,2,.9,.4,null,null],[-2398,-7364,1,.9,-.7,null,null],[-2350,-7151,2,.9,-.4,null,null],[-2315,-6976,4,.8,-.8,null,null],[-3749,-7488,4,1,null,null,null],[-2995,-7596,2,1.2,.5,null,null],[-3253,-7558,3,1.1,.3,null,null],[-3468,-7472,4,1,null,null,null],[-5028,-6473,2,1,.4,null,null],[-3604,-7301,1,1.1,null,null,null],[-3678,-7078,2,1.1,null,null,null],[-3835,-6826,3,1.1,null,null,null],[-3935,-6595,2,1,null,null,null],[-5214,-7381,3,1,null,null,null],[-4065,-6416,3,1.1,null,null,null],[-4174,-6231,4,.7,null,null,null],[-4556,-6940,3,1,null,null,null],[-4663,-6781,4,1,null,null,null],[-4748,-6548,2,1.3,null,null,null],[-4847,-6257,2,1.1,-.4,null,null],[-4806,-6016,4,.9,1.2,null,null],[-4950,-7410,1,1.4,.2,null,null],[-5470,-7251,4,1.3,-.2,null,null],[-5637,-7038,2,1,-.3,null,null],[-5593,-6819,4,1,null,null,null],[-5406,-6727,3,1,.6,null,null],[-5263,-6580,1,1,.4,null,null],[-4636,-7476,2,1,.2,null,null],[-4399,-7496,2,.9,-.2,null,null],[-6769,-7571,2,.9,-.4,null,null],[-6853,-7377,1,.9,null,null,null],[-8273,-7231,4,.5,.4,null,null],[-4182,-7512,4,.9,.1,null,null],[-7525,-5855,2,.9,null,null,null],[-7495,-6329,3,.5,null,null,null],[-7297,-6946,2,.9,null,null,null],[-8148,-7137,1,.7,null,null,null],[-7030,-7301,4,.7,null,null,null]],walls:[[1009,-2308,108],[1241,-2490,60],[1157,-2379,84],[622,-2126,48],[669,-2187,72],[-392,-1669,132],[-273,-1746,60],[-252,-1504,120],[1553,-2016,48],[1637,-1972,60],[1736,-1922,60],[2150,-2406,72],[2238,-2318,108],[2364,-2391,72],[2491,-2682,72],[2596,-2671,108],[-150,-3147,48],[-155,-3044,84],[-427,-3600,48],[-259,-2982,60],[-379,-3529,72],[-665,-3052,60],[20,-1816,60],[127,-1799,60],[263,-2572,48],[405,-2570,108],[851,-4183,120],[754,-3971,108],[1757,-5065,132],[1169,-4453,108],[2054,-5244,108],[1631,-4901,108],[2305,-5281,108],[1007,-4281,96],[2766,-5202,96],[2927,-5204,84],[3206,-5218,36],[3099,-5193,72],[1417,-4726,120],[2844,-1513,60],[3206,-1464,120],[2881,-1403,108],[3804,-2025,84],[4116,-1778,108],[3715,-1508,72],[4247,-1126,72],[3860,268,60],[4334,-1011,132],[3849,349,72],[3956,490,96],[4073,667,108],[3583,-864,96],[4135,836,120],[4785,-743,120],[4993,-839,108],[5224,-482,84],[5235,-1238,132],[5419,-1346,72],[6075,-5099,96],[5767,-4953,108],[5896,-4967,108],[5384,-4642,108],[5704,-4857,108],[5563,-4697,108],[5406,-4470,132],[5352,-3964,108],[5309,-3665,132],[5247,-3464,108],[5300,-3121,108],[3524,-3340,132],[3661,-3589,108],[7236,-1376,72],[7624,-1610,96],[7403,-1555,84],[7514,-1568,108],[3660,-2705,108],[3374,-2813,96],[7347,-1447,108],[7236,-775,60],[7207,-631,108],[7303,-468,108],[7262,-1263,108],[7404,-350,120],[7589,-305,108],[7741,-1589,120],[7949,-1594,120],[8152,-1599,132],[8378,-1602,144],[7873,-321,72],[8543,-1661,84],[7790,-259,120],[8675,-1573,120],[8163,-245,84],[8329,-311,84],[8275,-229,120],[8447,-277,120],[8824,-1447,108],[7221,-1140,60],[8924,-1273,108],[6844,-950,120],[8949,-1060,132],[8904,-920,96],[8582,-338,84],[8963,-803,120],[8680,-322,108],[8811,-449,108],[8910,-610,108],[6855,114,96],[6971,241,120],[6852,656,60],[6980,706,108],[6946,939,120],[6027,-560,72],[7521,425,48],[7599,389,60],[5863,-431,108],[9392,262,108],[7521,512,72],[9807,1027,60],[9554,237,120],[9346,392,144],[9789,1142,84],[9747,-532,96],[8591,347,72],[9951,-509,120],[9308,2417,60],[10185,-522,108],[10330,2147,72],[9350,2480,84],[10503,2124,108],[12500,2628,60],[13188,2864,60],[12637,2659,84],[13262,2899,60],[13777,5168,60],[15709,6399,48],[13539,5664,60],[15660,6474,48],[13743,5248,84],[15482,6600,48],[15591,6525,36],[13487,5738,84],[15407,6702,72],[8171,-2568,60],[16001,6015,72],[16017,6110,48],[6496,-1491,60],[6626,-1480,84],[6190,-1022,96],[8325,-2615,120],[8222,-2412,120],[9204,-2288,108],[9279,-2216,120],[10375,-1558,96],[10309,-1421,108],[10247,-1216,144],[10079,-2310,108],[10320,-2330,120],[10942,-2963,108],[10807,-2778,132],[12989,-1929,72],[12613,-1181,48],[12559,-1120,60],[11642,-1900,84],[11558,-1692,108],[11509,-1479,60],[12559,-2673,96],[12446,-2487,120],[12375,-2303,108],[10363,-3514,84],[10290,-3340,108],[10162,-3207,84],[9003,-3048,108],[9161,-3119,72],[14550,-3462,108],[14407,-3335,108],[14366,-4493,108],[14477,-4437,120],[15305,-4230,108],[15481,-4283,108],[15349,-5009,48],[11874,-4879,72],[15453,-4984,84],[11907,-4742,96],[12440,-4278,60],[11980,-4582,108],[12131,-4387,132],[15681,-4973,120],[12591,-4252,96],[12777,-4244,108],[12969,-4227,108],[15897,-5071,108],[13204,-4228,120],[11592,-5261,84],[12743,-4826,48],[10102,-5078,84],[12854,-4782,108],[10191,-5033,84],[10523,-5133,120],[10336,-4977,132],[10667,-5250,96],[9665,-6403,84],[10798,-5379,60],[9670,-5547,108],[9834,-6369,120],[9864,-5572,132],[11362,-3957,108],[11162,-3830,120],[8922,-6173,120],[9003,-5368,60],[8453,-6153,72],[8954,-5229,108],[8905,-5072,96],[8704,-3873,108],[8578,-6105,96],[8508,-3710,84],[8614,-5400,60],[8788,-4922,132],[8936,-3905,72],[9701,-4613,108],[6973,-4776,72],[7016,-4674,108],[9124,-3853,108],[7253,-4648,96],[6602,-4591,72],[8510,-5322,108],[6687,-3810,84],[9525,-4492,132],[7461,-4705,108],[9280,-3812,96],[6467,-2811,36],[6842,-3820,96],[6483,-2725,72],[7675,-4864,132],[6991,-2885,108],[6610,-2664,108],[6822,-2736,108],[6763,-4582,108],[6509,-2490,108],[7216,-3865,132],[7018,-3708,120],[2254,-3301,96],[6378,-2310,96],[7197,-2857,108],[2609,-3483,60],[2449,-3385,108],[4585,-2889,84],[4470,-2768,96],[4083,-4033,108],[1568,-2869,48],[4336,-4105,144],[1977,-1678,60],[1412,-3642,60],[1570,-2792,72],[1932,-1586,72],[1310,-3547,72],[3611,1391,120],[3558,2174,108],[3431,1563,108],[3142,2813,84],[3330,2296,132],[3001,2818,72],[3703,2044,48],[2872,3863,108],[3125,2942,132],[2841,4018,132],[2402,5140,72],[2511,5167,96],[-14607,-5112,108],[-14430,-5180,108],[-14197,-5222,144],[-14895,-4703,60],[-14797,-4728,48],[-14697,-4739,48],[-13919,-5281,132],[-13646,-5170,84],[-13400,-5068,144],[-13099,-5108,132],[-12824,-5092,108],[-12631,-5044,108],[-12427,-4914,108],[-12270,-4816,84],[-11772,-4983,84],[-11940,-4867,108],[-12091,-4699,108],[-12270,-4529,84],[-12460,-4396,108],[-13058,-4252,108],[-12894,-4096,84],[-12738,-4077,84],[-13546,-4341,48],[-13428,-4299,108],[-14679,-4192,84],[-14368,-4308,84],[-14495,-4133,132],[-12072,-3824,96],[-11904,-3648,120],[-11654,-3569,84],[-11648,-3357,108],[-11420,-3359,108],[-11296,-3135,84],[-10782,-2838,96],[-11410,-3039,36],[-10581,-2773,132],[-11118,-5114,96],[-10675,-5079,108],[-10205,-4890,96],[-11543,-4164,96],[-11287,-4244,60],[-10018,-4747,120],[-9278,419,60],[-9341,470,60],[-9180,496,96],[-11365,-4131,120],[-9353,0,72],[-8975,528,120],[-9413,89,108],[-8230,770,48],[-9231,17,84],[-6808,1667,60],[-6694,1622,96],[-8285,855,72],[-6793,1796,96],[-6865,1935,60],[-7043,2222,72],[-7083,2368,72],[-7103,2533,84],[-7099,2721,96],[-7178,2874,48],[-6964,3110,84],[-6246,4191,72],[-6735,3446,48],[-6722,3537,84],[-6396,3388,108],[-6787,3140,108],[-6227,4488,84],[-6281,3953,72],[-6530,3576,132],[-6147,3994,132],[-6141,4292,144],[-6377,5578,84],[-6152,4569,108],[-6222,4769,84],[-6266,4956,72],[-6233,5414,108],[-6347,5646,84],[-6400,6066,84],[-6411,6261,96],[-6565,7043,72],[-6377,6415,108],[-6440,6614,84],[-5944,1954,60],[-6001,2039,96],[-6467,7070,108],[-4963,3608,72],[-4776,3510,48],[-5785,1998,132],[-3708,3449,72],[-3790,3582,108],[-4031,3697,84],[-4859,3634,120],[-3850,3730,120],[-4689,4605,108],[-3492,2892,72],[-4507,4483,72],[-4829,2745,108],[-4435,4273,108],[-3383,2930,108],[-4888,2821,108],[-5372,5172,60],[-5036,2981,108],[-9895,-1942,120],[-9371,-2159,72],[-9995,-1773,108],[-5280,5218,108],[-5079,5183,108],[-5149,3079,72],[-9695,-2048,120],[-5063,5374,108],[-9504,-2059,120],[-8948,-2140,84],[-9262,-2081,132],[-9068,-2071,120],[-8861,-2045,132],[-8654,-2083,120],[-8473,-2048,120],[-8283,-1965,120],[-8182,-1863,108],[-10037,-1579,108],[-10063,-1365,108],[-10074,-1190,108],[-8167,-1225,60],[-8188,-1087,96],[-9975,-1022,108],[-9835,-910,120],[-9709,-848,120],[-9532,-792,120],[-9348,-779,120],[-9131,-784,132],[-8754,-795,84],[-8587,-797,120],[-8424,-856,108],[-8246,-921,108],[-8153,-1701,84],[-6447,-2137,72],[-8153,-1591,60],[-7694,-1393,120],[-6541,-2030,84],[-7135,-1547,84],[-5885,-2958,72],[-7171,-1440,96],[-5620,-3123,72],[-6631,-1866,96],[-5882,-3696,96],[-5716,-2944,108],[-5949,-3528,60],[-6869,-4052,96],[-7081,-2673,60],[-6725,-4069,72],[-10487,-2295,60],[-7032,-2749,72],[-10769,-3817,72],[-6607,-4081,60],[-10849,-1824,84],[-10479,-2146,108],[-7003,-2611,108],[-10749,-1511,72],[-10697,-1953,120],[-10848,-1330,108],[-10912,-1220,60],[-9843,-2685,84],[-10823,-3717,84],[-9697,-2713,72],[-10080,-3431,48],[-10648,-3844,108],[-9530,-2695,120],[-2387,-6791,108],[-8465,-5037,84],[-2550,-6627,108],[-9325,-2822,84],[-10140,-3346,96],[-8461,-4908,108],[8116,-1076,96],[8115,-940,96],[-2503,-6359,168],[-9062,-1580,96],[8120,-790,96],[-9065,-1444,96],[-2615,-6159,120],[-2744,-5943,132],[-3713,-4955,108],[-9061,-1292,96],[-1551,-4718,60],[5251,-6249,60],[5192,-6181,48],[-2898,-5732,108],[-1705,-4629,96],[1618,-7035,60],[-3829,-4776,108],[-2851,-5589,132],[-2974,-5399,132],[-3952,-4568,108],[-4135,-4368,132],[-3428,-5104,132],[-3167,-5254,108],[-3049,-6916,120],[-3097,-6722,108],[-3190,-6493,120],[-3318,-6284,132],[-4672,-5861,132],[-4480,-5668,120],[-4294,-5548,108],[-3433,-6072,120],[-3568,-5881,120],[-3736,-5698,144],[-3978,-7517,108],[-3956,-5572,120],[-4103,-5400,120],[-4281,-5240,120],[-4409,-5034,120],[-4475,-4808,108],[-2777,-7546,120],[-2542,-7502,108],[-2398,-7364,108],[-2350,-7151,108],[-2315,-6976,96],[-3749,-7488,120],[-2995,-7596,144],[-3253,-7558,132],[-3468,-7472,120],[-5028,-6473,120],[-3604,-7301,132],[-3678,-7078,132],[-3835,-6826,132],[-3935,-6595,120],[-5214,-7381,120],[-4065,-6416,132],[-4174,-6231,84],[-4556,-6940,120],[-4663,-6781,120],[-4748,-6548,156],[-4847,-6257,132],[-4806,-6016,108],[-4950,-7410,168],[-5470,-7251,156],[-5637,-7038,120],[-5593,-6819,120],[-5406,-6727,120],[-5263,-6580,120],[-4636,-7476,120],[-4399,-7496,108],[-6769,-7571,108],[-6853,-7377,108],[-8273,-7231,60],[-4182,-7512,108],[-7525,-5855,108],[-7495,-6329,60],[-7297,-6946,108],[-8148,-7137,84],[-7030,-7301,84]],groundDoodads:[[-9670,-1470,"doodadField",.5,0,null,null],[8600,-940,"doodadField",.5,0,null,null],[920,-2800,"doodadField",.5,0,null,null]],debug:{show:!0,collisions:!1},mobile:!1,ios:!1,phone:!1,tablet:!1,mouse:!1,resolution:1,overdrawOptimize:!0,overdraw:256,scalingFactor:2500,altScalingFactor:4e3,minimapPaddingX:16,minimapPaddingY:16,minimapSize:240,maxChatLines:50,maxScoreboard:12,shadowScaling:2,shadowOffsetX:20,shadowOffsetY:40,ackFrequency:10,bucketSize:512,mapWidth:32768,mapHeight:16384},window.Tools={},window.Textures={},window.Graphics={},window.Network={},window.Input={},window.Players={},window.Mobs={},window.Particles={},window.UI={},window.Games={},window.Sound={};var e,t=function(e,t){Tools.updateTime(e),Tools.debugStartFrame(),game.state==Network.STATE.PLAYING?(Input.update(),Network.detectConnectivity(),Players.update(),Mobs.update(),Particles.update(),Games.update(),Sound.update()):game.state==Network.STATE.LOGIN?Tools.updateReel():Sound.update(),Graphics.update(),t||Graphics.render(),Tools.debugEndFrame()},s=function(){var e=performance.now()-game.time;e>450&&!game.focus&&t(e/16.666,!0)};window.addEventListener("DOMContentLoaded",(function(){game.state=Network.STATE.LOGIN,Tools.loadSettings(),Tools.detectCapabilities(),Tools.setupDebug(),Graphics.setup(),Particles.setup(),UI.setup(),Input.setup(),Games.setup(),Sound.setup();var e=new PIXI.ticker.Ticker;e.add(t),e.start(),setInterval(s,500);DEVELOPMENT&&window.location.hash.startsWith("#connect#")&&(game.playRegion="custom",game.playRoom="custom",game.playInvited=!0,game.myOriginalName=config.settings.name||Tools.randomID(6),game.customServerUrl=window.location.hash.substr(9),Games.start(game.myOriginalName,!0))})),setInterval((function(){e!==game.server.id&&game.state===Network.STATE.PLAYING&&game.server.config&&game.server.config.sf&&config.scalingFactor>game.server.config.sf&&(console.log(`%c⚠️ The maximum scalingFactor on this server (${game.server.id}) is ${game.server.config.sf}.\nThis is enforced by the server. Objects past the horizon limit will not be visible.`,"color:red"),e=game.server.id)}),100)},469:()=>{var e={},t={},s={},a=0,l=0,i={},n=0,o=0,r={},u=[0,.7,1,.4,0,.7,.4,.7],c=[0,.7,1,.4,0,.7,1,.7],p=[0,.8,.5,1,0,.8,.5,.8],d=[0,.8,1,.7,.8,.8],h=[0,1.5,1.2,.8,1.35,1.7],g=[0,1,1,.35,1,1],m=[0,.8,.5,1,0,.8,.8,.8],f=[0,1.5,.8,2,1,1.5],y={powerup_shield:.5,upgrade:.2,complete:.5,levelup:.5,respawn:.05,click:.5},b={},w={src:["assets/sounds.mp3?4"],volume:0,sprite:{chopper:[0,3206.1451247165533,!0],click:[5e3,374.9886621315195],complete:[7e3,1910.9750566893417],explosion1:[1e4,4137.460317460316],explosion2:[16e3,4155.44217687075],explosion3:[22e3,4168.367346938776],explosion4:[28e3,4580.272108843537],explosion5:[34e3,4144.943310657595],explosion6:[4e4,4191.360544217688],impact:[46e3,3730.7709750566855],launch1:[51e3,1492.4943310657568],launch2:[54e3,1511.2244897959215],levelup:[57e3,1886.4172335600883],missile:[6e4,8335.351473922898,!0],powerup_rampage:[7e4,7423.083900226758],powerup_shield:[79e3,2070.4761904761854],powerup_upgrade:[83e3,1640.8616780045406],repel:[86e3,2e3],respawn:[89e3,1315.9410430838961],thruster:[92e3,9499.841269841269,!0],upgrade:[103e3,2062.517006802722]}};Sound.setup=function(){var s={};for(var a in b){if(s={src:["/assets/sounds/"+a+".wav"]},Object.keys(b[a]).length>0)for(var l in b[a])s[l]=b[a][l];t[a]=new Howl(s)}e=new Howl(w)},Sound.toggle=function(){Tools.setSettings({sound:!config.settings.sound}),UI.updateSound(!0),v()};var v=function(){config.settings.sound||e.stop()},T=function(e){var t=y[e];return null==t?1:t};Sound.mobExplosion=function(e,t){var s=.3*u[t],a=M(e)*s,l="explosion"+Tools.randInt(1,6);a<.01||I("mobexplosions",4)||S(l,a,e,Tools.rand(.8,1.2))},Sound.playerKill=function(e){var t=1*d[e.type],s=M(e.pos)*t,a="explosion"+Tools.randInt(1,6);s<.01||I("playerkills",3)||S(a,s,e.pos,Tools.rand(.8,1.2))},Sound.playerUpgrade=function(){if(!I("upgrades",1)){var e=T("upgrade");S("upgrade",e)}},Sound.playerRespawn=function(e){var t=T("respawn")*(e.me()?1:M(e.pos)),s=e.me()?null:e.pos;S("respawn",t,s)},Sound.gameComplete=function(){var e=T("complete");S("complete",e)},Sound.levelUp=function(){var e=T("levelup");S("levelup",e)},Sound.UIClick=function(){if(!I("uiclick",1,200)){var e=T("click");S("click",e)}},Sound.effectRepel=function(e){var t=.3*M(e);S("repel",t,e,1.5)},Sound.powerup=function(e,t){var s=.25*(null==t?1:M(t)),a="";4==e?a="powerup_upgrade":8==e?a="powerup_shield":9==e&&(a="powerup_rampage"),S(a,s*T(a),t)},Sound.missileLaunch=function(e,t){var s=.3*c[t],a=M(e)*s,l=p[t],i="launch"+Tools.randInt(1,2);a<.01||I("launches",5)||S(i,a,e,l)},Sound.playerImpact=function(e,t,s){var a=.05*Tools.clamp(s,0,1),l=M(e)*a;S("impact",l,e,f[t])},Sound.update=function(){if(!(game.time-o<100)){var e=game.focus?300:1e3;for(var t in s)game.time-s[t].last>e&&Sound.clearThruster(t);for(var a in i)game.time>=i[a].time&&(k(i[a].id,i[a].sound),delete i[a]);o=game.time}};var I=function(e,t,s){if(null==r[e])return r[e]={num:1,time:game.time},!1;var a=null!=s?s:1e3;return game.time-r[e].time>a?(r[e].num=1,r[e].time=game.time,!1):(r[e].num++,r[e].num>t)},S=function(s,a,l,i,n,o){if(config.settings.sound){if(o){if(null==t[s])return;var r=t[s]}else r=e;if(!r||!r.play)return;if(!(null!=a&&a<.01)){var u=r.play(o?void 0:s);if("thruster"===s||"missile"===s||"chopper"===s){var c=r.seek(null,u);r.seek(c+Tools.rand(0,1),u)}return E(u,s,a,l,i,n,o),u}}},E=function(s,a,l,i,n,o,r){if(config.settings.sound){if(r){if(null==t[a])return;var u=t[a]}else u=e;null!=l&&u.volume(l,s),null!=o&&u.fade(o[0],o[1],o[2],s,4==o.length||null),null!=n&&u.rate(n,s),null==i||config.ios||u.stereo(_(i),s)}},k=function(s,a,l){if(l){if(null==t[a])return;var i=t[a]}else i=e;i.stop(s)};Sound.clearThruster=function(e){if(null!=s[e]){var t=s[e].soundId,o=s[e].vol;E(t,s[e].sound,null,null,null,[o,0,200,!0]),r=t,u=s[e].sound,i[++n]={id:r,sound:u,time:game.time+300},0==s[e].type?a--:l--,delete s[e]}var r,u},Sound.updateThruster=function(e,t,i){if(config.settings.sound){if(0==e){if(PlaneType.Mohawk==t.type){i=t.render;var n="chopper"}else i=t.keystate.UP||t.keystate.DOWN,n="thruster";var o="player_"+t.id+"_"+t.type}else n="missile",o="mob_"+t.id;if(i)if(null==s[o]){if(0==e){if(!t.me()&&a>=5)return}else if(l>=5)return;var r=M(t.pos);if(0==e)var u=r*g[t.type]*.06,c=h[t.type];else u=.08*r,c=m[t.type];if(u<.01)return;var p=S(n,null,t.pos,c,[0,u,200]);s[o]={type:e,started:game.time,last:game.time,sound:n,soundId:p,vol:u},0==e?a++:l++}else{if(game.time-s[o].last<100)return;if(r=M(t.pos),0==e?(u=r*g[t.type]*.06,t.boost&&(u*=3)):u=.08*r,u<.01)return void Sound.clearThruster(o);if(c=null,0==e&&3==t.type&&(c=h[t.type]+t.speed.length()/20),game.time-s[o].started<250)return;E(s[o].soundId,s[o].sound,null,t.pos,c,[s[o].vol,u,100,!0]),s[o].last=game.time,s[o].vol=u}else null!=s[o]&&Sound.clearThruster(o)}};var M=function(e){var t=Graphics.getCamera(),s=Tools.length(e.x-t.x,e.y-t.y),a=(game.halfScreenX/game.scale+game.halfScreenY/game.scale)/2;return Tools.clamp(1.5*(1-s/a),0,1)},_=function(e){var t=Graphics.getCamera(),s=e.x-t.x,a=game.halfScreenX/game.scale;return Tools.clamp(.8*s/a,-1,1)}},448:()=>{var e={map_sea:"assets/map_sea.jpg",map_sea_mask:"assets/map_sea_mask.jpg",map_forest:"assets/map_forest.jpg",map_rock:"assets/map_rock.jpg",map_rock_mask:"assets/map_rock_mask.jpg",map_sand:"assets/map_sand.jpg",map_sand_mask:"assets/map_sand_mask.jpg",mountains:"assets/mountains.png",aircraft:"assets/aircraft.png",shadows:"assets/shadows.png",particles:"assets/particles.png",flags:"assets/flagsbig.png?4",items:"assets/items.png?3",gui:"assets/gui.png"},t={spirit:["aircraft",[4,4,512,256]],tornado:["aircraft",[524,4,256,256]],raptor:["aircraft",[788,4,256,256]],prowler:["aircraft",[1052,4,256,256]],comanche:["aircraft",[1316,4,128,256]],comanche_rotor:["aircraft",[1452,4,128,128]],mountain2:["mountains",[0,512,512,512]],mountain1:["mountains",[512,512,512,512]],mountain4:["mountains",[0,0,512,512]],mountain3:["mountains",[512,0,512,512]],crate_shadow:["shadows",[4,140,64,64]],comanche_rotor_shadow:["shadows",[76,140,64,64]],smokeshadow_8:["shadows",[148,140,32,32]],smokeshadow_7:["shadows",[188,140,32,32]],smokeshadow_6:["shadows",[228,140,32,32]],smokeshadow_5:["shadows",[268,140,32,32]],smokeshadow_4:["shadows",[308,140,32,32]],smokeshadow_3:["shadows",[348,140,32,32]],smokeshadow_2:["shadows",[388,140,32,32]],smokeshadow_15:["shadows",[428,140,32,32]],smokeshadow_14:["shadows",[468,140,32,32]],smokeshadow_13:["shadows",[508,140,32,32]],smokeshadow_12:["shadows",[548,140,32,32]],smokeshadow_11:["shadows",[588,140,32,32]],smokeshadow_10:["shadows",[628,140,32,32]],smokeshadow_1:["shadows",[668,140,32,32]],smokeshadow_16:["shadows",[708,140,32,32]],afterburner_shadow:["shadows",[748,140,32,32]],spirit_shadow:["shadows",[4,4,256,128]],tornado_shadow:["shadows",[268,4,128,128]],screenshade:["shadows",[404,4,128,128]],raptor_shadow:["shadows",[540,4,128,128]],prowler_shadow:["shadows",[676,4,128,128]],comanche_shadow:["shadows",[812,4,64,128]],missile_shadow:["shadows",[884,4,32,128]],smokeshadow_9:["shadows",[924,76,32,32]],ctf_flag_shadow:["shadows",[924,4,64,64]],flash_1:["particles",[0,128,120,120]],glowsmall:["particles",[120,128,64,64]],smoke_9:["particles",[184,128,32,32]],smoke_8:["particles",[216,128,32,32]],smoke_7:["particles",[248,128,32,32]],smoke_6:["particles",[280,128,32,32]],smoke_5:["particles",[312,128,32,32]],smoke_4:["particles",[344,128,32,32]],smoke_3:["particles",[376,128,32,32]],smoke_2:["particles",[408,128,32,32]],smoke_16:["particles",[440,128,32,32]],smoke_15:["particles",[472,128,32,32]],smoke_14:["particles",[504,128,32,32]],smoke_13:["particles",[536,128,32,32]],smoke_12:["particles",[568,128,32,32]],smoke_11:["particles",[600,128,32,32]],smoke_10:["particles",[632,128,32,32]],smoke_1:["particles",[664,128,32,32]],shockwave:["particles",[0,0,128,128]],hotsmoke_4:["particles",[128,0,120,120]],hotsmoke_3:["particles",[248,0,120,120]],hotsmoke_2:["particles",[368,0,120,120]],hotsmoke_1:["particles",[488,0,120,120]],flash_4:["particles",[608,0,120,120]],flash_3:["particles",[728,0,120,120]],spark_4:["particles",[848,120,8,8]],spark_3:["particles",[856,120,8,8]],spark_2:["particles",[864,120,8,8]],spark_1:["particles",[872,120,8,8]],flash_2:["particles",[848,0,120,120]],crate_upgrade:["items",[4,268,128,128]],crate_magic:["items",[4,409,128,128]],crate_shield:["items",[140,268,128,128]],crate_rampage:["items",[276,268,128,128]],afterburner:["items",[412,268,128,128]],missile_fat:["items",[548,268,64,128]],missile_carrot:["items",[694,268,64,128]],missile:["items",[620,268,32,128]],doodad_field:["items",[4,4,256,256]],badge_bronze:["items",[268,140,64,64]],powerup_shield:["items",[268,4,128,128]],badge_gold:["items",[404,140,64,64]],powerup_rampage:["items",[404,4,128,128]],badge_silver:["items",[540,140,64,64]],powerup_circle:["items",[540,4,128,128]],glowdirectional:["items",[676,140,64,64]],ctf_flag_red:["items",[676,4,128,128]],glowsmall_copy:["items",[812,140,64,64]],missile_small:["items",[884,140,16,64]],levelborder:["items",[908,140,32,32]],ctf_flag_blue:["items",[812,4,128,128]],hud_shadow:["gui",[4,268,80,348]],hud_mask:["gui",[92,268,80,348]],hud:["gui",[180,268,80,348]],emote_bro:["gui",[268,548,64,64]],emote_clap:["gui",[268,476,64,64]],ui_minimap_box:["gui",[268,404,64,64]],emote_cry:["gui",[340,548,64,64]],emote_kappa:["gui",[340,476,64,64]],emote_tf:["gui",[340,404,64,64]],emote_lol:["gui",[412,548,64,64]],emote_pepe:["gui",[412,476,64,64]],ui_minimap_blue:["gui",[484,596,16,16]],ui_minimap_base_blue:["gui",[484,556,32,32]],ui_minimap_base_red:["gui",[484,516,32,32]],ui_minimap_flag_blue:["gui",[484,476,32,32]],emote_rage:["gui",[412,404,64,64]],ui_minimap_mob:["gui",[484,444,16,16]],ui_minimap_flag_red:["gui",[484,404,32,32]],ui_minimap:["gui",[4,4,512,256]],chatbubbleleft:["gui",[274,274,16,82]],chatbubblecenter:["gui",[350,274,82,82]],chatbubbleright:["gui",[438,274,16,82]],chatbubblepoint:["gui",[297,352,36,22]]},s={flag_1:["flags",[2,962,80,60]],flag_2:["flags",[2,898,80,60]],flag_3:["flags",[2,834,80,60]],flag_4:["flags",[2,770,80,60]],flag_5:["flags",[2,706,80,60]],flag_6:["flags",[2,642,80,60]],flag_7:["flags",[2,578,80,60]],flag_8:["flags",[2,514,80,60]],flag_9:["flags",[2,450,80,60]],flag_10:["flags",[2,386,80,60]],flag_11:["flags",[2,322,80,60]],flag_12:["flags",[2,258,80,60]],flag_13:["flags",[2,194,80,60]],flag_14:["flags",[2,130,80,60]],flag_15:["flags",[2,66,80,60]],flag_16:["flags",[86,962,80,60]],flag_17:["flags",[86,898,80,60]],flag_18:["flags",[86,834,80,60]],flag_19:["flags",[86,770,80,60]],flag_20:["flags",[86,706,80,60]],flag_21:["flags",[86,642,80,60]],flag_22:["flags",[86,578,80,60]],flag_23:["flags",[86,514,80,60]],flag_24:["flags",[86,450,80,60]],flag_25:["flags",[86,386,80,60]],flag_26:["flags",[86,322,80,60]],flag_27:["flags",[86,258,80,60]],flag_28:["flags",[86,194,80,60]],flag_29:["flags",[86,130,80,60]],flag_30:["flags",[170,962,80,60]],flag_31:["flags",[170,898,80,60]],flag_32:["flags",[170,834,80,60]],flag_33:["flags",[170,770,80,60]],flag_34:["flags",[170,706,80,60]],flag_35:["flags",[170,642,80,60]],flag_36:["flags",[170,578,80,60]],flag_37:["flags",[170,514,80,60]],flag_38:["flags",[170,450,80,60]],flag_39:["flags",[170,386,80,60]],flag_40:["flags",[170,322,80,60]],flag_41:["flags",[170,258,80,60]],flag_42:["flags",[170,194,80,60]],flag_43:["flags",[254,962,80,60]],flag_44:["flags",[254,898,80,60]],flag_45:["flags",[254,834,80,60]],flag_46:["flags",[254,770,80,60]],flag_47:["flags",[254,706,80,60]],flag_48:["flags",[254,642,80,60]],flag_49:["flags",[254,578,80,60]],flag_50:["flags",[254,514,80,60]],flag_51:["flags",[254,450,80,60]],flag_52:["flags",[254,386,80,60]],flag_53:["flags",[254,322,80,60]],flag_54:["flags",[338,962,80,60]],flag_55:["flags",[338,898,80,60]],flag_56:["flags",[338,834,80,60]],flag_57:["flags",[338,770,80,60]],flag_58:["flags",[338,706,80,60]],flag_59:["flags",[338,642,80,60]],flag_60:["flags",[338,578,80,60]],flag_61:["flags",[338,514,80,60]],flag_62:["flags",[338,450,80,60]],flag_63:["flags",[338,386,80,60]],flag_64:["flags",[422,962,80,60]],flag_65:["flags",[422,898,80,60]],flag_66:["flags",[422,834,80,60]],flag_67:["flags",[422,770,80,60]],flag_68:["flags",[422,706,80,60]],flag_69:["flags",[422,642,80,60]],flag_70:["flags",[422,578,80,60]],flag_71:["flags",[422,514,80,60]],flag_72:["flags",[422,450,80,60]],flag_73:["flags",[506,962,80,60]],flag_74:["flags",[506,898,80,60]],flag_75:["flags",[506,834,80,60]],flag_76:["flags",[506,770,80,60]],flag_77:["flags",[506,706,80,60]],flag_78:["flags",[506,642,80,60]],flag_79:["flags",[506,578,80,60]],flag_80:["flags",[590,770,80,60]],flag_81:["flags",[590,706,80,60]],flag_82:["flags",[590,642,80,60]],flag_83:["flags",[590,578,80,60]],flag_84:["flags",[506,514,80,60]],flag_85:["flags",[590,514,80,60]],flag_86:["flags",[506,450,80,60]],flag_87:["flags",[590,450,80,60]],flag_88:["flags",[422,386,80,60]],flag_89:["flags",[506,386,80,60]],flag_90:["flags",[590,386,80,60]],flag_91:["flags",[338,322,80,60]],flag_92:["flags",[422,322,80,60]],flag_93:["flags",[506,322,80,60]],flag_94:["flags",[590,322,80,60]],flag_95:["flags",[254,258,80,60]],flag_96:["flags",[338,258,80,60]],flag_97:["flags",[422,258,80,60]],flag_98:["flags",[506,258,80,60]],flag_99:["flags",[590,258,80,60]],flag_100:["flags",[254,194,80,60]],flag_101:["flags",[338,194,80,60]],flag_102:["flags",[422,194,80,60]],flag_103:["flags",[506,194,80,60]],flag_104:["flags",[590,194,80,60]],flag_105:["flags",[170,130,80,60]],flag_106:["flags",[254,130,80,60]],flag_107:["flags",[338,130,80,60]],flag_108:["flags",[422,130,80,60]],flag_109:["flags",[506,130,80,60]],flag_110:["flags",[590,130,80,60]],flag_111:["flags",[86,66,80,60]],flag_112:["flags",[170,66,80,60]],flag_113:["flags",[254,66,80,60]],flag_114:["flags",[338,66,80,60]],flag_115:["flags",[422,66,80,60]],flag_116:["flags",[506,66,80,60]],flag_117:["flags",[590,66,80,60]],flag_118:["flags",[2,2,80,60]],flag_119:["flags",[86,2,80,60]],flag_120:["flags",[170,2,80,60]],flag_121:["flags",[254,2,80,60]],flag_122:["flags",[338,2,80,60]],flag_123:["flags",[422,2,80,60]],flag_124:["flags",[506,2,80,60]],flag_125:["flags",[590,2,80,60]]},a={hudHealth_shadow:{texture:"hud_shadow",layer:"ui0",pivot:[330,174],position:"screencenter",alpha:.2},hudHealth_mask:{texture:"hud_mask",layer:"hudHealth",pivot:[330,174],position:"screencenter"},hudHealth:{texture:"hud",layer:"hudHealth",pivot:[330,174],position:"screencenter"},hudEnergy_shadow:{texture:"hud_shadow",layer:"ui0",pivot:[330,174],position:"screencenter",alpha:.2,rotation:Math.PI},hudEnergy_mask:{texture:"hud_mask",layer:"hudEnergy",pivot:[330,174],position:"screencenter",rotation:Math.PI},hudEnergy:{texture:"hud",layer:"hudEnergy",pivot:[330,174],position:"screencenter",tint:3374821},minimap:{texture:"ui_minimap",layer:"ui0",anchor:[1,1],alpha:.25},minimapBox:{texture:"ui_minimap_box",layer:"ui4",anchor:[.5,.5],alpha:.6},minimapMob:{texture:"ui_minimap_mob",layer:"ui1",anchor:[.5,.5],alpha:.5,scale:.8},minimapBlue:{texture:"ui_minimap_blue",layer:"ui1",anchor:[.5,.5],alpha:.5,scale:.8},minimapFlagBlue:{texture:"ui_minimap_flag_blue",layer:"ui3",anchor:[.5,.5],scale:.5},minimapFlagRed:{texture:"ui_minimap_flag_red",layer:"ui3",anchor:[.5,.5],scale:.5},minimapBaseBlue:{texture:"ui_minimap_base_blue",layer:"ui2",anchor:[.5,.5],scale:.5},minimapBaseRed:{texture:"ui_minimap_base_red",layer:"ui2",anchor:[.5,.5],scale:.5},thrusterShadow:{texture:"afterburner_shadow",layer:"shadows",anchor:[.5,.1]},missile:{texture:"missile",layer:"projectiles",anchor:[.5,0],scale:[.2,.15]},missileFat:{texture:"missile_fat",layer:"projectiles",anchor:[.5,0],scale:[.2,.2]},missileSmall:{texture:"missile_small",layer:"projectiles",anchor:[.5,0],scale:[.2,.2]},missileCarrot:{texture:"missile_carrot",layer:"projectiles",anchor:[.5,0],scale:[.3,.3]},missileShadow:{texture:"missile_shadow",layer:"shadows",anchor:[.5,.25]},missileThruster:{texture:"afterburner",layer:"thrusters",anchor:[.5,.1],scale:[.15,.15]},thrusterGlowSmall:{texture:"glowsmall_copy",layer:"glows",anchor:[.5,.5],blend:"ADD"},smokeGlow:{texture:"glowdirectional",layer:"glows",anchor:[.5,.3],blend:"ADD"},crateShadow:{texture:"crate_shadow",layer:"shadows",anchor:[.5,.5]},crateUpgrade:{texture:"crate_upgrade",layer:"crates",anchor:[.5,.5]},crateMagic:{texture:"crate_magic",layer:"crates",anchor:[.5,.5]},crateShield:{texture:"crate_shield",layer:"crates",anchor:[.5,.5]},crateRampage:{texture:"crate_rampage",layer:"crates",anchor:[.5,.5]},powerupCircle:{texture:"powerup_circle",layer:"powerups",anchor:[.5,.5],blend:"ADD"},powerupShield:{texture:"powerup_shield",layer:"powerups",anchor:[.5,.5],blend:"ADD"},powerupRampage:{texture:"powerup_rampage",layer:"powerups",anchor:[.5,.5],blend:"ADD"},powerupRampage:{texture:"powerup_rampage",layer:"powerups",anchor:[.5,.5],blend:"ADD"},ctfFlagRed:{texture:"ctf_flag_red",layer:"flags",anchor:[15/128,119/128]},ctfFlagBlue:{texture:"ctf_flag_blue",layer:"flags",anchor:[15/128,119/128]},ctfFlagShadow:{texture:"ctf_flag_shadow",layer:"shadows",anchor:[3/32,23/32]},shipRaptor:{texture:"raptor",layer:"aircraft",anchor:[.5,.6]},shipRaptorShadow:{texture:"raptor_shadow",layer:"shadows",anchor:[.5,.57]},shipRaptorThruster:{texture:"afterburner",layer:"thrusters",anchor:[.5,.1],scale:[.25,.25]},shipSpirit:{texture:"spirit",layer:"aircraft",anchor:[.5,.5]},shipSpiritShadow:{texture:"spirit_shadow",layer:"shadows",anchor:[.5,.5]},shipSpiritThruster:{texture:"afterburner",layer:"thrusters",anchor:[.5,.1],scale:[.25,.25]},shipComanche:{texture:"comanche",layer:"aircraft",anchor:[.5,.4]},shipComancheShadow:{texture:"comanche_shadow",layer:"shadows",anchor:[.5,.43]},shipComancheRotor:{texture:"comanche_rotor",layer:"aircraft",anchor:[.5,.5],scale:[.25,.25]},shipComancheRotorShadow:{texture:"comanche_rotor_shadow",layer:"shadows",anchor:[.5,.5]},shipTornado:{texture:"tornado",layer:"aircraft",anchor:[.5,.65]},shipTornadoShadow:{texture:"tornado_shadow",layer:"shadows",anchor:[.5,.605]},shipProwler:{texture:"prowler",layer:"aircraft",anchor:[.5,.5]},shipProwlerShadow:{texture:"prowler_shadow",layer:"shadows",anchor:[.5,.5]},mountain1:{texture:"mountain1",layer:"doodads",anchor:[.5,.5]},mountain2:{texture:"mountain2",layer:"doodads",anchor:[.5,.5]},mountain3:{texture:"mountain3",layer:"doodads",anchor:[.5,.5]},mountain4:{texture:"mountain4",layer:"doodads",anchor:[.5,.5]},doodadField:{texture:"doodad_field",layer:"fields",anchor:[.5,.5]}},l={};Textures.load=function(){for(var a in e)l[a]=new PIXI.Texture.fromImage(e[a]);var i;for(var a in t)i=t[a],l[a]=new PIXI.Texture(l[i[0]].baseTexture,new PIXI.Rectangle(i[1][0],i[1][1],i[1][2],i[1][3]));for(var a in s)i=s[a],l[a]=new PIXI.Texture(l[i[0]].baseTexture,new PIXI.Rectangle(i[1][0],i[1][1],i[1][2],i[1][3]))},Textures.get=function(e){return l[e]},Textures.getNamed=function(e){return l[a[e].texture]},Textures.init=function(e,t){var s=JSON.parse(JSON.stringify(a[e]));if("screencenter"===s.position&&(s.position=[game.halfScreenX,game.halfScreenY]),t)for(var l in t)s[l]=t[l];return Graphics.initSprite(s.texture,game.graphics.layers[s.layer],s)},Textures.sprite=function(e){return new PIXI.Sprite(l[e])},Textures.tile=function(e,t,s){return new PIXI.extras.TilingSprite(l[e],t,s)}}},t={};function s(a){var l=t[a];if(void 0!==l)return l.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,s),i.exports}(()=>{"use strict";s(763),s(298);class e{constructor(e,t){this.x=e,this.y=t}add(e){this.x+=e,this.y+=e}divide(e){this.x/=e,this.y/=e}multiply(e){this.x*=e,this.y*=e}limit(e){this.divide(this.length()),this.multiply(e)}clone(){return new e(this.x,this.y)}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}angle(){return Math.atan2(this.y,this.x)-Math.PI/2}ceil(e){this.x>e&&(this.x=e),this.y>e&&(this.y=e)}floor(e){this.x<e&&(this.x=e),this.y<e&&(this.y=e)}both(e){this.x=e,this.y=e}static zero(){return new e(0,0)}static diag(t){return new e(t,t)}static create(t,s){return new e(Math.sin(t)*s,-Math.cos(t)*s)}static createOff(t,s,a){return new e(t.x+Math.sin(s)*a,t.y-Math.cos(s)*a)}}let t=!1,a=!1,l=!1,i=!1;const n=["","ffa","ctf","br","dev"],o=["","Free For All","Capture The Flag","Battle Royale","Development"],r=["","Everyone versus everyone deathmatch. No teams.","Players split into 2 teams. 2 flags are placed inside each base. The objective is to move the enemy flag from their base to your base.","Players spawn at random locations all across the map. Destroyed players will not respawn. Last player standing wins.","Game environments for development and testing."];let u={},c=0,p=null,d=null,h=!1,g=null,m=[{name:"Europe",id:"eu",games:[{type:"1",id:"ffa1",name:"Free For All #1",nameShort:"FFA #1",host:"eu.airmash.online",path:"ffa "},{type:"3",id:"btr1",name:"Battle Royale #1",nameShort:"BTR #1",host:"eu.airmash.online",path:"btr"}]},{name:"US",id:"us",games:[{type:"1",id:"ffa2",name:"Free For All #2",nameShort:"FFA #2",host:"ffa.herrmash.com",path:"ffa"},{type:"2",id:"ctf2",name:"Capture The Flag #2",nameShort:"CTF #2",host:"airmash.us",path:"ctf"},{type:"3",id:"btr1",name:"Battle Royale #1",nameShort:"BTR #1",host:"us.airmash.online",path:"btr"},{type:"4",id:"box1",name:"Box Experiments #1",nameShort:"BOX #1",host:"box-server.mooo.com",path:"ffa"}]}];window.DEVELOPMENT&&m.splice(0,0,{name:"dev",id:"dev",games:n.map(((e,t)=>({type:t,id:`${e}1`,name:`${o[t]} #1`,nameShort:`${e.toUpperCase()} #1`,host:"127.0.0.1:3501",path:`?${e}`})))});let f=!1,y={},b={},w=null,v=!1,T={radius:0,pos:e.zero(),speed:0},I={};const S="https://login.airmash.online";let E=0,k=null;Games.setup=function(){$("#playregion").on("click",(function(e){Games.updateRegion(!0,e)})),$("#playtype").on("click",(function(e){Games.updateType(!0,e)})),$("#skin").on("click",(function(e){Games.updateSkin(!0,e)})),$("#open-menu").on("click",(function(e){Games.popGames(),e.stopPropagation()})),$("#gameselector").on("click",(function(e){e.stopPropagation()})),$("#invite-copy").on("click",Games.copyInviteLink),$("#loginbutton").on("click",(function(e){UI.openLogin(),e.stopPropagation()})),$("#login-microsoft").on("click",(function(){Games.popupLogin(1)})),$("#login-google").on("click",(function(){Games.popupLogin(2)})),$("#login-twitter").on("click",(function(){Games.popupLogin(3)})),$("#login-reddit").on("click",(function(){Games.popupLogin(4)})),$("#login-twitch").on("click",(function(){Games.popupLogin(5)})),$("#loginselector").on("click",(function(e){e.stopPropagation()})),$("#gotomainpage").on("click",Games.redirRoot),$("#lifetime-signin").on("click",Games.redirRoot),Tools.loadAuth()?Games.playerAuth():Games.playerGuest(),setInterval(Tools.syncRemoteSettings,1e3),Games.updateRegion(!1),Games.updateType(!1),Games.updateSkin(!1),config.debug.disable_region_ping||O(),P((function(){U(),f||(C(),Games.updateRegion(!1),Games.updateType(!1))}),!0)};var M=function(e){e.origin===S?e.data.provider===E?(E=0,e.data.nonce===k?(k=null,window.loginSuccess({tokens:e.data.tokens,identityprovider:e.data.provider,loginname:e.data.loginname})):console.log("nonce does not match: "+e.data.nonce)):console.log("identity provider does not match: "+e.data.provider):console.log("bad origin for login message: "+e.origin)};Games.popupLogin=function(e){window.addEventListener("message",M,{once:!0}),E=e,k=Tools.randomID(32);let t=`${S}/login?provider=${E}&nonce=${k}&origin=${window.origin}`;_(t,"Login",4==e?900:500,5==e?800:600)};var _=function(e,t,s,a){let l=window.screenLeft?window.screenLeft:window.screenX,i=window.screenTop?window.screenTop:window.screenY,n=(window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width)/2-s/2+l,o=(window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height)/2-a/2+i;window.open(e,t,`width=${s}, height=${a}, top=${o}, left=${n}`)};window.loginSuccess=function(e){Tools.setAuth(e),Games.playerAuth(),UI.closeLogin()},window.loginFailure=function(){},Games.playerGuest=function(){UI.show("#playbutton",!0),UI.show("#loginbutton",!0)},Games.playerAuth=function(){Tools.ajaxGet(`https://${game.backendHost}/settings`,config.auth.tokens.settings,(function(e){if(null!=e){game.loggedIn=!0;let t=["","Microsoft","Google","Twitter","Reddit","Twitch"][config.auth.identityprovider||0],s=UI.escapeHTML((config.auth.loginname||"").substr(0,30));s+=`<span class="grey">(${t})</span>`;let a=s+'<span class="link" onclick="Games.logout()">Logout</span>',l="Logged in as "+s+'<span class="button" onclick="Games.logout()">LOG OUT</span>';$("#logout").html(a),$("#logout-mainmenu").html(l),$("#loginbutton").remove(),$("#lifetime-account").remove(),$("#playbutton").html("PLAY"),UI.show("#playbutton",!0),Tools.setSettings(e),Tools.applySettingsToGame()}else Games.playerGuest()}))},Games.logout=function(){Tools.setAuth({}),Tools.removeSetting("flag"),Tools.removeSetting("name"),window.location=window.location};var P=function(e,t){let s=`https://${game.backendHost}/games`;t&&(s+="?main=1"),fetch(s+"?"+(new Date).getTime()).then((e=>e.json())).then((s=>{m=JSON.parse(s.data),"xx"==game.myFlag&&(game.myFlag=s.country),t&&game.protocol!=s.protocol&&("#reload"!==window.location.hash?Tools.ajaxPost(`https://${game.backendHost}/clienterror`,{type:"protocol"},(function(){UI.showMessage("alert",'<span class="mainerror">Protocol update<br>Your client is being updated to the new version</span>',3e4),setTimeout((function(){window.location="/?"+Tools.randomID(10)+"#reload"}),5e3)})):Tools.ajaxPost(`https://${game.backendHost}/clienterror`,{type:"protocolretry"})),window.DEVELOPMENT&&m.splice(0,0,{name:"dev",id:"dev",games:n.map(((e,t)=>({type:t,id:`${e}1`,name:`${o[t]} #1`,nameShort:`${e.toUpperCase()} #1`,host:"127.0.0.1:3501",path:`?${e}`})))}),e()})).catch((()=>{}))},U=function(){let e=0,t=0;for(let s of m)for(let a of s.games)a.players&&(e+=a.players),a.bots&&(e-=a.bots),t++;if(0===t)f=!0,UI.showMessage("alert",'<span class="mainerror">We are currently performing server maintenance<br>Please try again in a few minutes</span>',3e4);else{let t='<div class="item smallerpad">'+e+"</div>player"+(e>1?"s":"")+" online";$("#gameinfo").html(t)}},x=function(e){if("closest"===e)return{name:"Closest"};for(let t of m)if(t.id===e)return t;return(game.playRegion="closest")?{name:"Closest"}:void 0},A=function(e,t){let s=x(e);if(!s||!s.games)return null;for(let e of s.games)if(e.id===t)return e;let a=n.indexOf(t);if(-1!=a)for(let e of s.games)if(e.type==a)return{name:o[a]};return null},C=function(){let e=window.location.hash;if("#reload"!==e&&null!=e&&!(e.length<4||e.length>20)){e=e.substr(1);let t=e.split("-");if(2==t.length){let[e,s]=t;null!=A(e,s)&&(game.playRegion=e,game.playRoom=s,game.playInvited=!0,history.replaceState(null,null,"/"))}}};Games.selectRegion=function(e,t){e.stopPropagation(),Sound.UIClick(),game.playRegion=t,Games.updateRegion(!1),Games.updateType()},Games.selectGame=function(e,t){e.stopPropagation(),Sound.UIClick(),game.playRoom=t,Games.updateType(!1)},Games.selectSkin=function(e,t){e.stopPropagation(),Sound.UIClick(),game.skin=t,Games.updateSkin(!1)},Games.closeDropdowns=function(){a&&Games.updateType(!1),t&&Games.updateRegion(!1),l&&Games.updateSkin(!1)},Games.updateRegion=function(e,s){let i,n="";if(!f){if(s&&(s.stopPropagation(),t||Sound.UIClick()),e&&UI.closeLogin(),null==e&&(e=t),e){a&&Games.updateType(!1),l&&Games.updateSkin(!1),n+='<div class="item">',n+='<div class="region header">REGION</div>',n+='<div class="players header">PLAYERS</div>',n+='<div class="ping header">PING</div>',n+='<div class="clear"></div>',n+="</div>";let e="";null!=d&&(e='<span class="autoregion">('+m[d].name+")</span>"),n+='<div class="item selectable'+("closest"===game.playRegion?" sel":"")+'" onclick="Games.selectRegion(event, &quot;closest&quot;)">',n+='<div class="region chooser">Closest'+e+"</div>",n+='<div class="clear"></div>',n+="</div>";for(let e of m){let t=!1,s=0;for(let a of e.games)a.players&&(s+=a.players,t=!0),a.bots&&(s-=a.bots);t||(s='<span class="playersunknown">?</span>');let a="&nbsp;";e.ping&&(a=Math.round(e.ping)+'<span class="ms">ms</span>'),n+='<div class="item selectable'+(e.id===game.playRegion?" sel":"")+'" onclick="Games.selectRegion(event, &quot;'+e.id+'&quot;)">',n+='<div class="region chooser">'+e.name+"</div>",n+='<div class="players number">'+s+"</div>",n+='<div class="ping chooser nopadding">'+a+"</div>",n+='<div class="clear"></div>',n+="</div>"}n+='<div class="item"></div>',i={width:"240px",height:"auto","z-index":"2"},$("#playregion").removeClass("hoverable")}else n+='<div class="arrowdown"></div>',n+='<div class="playtop">REGION</div>',n+='<div class="playbottom">'+x(game.playRegion).name+"</div>",i={width:"130px",height:"40px","z-index":"auto"},$("#playregion").addClass("hoverable");$("#playregion").html(n),$("#playregion").css(i),t=e}};var R=function(){let e=game.playRegion;if("closest"===e){if(null==d)return null;e=m[d].id}return e},L=function(e){return`<div class="infott">${r[e]}<div class="arrow"></div></div>`};Games.updateType=function(e,s){let i="",r=null;if(!f){if(s&&(s.stopPropagation(),a||Sound.UIClick()),e&&UI.closeLogin(),null==e&&(e=a),e){t&&Games.updateRegion(!1),l&&Games.updateSkin(!1),i+='<div class="item">',i+='<div class="gametype header">GAME</div>',i+='<div class="players header">PLAYERS</div>',i+='<div class="bots header">BOTS</div>',i+='<div class="clear"></div>',i+="</div>";let e=R();if(null==e)return;null==A(e,game.playRoom)&&(game.playRoom=n[1]);let s=[[],[],[],[],[],[],[],[],[]],a=x(e).games;for(let e of a)s[e.type].push(e);for(let e=1;e<n.length;e++)if(s[e].length>0){i+='<div class="item selectable'+(n[e]===game.playRoom?" sel":"")+'" onclick="Games.selectGame(event, &quot;'+n[e]+'&quot;)">',i+='<div class="gametype chooser">'+o[e],i+='<span class="infocontainer">&nbsp;<div class="infoicon">'+L(e)+"</div></span>",i+="</div>",i+='<div class="clear"></div>',i+="</div>";for(let t of s[e])i+='<div class="item selectable'+(t.id===game.playRoom?" sel":"")+'" onclick="Games.selectGame(event, &quot;'+t.id+'&quot;)">',i+='<div class="gametype chooser">'+t.nameShort+"</div>",i+='<div class="players number">'+(null!=t.players?t.players-(t.bots||0):'<span class="playersunknown">?</span>')+"</div>",i+='<div class="bots number">'+(t.bots?`+${t.bots}`:"")+"</div>",i+='<div class="clear"></div>',i+="</div>"}i+='<div class="item"></div>',r={width:"280px",height:"auto","z-index":"2"},$("#playtype").removeClass("hoverable")}else{i+='<div class="arrowdown"></div>',i+='<div class="playtop">GAME</div>';let e=R();if(null==e)return;let t=A(e,game.playRoom);null==t?(name=o[1],game.playRoom=n[1]):name=t.name,i+='<div class="playbottom">'+name+"</div>",r={width:"190px",height:"40px","z-index":"auto"},$("#playtype").addClass("hoverable")}$("#playtype").html(i),$("#playtype").css(r),a=e}},Games.updateSkin=function(e,s){let i="",n=null;if(s&&(s.stopPropagation(),l||Sound.UIClick()),e&&UI.closeLogin(),null==e&&(e=l),e){t&&Games.updateRegion(!1),a&&Games.updateType(!1);const e=JSON.parse(localStorage.getItem("my_skins")||"[]");i+='<div class="item"></div>',i+='<div class="item selectable" \n                onclick="Games.selectSkin(event, \'\')">\n                <div class="gametype chooser">Default</div>\n                <div class="clear"></div>\n        </div>';for(let t of e)i+=`<div class="item selectable" \n                onclick="Games.selectSkin(event, '${t}')">\n                <div class="gametype chooser"><img style="max-width:50px;max-height:50px" src="${t}"></div>\n                <div class="clear"></div>\n            </div>`;i+='<div class="item"></div>',n={width:"280px",height:"auto","z-index":"2"},$("#playtype").removeClass("hoverable")}else i+='<div class="arrowdown"></div>',i+='<div class="playtop">SKIN</div>',i+='<div class="playbottom">'+(game.skin?`<img style="max-width:20px;max-height:20px" src="${game.skin}">`:"Default")+"</div>",n={width:"190px",height:"40px","z-index":"auto"},$("#skin").addClass("hoverable");$("#skin").html(i),$("#skin").css(n),l=e},Games.popGames=function(){if(!i){UI.closeAllPanels("games");let e=N();UI.hide("#menu"),$("#gameselector").html(e),UI.show("#gameselector"),i=!0,G(),Sound.UIClick()}};var N=function(){let e="";e+='<div class="header">'+game.roomNameShort,e+='<span class="region">&nbsp;&nbsp;&bull;&nbsp;&nbsp;'+game.regionName+"</span>",e+="</div>",e+='<div class="buttons">',e+='<div class="button" onclick="Games.redirRoot()">CHANGE REGION</div>',e+="</div>";let t=[[],[],[],[],[],[],[],[],[]],s=x(game.playRegion).games;for(let e of s)t[e.type].push(e);for(let s=1;s<n.length;s++)if(t[s].length>0){e+='<div class="item head">',e+='<div class="gametype chooser section">'+o[s],e+='<span class="infocontainer">&nbsp;<div class="infoicon">'+L(s)+"</div></span>",e+="</div>",e+='<div class="clear"></div>',e+="</div>";for(let a of t[s]){let t,s;a.id===game.playRoom?(t=" sel",s=""):(t=" selectable",s=` onclick="Games.switchGame(&quot;${game.playRegion}-${a.id}&quot;)"`),e+='<div class="item'+t+'"'+s+">",e+='<div class="gametype chooser">'+a.nameShort+"</div>",e+='<div class="players number">'+(null!=a.players?a.players-(a.bots||0):'<span class="playersunknown">?</span>')+"</div>",e+='<div class="bots number">'+(a.bots?`+${a.bots}`:"")+"</div>",e+='<div class="clear"></div>',e+="</div>"}}return e};Games.redirRoot=function(){game.reloading=!0,window.location="/"};var G=function(){P((function(){let e=N();$("#gameselector").html(e)}))};Games.closeGames=function(){i&&(UI.hide("#gameselector"),UI.show("#menu"),i=!1,Sound.UIClick())},Games.toggleGames=function(){i?Games.closeGames():Games.popGames()},Games.switchGame=function(e){if(Games.closeGames(),null!=e){let t=e.split("-");2==t.length&&([game.playRegion,game.playRoom]=t)}game.myScore=0,game.server={},game.state=Network.STATE.CONNECTING,Network.shutdown(),Particles.wipe(),Players.wipe(),Mobs.wipe(),UI.reconnection(),Games.start(game.myOriginalName)};var O=function(){u={},c=0;for(let e=0;e<m.length;e++){let t=m[e].games,s=t[Tools.randInt(0,t.length-1)].host;null==u[s]&&(u[s]={ping:9999,num:0,threshold:0,server:e})}Games.performPing(),Games.performPing(),Games.performPing(),p=setInterval(Games.performPing,300)};Games.performPing=function(){if(!h&&c<=3){let e,t=9999;for(let s in u)u[s].num<t&&(t=u[s].num,e=s);if(t>6)p&&clearInterval(p);else{u[e].num++;let t=`https://${e}/ping`;D(e,t,(function(){D(e,t)}))}}};var D=function(e,t,s){if(!h&&null!=u[e]){c++;let a=performance.now();fetch(t,{method:"GET",mode:"no-cors",cache:"no-cache"}).then((t=>{if(c--,!h&&null!=u[e]){let t=performance.now()-a;u[e].threshold++,Math.abs(u[e].ping-t)<.1*t&&u[e].threshold>=2?t<u[e].ping?(m[u[e].server].ping=t,Games.findClosest(),Games.updateRegion()):delete u[e]:t<u[e].ping&&(u[e].ping=t,m[u[e].server].ping=t,Games.findClosest(),Games.updateRegion(),s&&s())}})).catch((e=>{c--}))}};Games.findClosest=function(){let e=9999,t=!1;for(let s=0;s<m.length;s++){let a=m[s];a.ping&&a.ping<e&&(e=a.ping,d=s,t=!0)}t&&"closest"===game.playRegion&&Games.updateType()},Games.highlightInput=function(e){$(e).css({transition:"none",transform:"scale(1.1)","background-color":"rgb(90, 30, 30)"}),$(e).width(),$(e).css({transition:"all 0.5s ease-in-out",transform:"scale(1)","background-color":"rgb(30, 30, 30)"}),setTimeout((function(){$(e).focus()}),200)},Games.copyInviteLink=function(){F(game.inviteLink)&&(UI.show("#invite-copied"),g&&clearTimeout(g),g=setTimeout((function(){UI.hide("#invite-copied")}),2e3))};var F=function(e){let t=document.createElement("span");t.textContent=e,t.style.whiteSpace="pre";let s=document.createElement("iframe");s.sandbox="allow-same-origin",document.body.appendChild(s);let a=s.contentWindow;a.document.body.appendChild(t);let l=a.getSelection();l||(a=window,l=a.getSelection(),document.body.appendChild(t));let i=a.document.createRange();l.removeAllRanges(),i.selectNode(t),l.addRange(i);let n=!1;try{n=a.document.execCommand("copy")}catch(e){}return l.removeAllRanges(),t.remove(),s.remove(),n};Games.start=function(e,t){if(f&&!DEVELOPMENT)return;if(t&&game.state==Network.STATE.CONNECTING)return;let s=game.playRegion;if(!DEVELOPMENT||!game.customServerUrl){let e=R();if(!e)return;game.playRegion=e;let t=function(){let e=game.playRoom,t=n.indexOf(e);if(-1!=t){let s=x(game.playRegion).games,a=[];for(let e of s)e.type==t&&a.push(e.id);e=a[Tools.rand(0,1)<.5?a.length-1:Tools.randInt(0,a.length-1)]}return e}(),s=A(game.playRegion,t);game.playHost=s.host,game.playPath=s.path,game.roomNameShort=s.nameShort,game.regionName=x(game.playRegion).name,game.playRoom=t}null!=p&&clearInterval(p),h=!0,game.state==Network.STATE.LOGIN&&Tools.wipeReel(),game.state=Network.STATE.CONNECTING;let a={name:e};DEVELOPMENT&&game.customServerUrl?game.server={id:`custom-${game.customServerUrl}`}:(game.server={id:`${game.playRegion}-${game.playRoom}`},game.playInvited||(a.region=s)),Tools.setSettings(a),UI.gameStart(e,t)},Games.prep=function(){switch(Games.wipe(),game.gameType){case GameType.CTF:$("#gamespecific").html('<div class="blueflag"></div><div id="blueflag-name" class="blueflag-player">&nbsp;</div><div class="redflag"></div><div id="redflag-name" class="redflag-player">&nbsp;</div>'),UI.show("#gamespecific"),y={flagBlue:{visible:!1,playerId:null,direction:1,diffX:0,momentum:0,position:e.zero(),basePos:new e(-9669,-1471),sprite:Textures.init("ctfFlagBlue",{scale:.4,visible:!1}),spriteShadow:Textures.init("ctfFlagShadow",{scale:.4*1.1,visible:!1}),minimapSprite:Textures.init("minimapFlagBlue"),minimapBase:Textures.init("minimapBaseBlue")},flagRed:{visible:!1,playerId:null,direction:1,diffX:0,momentum:0,position:e.zero(),basePos:new e(8602,-944),sprite:Textures.init("ctfFlagRed",{scale:.4,visible:!1}),spriteShadow:Textures.init("ctfFlagShadow",{scale:.4*1.1,visible:!1}),minimapSprite:Textures.init("minimapFlagRed"),minimapBase:Textures.init("minimapBaseRed")}},Graphics.minimapMob(y.flagBlue.minimapBase,y.flagBlue.basePos.x,y.flagBlue.basePos.y),Graphics.minimapMob(y.flagRed.minimapBase,y.flagRed.basePos.x,y.flagRed.basePos.y);break;case GameType.BTR:$("#gamespecific").html(""),UI.show("#gamespecific");break;case GameType.FFA:$("#gamespecific").html(""),game.server.config.tdmMode&&($("#gamespecific").html('<div id="blueflag-name" class="blueflag-player" style="color: #4076E2">0</div><div id="redflag-name" class="redflag-player" style="color: #EA4242">0</div>'),UI.show("#gamespecific"))}},Games.wipe=function(){Y(),y.flagRed&&(game.graphics.layers.flags.removeChild(y.flagRed.sprite),game.graphics.layers.shadows.removeChild(y.flagRed.spriteShadow),game.graphics.layers.ui3.removeChild(y.flagRed.minimapSprite),game.graphics.layers.ui2.removeChild(y.flagRed.minimapBase),y.flagRed.sprite.destroy(),y.flagRed.spriteShadow.destroy(),y.flagRed.minimapSprite.destroy(),y.flagRed.minimapBase.destroy(),y.flagRed=null),y.flagBlue&&(game.graphics.layers.flags.removeChild(y.flagBlue.sprite),game.graphics.layers.shadows.removeChild(y.flagBlue.spriteShadow),game.graphics.layers.ui3.removeChild(y.flagBlue.minimapSprite),game.graphics.layers.ui2.removeChild(y.flagBlue.minimapBase),y.flagBlue.sprite.destroy(),y.flagBlue.spriteShadow.destroy(),y.flagBlue.minimapSprite.destroy(),y.flagBlue.minimapBase.destroy(),y.flagBlue=null)},Games.networkFlag=function(t){let s,a,l;game.gameType!=GameType.FFA||y.flagRed||(y.flagRed={visible:!1,playerId:null,direction:1,diffX:0,momentum:0,position:e.zero(),basePos:new e(8602,-944),sprite:Textures.init("ctfFlagRed",{scale:.4,visible:!1}),spriteShadow:Textures.init("ctfFlagShadow",{scale:.4*1.1,visible:!1}),minimapSprite:Textures.init("minimapFlagRed"),minimapBase:Textures.init("minimapBaseRed")},y.flagRed.minimapBase.visible=!1),1==t.flag?(s=y.flagBlue,a="#blueflag-name",l=t.blueteam):(s=y.flagRed,a="#redflag-name",l=t.redteam),s.momentum=0,s.direction=1,s.sprite.scale.x=.4,s.sprite.rotation=0,s.spriteShadow.scale.x=.4*1.1,s.spriteShadow.rotation=0;let i=`<span class="rounds">${l}<span class="divider">/</span>3</span>`;if(1==t.type){s.playerId=null,s.position.x=t.posX,s.position.y=t.posY,s.sprite.position.set(t.posX,t.posY);let l=Graphics.shadowCoords(new e(t.posX,t.posY));s.spriteShadow.position.set(l.x,l.y),Graphics.minimapMob(s.minimapSprite,t.posX,t.posY),$(a).html(i)}else{s.playerId=t.id;let e=Players.get(t.id);null!=e&&(1==t.flag?i=UI.escapeHTML(e.name)+i:i+=UI.escapeHTML(e.name)),s.diffX=e.pos.x,$(a).html(i)}H(s,!1),game.flagEnabled=!0};var H=function(e,t){if(t&&game.flagEnabled&&(Graphics.minimapMob(e.minimapSprite,e.position.x,e.position.y),game.gameType==GameType.CTF&&Graphics.minimapMob(e.minimapBase,e.basePos.x,e.basePos.y)),null!=e.playerId){let t=Players.get(e.playerId);if(null!=t&&(t.render!=e.visible&&(e.visible=t.render,e.sprite.visible=t.render,e.spriteShadow.visible=t.render,t.render&&(e.momentum=0,e.direction=1,e.diffX=t.pos.x)),t.render?Graphics.minimapMob(e.minimapSprite,t.pos.x,t.pos.y):Graphics.minimapMob(e.minimapSprite,t.lowResPos.x,t.lowResPos.y)),e.visible){e.position.x=t.pos.x,e.position.y=t.pos.y,e.sprite.position.set(t.pos.x,t.pos.y);let s=Graphics.shadowCoords(t.pos);e.spriteShadow.position.set(s.x,s.y),e.momentum=Tools.clamp(e.momentum+(t.pos.x-e.diffX)*game.timeFactor,-40,40);let a=e.momentum>0?.1:-.1;e.direction=Tools.clamp(e.direction-a*game.timeFactor,-.4,.4),e.sprite.scale.x=e.direction,e.spriteShadow.scale.x=1.1*e.direction;let l=.04*-(t.pos.x-e.diffX)*game.timeFactor;e.sprite.rotation=l,e.spriteShadow.rotation=l,e.diffX=t.pos.x}}else{let t=Graphics.inScreen(e.position,128);t!=e.visible&&(e.visible=t,e.sprite.visible=t,e.spriteShadow.visible=t)}};Games.spectate=function(e){null==game.spectatingID&&game.gameType!==GameType.BTR&&UI.showMessage("alert",'<span class="info">SPECTATOR MODE</span>Click on Respawn to resume playing',4e3),game.spectatingID=e;let t="",s=Players.get(e);t+='<div id="spectator-tag" class="spectating">Spectating '+(null==s?"":UI.escapeHTML(s.name))+"</div>",t+='<div class="buttons">',t+='<div onclick="Network.spectateNext()" class="changeplayer left"><div class="arrow"></div></div>',t+='<div onclick="Network.spectatePrev()" class="changeplayer right"><div class="arrow"></div></div>',t+="</div>",UI.showSpectator(t)},Games.spectatorSwitch=function(e){setTimeout((function(){e===game.spectatingID&&Network.spectateNext()}),2e3)},Games.playersAlive=function(e){let t="";e>1&&(t=`<div class="playersalive">${e} players alive</div>`),$("#gamespecific").html(t)},Games.showBTRWin=function(e){if(!$("#custom-msg").length){let t="";t+='<div id="custom-msg" class="btrwin">',t+='<div class="trophy"></div>',t+='<div class="winner">',t+='<div class="player"><span class="flag big flag-'+UI.escapeHTML(e.f)+'"></span>'+UI.escapeHTML(e.p)+"</div>",t+="</div>",t+='<div class="bounty">',t+='<span class="stat">'+UI.escapeHTML(e.k)+" KILL"+(1==e.k?"":"S")+"</span>",t+="+"+UI.escapeHTML(e.b)+" BOUNTY",t+="</div>",t+="</div>",$("body").append(t),UI.showPanel("#custom-msg"),setTimeout((function(){UI.hidePanel("#custom-msg",!1,!0)}),1e3*e.t),Sound.gameComplete()}},Games.showCTFWin=function(e){if(!$("#custom-msg").length){let t="";t+='<div id="custom-msg" class="ctfwin">',t+='<div class="trophy"></div>',t+='<div class="winner">'+(1==e.w?'<div class="player blue">BLUE TEAM</div>':'<div class="player red">RED TEAM</div>')+"</div>",t+='<div class="bounty">+'+UI.escapeHTML(e.b)+" BOUNTY</div></div>",$("body").append(t),UI.showPanel("#custom-msg"),setTimeout((function(){UI.hidePanel("#custom-msg",!1,!0)}),1e3*e.t),Sound.gameComplete()}},Games.showLevelUp=function(e){$("#custom-msg").length&&$("#custom-msg").remove();let t="",s=" lvlsmaller";null!=I[e+""]&&(s="",t='<div class="unlocked">FEATURE UNLOCKED<br><div class="unlockedtext">'+I[e+""]+"</div></div>");let a='<div id="custom-msg" class="levelup'+s+'"><div class="leveltext">NEW LEVEL REACHED</div><div class="levelbadge"></div><div class="levelnum">'+e+"</div>"+t+"</div>";$("body").append(a),UI.showPanel("#custom-msg"),setTimeout((function(){UI.hidePanel("#custom-msg",!1,!0,!0)}),2e3),Sound.levelUp()},Games.popFirewall=function(t,s){s<=0&&(s=0),v||(v=!0,w=new PIXI.Graphics,game.graphics.gui.minimap.mask=w),w.clear(),w.beginFill(16777215),w.drawCircle(game.screenX-config.minimapPaddingX-config.minimapSize*(16384-t.x)/32768,game.screenY-config.minimapPaddingY-config.minimapSize/2*(8192-t.y)/16384,2*s/(256/config.minimapSize*256)),w.endFill();let a=Math.ceil((game.halfScreenX+64)/game.scale/64),l=Math.ceil((game.halfScreenY+64)/game.scale/64),i={},n=Graphics.getCamera(),o=new e(n.x-game.halfScreenX/game.scale-64,n.y-game.halfScreenY/game.scale-64),r=new e(n.x+game.halfScreenX/game.scale+64,n.y-game.halfScreenY/game.scale-64),u=new e(n.x-game.halfScreenX/game.scale-64,n.y+game.halfScreenY/game.scale+64),c=new e(n.x+game.halfScreenX/game.scale+64,n.y+game.halfScreenY/game.scale+64);if(Tools.distance(t.x,t.y,o.x,o.y)>s||Tools.distance(t.x,t.y,r.x,r.y)>s||Tools.distance(t.x,t.y,u.x,u.y)>s||Tools.distance(t.x,t.y,c.x,c.y)>s)for(let e=-a;e<=a;e++)for(let a=-l;a<=l;a++){let l=64*(Math.floor(n.x/64)+.5)+64*e,o=64*(Math.floor(n.y/64)+.5)+64*a,r=Tools.distance(l,o,t.x,t.y);if(r>=s){let e=`${l}_${o}`;if(i[e]=!0,null==b[e]){let t=Textures.sprite(`hotsmoke_${Tools.randInt(1,4)}`);t.scale.set(Tools.rand(1.5,2.5)),t.anchor.set(.5,.5),t.position.set(l,o);let a=1;Tools.rand(0,1)>.5&&(t.blendMode=PIXI.BLEND_MODES.ADD,a=.5),game.graphics.layers.powerups.addChild(t),b[e]={sprite:t,rotation:Tools.rand(0,100),rotationSpeed:Tools.rand(-.0025,.0025),opacity:0,maxOpacity:a,opacitySpeed:r-s>=64?.02:.0035,color:Tools.rand(0,1),colorDir:Tools.rand(0,1)<.5?-1:1}}}}for(let e in b)i[e]?(b[e].rotation+=b[e].rotationSpeed*game.timeFactor,b[e].opacity+=b[e].opacitySpeed*game.timeFactor,b[e].opacity>b[e].maxOpacity&&(b[e].opacity=b[e].maxOpacity),b[e].color+=.005*b[e].colorDir*game.timeFactor,b[e].color<0&&(b[e].colorDir=1),b[e].color>1&&(b[e].colorDir=-1),b[e].sprite.rotation=b[e].rotation,b[e].sprite.alpha=b[e].opacity,b[e].sprite.tint=Tools.colorLerp(16427014,16404230,b[e].color)):(game.graphics.layers.powerups.removeChild(b[e].sprite),b[e].sprite.destroy(),delete b[e])};var Y=function(){if(v){for(let e in b)game.graphics.layers.powerups.removeChild(b[e].sprite),b[e].sprite.destroy();b={},game.graphics.gui.minimap.mask=null,w&&(w.destroy(),w=null),v=!1}};Games.handleFirewall=function(e){0==e.status?Y():(T.radius=e.radius,T.pos.x=e.posX,T.pos.y=e.posY,T.speed=e.speed,Games.popFirewall(T.pos,T.radius))},Games.update=function(e){switch(game.gameType){case GameType.CTF:y.flagBlue&&(H(y.flagBlue,e),H(y.flagRed,e));break;case GameType.BTR:v&&(T.radius+=T.speed/60*game.timeFactor,Games.popFirewall(T.pos,T.radius));break;case GameType.FFA:y.flagBlue&&H(y.flagBlue,e),y.flagRed&&H(y.flagRed,e)}};const B=["#e6194b","#3cb44b","#ffe119","#f58231","#911eb4","#46f0f0","#f032e6","#bcf60c","#008080"];let X={};Games.assign_team_color=function(e){if(X[e])return X[e];{let t=B.filter((e=>!Object.values(X).includes(e)));t.length||(t=B);const s=t[Math.floor(Math.random()*t.length)];return X[e]=s,s}},Games.unassign_team_color=function(e){X[e]=null},Games.updateTdmScore=function(e,t){game.server.config.tdmMode&&($("#blueflag-name").html(`<span class="rounds">${e}</span>`),$("#redflag-name").html(`<span class="rounds">${t}</span>`))};var z,K={position:e.zero(),center:e.zero(),lastOverdraw:e.zero(),lastOverdrawTime:0,shake:0},W={},V={},j={};Graphics.setup=function(){Q(window.innerWidth,window.innerHeight),J(),Textures.load(),Z(),ee(),q(),se(),Mobs.setupDoodads(),UI.setupMinimap(),UI.setupHUD(),Graphics.updateDebug()};var J=function(){PIXI.utils.skipHello(),PIXI.settings.PRECISION_FRAGMENT=PIXI.PRECISION.HIGH;var e={autoResize:!0,clearBeforeRender:!1,preserveDrawingBuffer:!0};config.settings.hidpi&&(e.resolution=2);try{z=new PIXI.WebGLRenderer(game.screenX,game.screenY,e)}catch(t){try{PIXI.settings.SPRITE_MAX_TEXTURES=Math.min(PIXI.settings.SPRITE_MAX_TEXTURES,16),z=new PIXI.WebGLRenderer(game.screenX,game.screenY,e)}catch(e){return void UI.popBigMsg(2)}}document.body.appendChild(z.view)},Z=function(){for(var e of["game","ui0","ui1","ui2","ui3","ui4","hudHealth","hudEnergy","flags","doodads","map","sea","objects","groundobjects","fields","shadows","powerups","crates","aircraft","aircraftme","glows","playernames","bubbles","thrusters","projectiles","smoke","explosions"])j[e]=new PIXI.Container;for(var t of["smoke","crates","thrusters","projectiles","aircraft","aircraftme","glows","explosions","powerups","playernames","flags","bubbles"])j.objects.addChild(j[t]);for(var t of["fields"])j.groundobjects.addChild(j[t]);game.graphics.layers=j,game.graphics.gui=V},q=function(){W.render=PIXI.RenderTexture.create(game.screenX+config.overdraw,game.screenY+config.overdraw,void 0,config.settings.hidpi?2:void 0),W.renderSprite=new PIXI.Sprite(W.render),W.shadows=PIXI.RenderTexture.create(game.shadowX,game.shadowY,void 0,config.settings.hidpi?2:void 0),W.shadowsSprite=new PIXI.Sprite(W.shadows),W.shadowsSprite.scale.set(game.screenX/game.shadowX,game.screenY/game.shadowY),W.shadowsSprite.blendMode=PIXI.BLEND_MODES.MULTIPLY,W.shadowsSprite.alpha=.4,j.game.addChild(W.renderSprite),j.game.addChild(j.groundobjects),j.game.addChild(W.shadowsSprite),W.shade=Textures.sprite("screenshade"),W.shade.scale.set(game.shadowX/126/game.scale,game.shadowY/126/game.scale),W.shade.alpha=.825,W.shade.anchor.set(.5,.5),j.shadows.addChild(W.shade),j.game.addChild(j.objects),j.game.addChild(j.ui0),j.game.addChild(j.ui1),j.game.addChild(j.ui2),j.game.addChild(j.ui3),j.game.addChild(j.ui4),V.hudTextureEnergy=PIXI.RenderTexture.create(80,348,void 0,config.settings.hidpi?2:void 0),V.hudSpriteEnergy=new PIXI.Sprite(V.hudTextureEnergy),V.hudSpriteEnergy.pivot.set(-250,174),V.hudTextureHealth=PIXI.RenderTexture.create(80,348,void 0,config.settings.hidpi?2:void 0),V.hudSpriteHealth=new PIXI.Sprite(V.hudTextureHealth),V.hudSpriteHealth.pivot.set(330,174),j.game.addChild(V.hudSpriteEnergy),j.game.addChild(V.hudSpriteHealth)};Graphics.updateDebug=function(){if(!window.DEVELOPMENT)return;if(config.debug.collisions){if(!this.gfx){let e=new PIXI.Graphics;for(let t=0;t<config.walls.length;t++)e.beginFill(16777215,.2),e.drawCircle(config.walls[t][0],config.walls[t][1],config.walls[t][2]),e.endFill();j.objects.addChild(e),this.gfx=e}}else this.gfx&&(j.objects.removeChild(this.gfx),this.gfx.destroy(),this.gfx=null);const e=Players.all();for(let t in e)e[t].updateDebug();if(j.map.visible=!config.debug.hide_container_map,config.debug.hide_container_sea){W.sea.alpha=0,W.sea_mask.alpha=0;var t=z.width+config.overdraw,s=z.height+config.overdraw;W.sea_solid=new PIXI.Sprite(PIXI.Texture.WHITE),W.sea_solid.tint=5592405,W.sea_solid.width=t,W.sea_solid.height=s,j.sea.addChild(W.sea_solid)}else W.sea.alpha=1,W.sea_mask.alpha=.5,j.sea.removeChild(W.sea_solid),W.sea_solid?.destroy();config.debug.hide_container_shadows?(this.removed_shadows=!0,j.game.removeChild(W.shadowsSprite)):this.removed_shadows&&j.game.addChild(W.shadowsSprite)},Graphics.resizeRenderer=function(e,t){var s=e+config.overdraw,a=t+config.overdraw;for(var l of(Q(e,t),ee(),z.resize(e,t),W.render.resize(s,a),W.shadows.resize(e,t),W.shadowsSprite.scale.set(game.screenX/game.shadowX,game.screenY/game.shadowY),W.shade.scale.set(game.shadowX/126/game.scale,game.shadowY/126/game.scale),["sea","forest","sand","rock"]))W[l].width=s,W[l].height=a;UI.resizeMinimap(),UI.resizeHUD(),ae(),le(),Graphics.setCamera(K.center.x,K.center.y),game.state==Network.STATE.PLAYING&&Network.resizeHorizon()},Graphics.toggleHiDPI=function(){Tools.setSettings({hidpi:!config.settings.hidpi}),UI.updateMainMenuSettings(),1==config.oldhidpi==config.settings.hidpi?UI.showMessage("alert","",1e3):UI.showMessage("alert",'Reload game to apply HiDPI settings<br><span class="button" onclick="Games.redirRoot()">RELOAD</span>',1e4)};var Q=function(e,t){game.screenX=e,game.screenY=t,game.halfScreenX=e/2,game.halfScreenY=t/2,game.shadowX=Math.floor(game.screenX/config.shadowScaling),game.shadowY=Math.floor(game.screenY/config.shadowScaling)},ee=function(){game.scale=(game.screenX+game.screenY)/UI.getScalingFactor(),j.groundobjects.scale.set(game.scale),j.objects.scale.set(game.scale),j.shadows.scale.set(game.scale),j.doodads.scale.set(game.scale),j.bubbles.scale.set(1/game.scale),te()},te=function(){if(config.mobile){var e=game.screenX>game.screenY?"landscape":"portrait";config.phone=game.screenX<=599&&"portrait"==e||game.screenY<=599&&"landscape"==e,config.tablet=game.screenX>=600&&game.screenX<=1024&&"portrait"==e||game.screenY>=600&&game.screenY<=1024&&game.screenX<=1024&&"landscape"==e,config.maxScoreboard=8,config.phone&&(config.minimapSize=160,config.maxScoreboard=5),config.tablet&&(config.maxScoreboard=7),config.minimapPaddingX=game.screenX/2-config.minimapSize/2}},se=function(){var e=z.width+config.overdraw,t=z.height+config.overdraw;for(var s of(W.sea=Textures.tile("map_sea",e,t),W.sea_mask=Textures.sprite("map_sea_mask"),W.sea_mask.scale.set(8,8),W.sea_mask.blendMode=PIXI.BLEND_MODES.MULTIPLY,W.sea_mask.alpha=.5,W.forest=Textures.tile("map_forest",e,t),W.sand=Textures.tile("map_sand",e,t),W.sand_mask=Textures.sprite("map_sand_mask"),W.sand_mask.scale.set(8,8),W.sand.mask=W.sand_mask,W.rock=Textures.tile("map_rock",e,t),W.rock_mask=Textures.sprite("map_rock_mask"),W.rock_mask.scale.set(8,8),W.rock.mask=W.rock_mask,j.sea.addChild(W.sea),j.sea.addChild(W.sea_mask),["forest","sand","sand_mask","rock","rock_mask"]))j.map.addChild(W[s]);j.map.addChild(j.doodads),ie(),ae()},ae=function(){var e;for(e of["sea","forest","sand","rock"])W[e].tileScale.set(game.scale,game.scale);for(e of["sea","sand","rock"])W[e+"_mask"].scale.set(8*game.scale,8*game.scale)},le=function(){W.polygons.scale.x=game.scale,W.polygons.scale.y=game.scale},ie=function(){fetch("assets/map.json").then((e=>e.json())).then((e=>{W.polygons=new PIXI.Graphics,W.polygons.beginFill();var t,s,a,l,i,n,o,r=0,u=0;for(n=0;n<e.length;n++)for(a=0,o=0;o<e[n].length;o++){for(l=[],i=0;i<e[n][o].length;i+=2)t=e[n][o][i]+r,s=e[n][o][i+1]+u,l.push(parseFloat(t),-parseFloat(s)),r=t,u=s;W.polygons.drawPolygon(l),0!=a&&W.polygons.addHole(),a++}W.polygons.endFill(),le(),j.map.addChild(W.polygons),j.map.mask=W.polygons}))};Graphics.initSprite=function(e,t,s){var a=Textures.sprite(e);return s.position&&a.position.set(s.position[0],s.position[1]),s.anchor&&a.anchor.set(s.anchor[0],s.anchor[1]),s.pivot&&a.pivot.set(s.pivot[0],s.pivot[1]),s.scale&&(Array.isArray(s.scale)?a.scale.set(s.scale[0],s.scale[1]):a.scale.set(s.scale)),s.rotation&&(a.rotation=s.rotation),s.alpha&&(a.alpha=s.alpha),s.blend&&(a.blendMode=PIXI.BLEND_MODES[s.blend]),s.tint&&(a.tint=s.tint),s.mask&&(a.mask=s.mask),s.visible&&(a.visible=s.visible),t.addChild(a),a},Graphics.transform=function(e,t,s,a,l,i,n){e&&(e.position.set(t,s),null!=i?e.scale.set(l,i):null!=l&&e.scale.set(l),null!=a&&(e.rotation=a),null!=n&&(e.alpha=n))},Graphics.update=function(){W.shade.position.set(K.center.x/config.shadowScaling,K.center.y/config.shadowScaling),W.renderSprite.position.set(game.scale*(-K.position.x+K.lastOverdraw.x)-config.overdraw/2,game.scale*(-K.position.y+K.lastOverdraw.y)-config.overdraw/2),j.objects.position.set(-K.position.x*game.scale,-K.position.y*game.scale),j.groundobjects.position.set(-K.position.x*game.scale,-K.position.y*game.scale),j.doodads.position.set(-K.position.x*game.scale+config.overdraw/2,-K.position.y*game.scale+config.overdraw/2),j.shadows.position.set(-K.position.x*(game.scale/config.shadowScaling),-K.position.y*(game.scale/config.shadowScaling)),V.minimap_box.position.set(game.screenX-config.minimapPaddingX-config.minimapSize*((16384-K.center.x)/32768),game.screenY-config.minimapPaddingY-config.minimapSize/2*((8192-K.center.y)/16384)),config.overdrawOptimize?(Math.abs(K.position.x-K.lastOverdraw.x)>config.overdraw/2/game.scale||Math.abs(K.position.y-K.lastOverdraw.y)>config.overdraw/2/game.scale||game.time-K.lastOverdrawTime>2e3)&&ne():ne()},Graphics.setCamera=function(e,t){var s=0,a=0;K.shake>.5&&(s=Tools.rand(-K.shake,K.shake),a=Tools.rand(-K.shake,K.shake),K.shake*=1-.06*game.timeFactor);var l=game.halfScreenX/game.scale,i=game.halfScreenY/game.scale;e=Tools.clamp(e,-16384+l,16384-l),t=Tools.clamp(t,-8192+i,8192-i),K.position.x=s+e-game.screenX/2/game.scale,K.position.y=a+t-game.screenY/2/game.scale,K.center.x=s+e,K.center.y=a+t},Graphics.getCamera=function(){return K.center},Graphics.shakeCamera=function(e,t){var s=Tools.length(e.x-K.center.x,e.y-K.center.y),a=(game.halfScreenX/game.scale+game.halfScreenY/game.scale)/2,l=Tools.clamp(1.3*(1-s/a),0,1);l<.1||(K.shake=l*t)},Graphics.shadowCoords=function(t){var s=Mobs.getClosestDoodad(t);return new e((t.x+config.shadowOffsetX*s)/config.shadowScaling,(t.y+config.shadowOffsetY*s)/config.shadowScaling)},Graphics.minimapMob=function(e,t,s){null!=e&&e.position.set(game.screenX-config.minimapPaddingX-config.minimapSize*((16384-t)/32768),game.screenY-config.minimapPaddingY-config.minimapSize/2*((8192-s)/16384))},Graphics.toggleFullscreen=function(){var e;((e=document).fullscreenElement?null!==e.fullscreenElement:e.mozFullScreenElement?null!==e.mozFullScreenElement:e.webkitFullscreenElement?null!==e.webkitFullscreenElement:e.msFullscreenElement?null!==e.msFullscreenElement:void 0)?function(){var e=document;e.exitFullscreen?e.exitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen?e.webkitExitFullscreen():e.msExitFullscreen&&e.msExitFullscreen()}():function(){var e=document.documentElement;if(e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen(),config.mobile&&null!=window.screen&&null!=window.screen.orientation)try{screen.orientation.lock("landscape")}catch(e){}}()},Graphics.inScreen=function(e,t){return e.x>=K.center.x-game.halfScreenX/game.scale-t&&e.x<=K.center.x+game.halfScreenX/game.scale+t&&e.y>=K.center.y-game.halfScreenY/game.scale-t&&e.y<=K.center.y+game.halfScreenY/game.scale+t};var ne=function(){Mobs.updateDoodads(),K.lastOverdraw.x=K.position.x,K.lastOverdraw.y=K.position.y,W.renderSprite.position.set(-config.overdraw/2,-config.overdraw/2);var e,t=K.position.x-config.overdraw/game.scale/2,s=K.position.y-config.overdraw/game.scale/2,a=-t*game.scale,l=-s*game.scale,i=(-t-16384)*game.scale,n=(-s-8192)*game.scale;for(e of["sea","forest","sand","rock"])W[e].tilePosition.set(a,l);for(e of["sea","sand","rock"])W[e+"_mask"].position.set(i,n);null!=W.polygons&&null!=W.polygons.position&&W.polygons.position.set(-t*game.scale,-s*game.scale),K.lastOverdrawTime=game.time,z.render(j.sea,W.render),z.render(j.map,W.render)};Graphics.render=function(){z.render(j.shadows,W.shadows,!0),z.render(j.hudEnergy,V.hudTextureEnergy,!0),z.render(j.hudHealth,V.hudTextureHealth,!0),z.render(j.game)};var oe={},re={},ue={},ce=null,pe=0,de=2*Math.PI,he=null,ge=!1,me={},fe=!1,ye=null,be=0,we={LEFT:["LEFT","A"],RIGHT:["RIGHT","D"],UP:["UP","W"],DOWN:["DOWN","S"],STRAFELEFT:["Q"],STRAFERIGHT:["E"],FIRE:["SPACE"],SPECIAL:["CTRL","SHIFT"],SHOWSCORE:["TAB"],DROPUPGRADE:["X"],DROPFLAG:["Y"],MAINMENU:["F1"],SHOWGAMES:["F2"],FULLSCREEN:["F"],MINIMIZECHAT:["PGDOWN"],MAXIMIZECHAT:["PGUP"],SAY:["GRAVE"],TEAM:["T"],REPLY:["R"],SPECTATE:["V"],UPGRADE1:["1"],UPGRADE2:["2"],UPGRADE3:["3"],UPGRADE4:["4"],SOUND:["G"],HELP:["H"],INVITE:["I"],MOUSEMODE:["M"],ALTZOOM:["BACKSPACE"],ZOOMOUT:["-"],ZOOMIN:["="],DEFAULTZOOM:["0"]},ve={},Te={LEFT:!0,RIGHT:!0,UP:!0,DOWN:!0,FIRE:!0,SPECIAL:!0,STRAFELEFT:!0,STRAFERIGHT:!0},Ie={},Se={MAINMENU:!0,FULLSCREEN:!0,INVITE:!0,SOUND:!0,SHOWSCORE:!0,SHOWGAMES:!0,HELP:!0},Ee=[["Forward","UP"],["Backward","DOWN"],["Turn Left","LEFT"],["Turn Right","RIGHT"],["Fire","FIRE"],["Special","SPECIAL"],["Strafe Left","STRAFELEFT"],["Strafe Right","STRAFERIGHT"],["Drop Flag","DROPFLAG"],["Spectate","SPECTATE"],["Upgrade Speed","UPGRADE1"],["Upgrade Defense","UPGRADE2"],["Upgrade Energy","UPGRADE3"],["Upgrade Missiles","UPGRADE4"],["Zoom Out","ZOOMOUT"],["Default Zoom","DEFAULTZOOM"],["Scoreboard","SHOWSCORE"],["Main Menu","MAINMENU"],["Show Games","SHOWGAMES"],["Fullscreen","FULLSCREEN"],["Maximize Chat","MAXIMIZECHAT"],["Minimize Chat","MINIMIZECHAT"],["Drop Upgrade","DROPUPGRADE"],["In-game Say","SAY"],["Team Chat","TEAM"],["Reply","REPLY"],["Toggle Sound","SOUND"],["Help","HELP"],["Invite Friends","INVITE"],["Mouse Mode","MOUSEMODE"],["Zoom In","ZOOMIN"],["Alternate Zoom","ALTZOOM"]],ke={},Me={BACKSPACE:8,TAB:9,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS:20,SPACE:32,PGUP:33,PGDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,WINDOWL:91,WINDOWR:92,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,"*":106,"+":107,"-":109,DECIMAL:110,"/":111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUMLOCK:144,SCROLL:145,":":186,"=":187,",":188,"-":189,".":190,"/":191,GRAVE:192,"[":219,"\\":220,"]":221,QUOTE:222},_e=["UP","DOWN","LEFT","RIGHT","FIRE","SPECIAL"],Pe=["UP","DOWN","LEFT","RIGHT","FIRE","SPECIAL"];Input.setup=function(){for(var e in Me)ke[Me[e]]=e;ve=JSON.parse(JSON.stringify(we)),Re(),Ne(!0),$(window).on("keydown",Ue),$(window).on("keyup",xe),$(window).on("gamepadconnected",(function(e){UI.showMessage("alert",'<span class="info">GAMEPAD CONNECTED</span>'+UI.escapeHTML(e.originalEvent.gamepad.id),3e3),ge=!0,Ce()})),$(window).on("gamepaddisconnected",(function(e){UI.showMessage("alert",'<span class="info">GAMEPAD DISCONNECTED</span>'+UI.escapeHTML(e.originalEvent.gamepad.id),3e3),ge=!1,Ce()}))};var Ue=function(e){if(game.state==Network.STATE.PLAYING||game.state==Network.STATE.CONNECTING){var t=e.which;if(72!=t&&UI.hideHelp(),null!=ye&&Le(t))e.preventDefault();else{var s=Input.getBind(t);if(!Ae(t))return null==Te[s]?(ue[t]||(ue[t]=!0,UI.controlKey(t,s,!0)),e.preventDefault(),!1):(oe[s]||(oe[s]=!0,De(s)),re[t]||(re[t]=!0),e.preventDefault(),!1)}}},xe=function(e){if(game.state==Network.STATE.PLAYING||game.state==Network.STATE.CONNECTING){var t=e.which,s=Input.getBind(t);if(null==Te[s]&&ue[t]&&(ue[t]=!1),!Ae(t))return oe[s]&&(oe[s]=!1,Fe(s)),re[t]&&(re[t]=!1),e.preventDefault(),!1}},Ae=function(e,t){return!!UI.chatBoxOpen()&&9!=e&&27!=e&&13!=e&&38!=e&&40!=e&&37!=e&&39!=e&&112!=e&&113!=e&&114!=e&&115!=e&&116!=e&&117!=e&&118!=e&&119!=e&&120!=e&&121!=e&&122!=e&&123!=e},Ce=function(){me={forward:!0,left:!1,right:!1,up:!1,down:!1,fire:!1,special:!1,angle:0,force:0}};Input.toggleKeybinds=function(){fe?Input.closeKeybinds():Input.openKeybinds()},Input.getBind=function(e){var t=Ie[e];return null==t?null:t},Input.bindKey=function(e,t,s){null==ye&&(ye=t,be=s,$(e.target).html("press key"))},Input.closeBind=function(){null!=ye&&(Ne(),ye=null)},Input.resetBinds=function(){we=JSON.parse(JSON.stringify(ve)),Tools.removeSetting("keybinds"),ye=null,Ne()};var Re=function(){if(null!=config.settings.keybinds)for(var e in config.settings.keybinds)we[e]=JSON.parse(JSON.stringify(config.settings.keybinds[e]))},Le=function(e){var t=ke[e];if(27==e&&(t=""),null!=t){for(var s in we)we[s][0]==t&&(we[s][0]=""),we[s].length>1&&we[s][1]==t&&(we[s][1]="");for(s in we[ye][be]=t,we)we[s].length>1&&""==we[s][0]&&""!=we[s][1]&&(we[s]=[we[s][1]]),2==we[s].length&&""===we[s][1]&&we[s].splice(-1,1);return Ne(),function(){var e={},t="";for(var s in we)null!=ve[s]&&(t=JSON.stringify(we[s]))!==JSON.stringify(ve[s])&&(e[s]=JSON.parse(t));Object.keys(e).length>0?Tools.setSettings({keybinds:e}):Tools.removeSetting("keybinds")}(),ye=null,!0}return!1},Ne=function(e){for(var t="",s="",a=null,l='<div class="left-binds">',i=0;i<Ee.length;i++)null!=Ee[i][0]&&(""!=Ee[i][0]?(null==(a=we[Ee[i][1]])?(t="&nbsp;",s="&nbsp;"):(""==(t=a[0])&&(t="&nbsp;"),""==(s=1==a.length?"":a[1])&&(s="&nbsp;")),l+='<div class="item"><div class="name">'+Ee[i][0]+'</div><div class="bind'+("&nbsp;"==t?" blank":"")+'" onclick="Input.bindKey(event,\''+Ee[i][1]+"',0)\">"+t+'</div><div class="bind'+("&nbsp;"==s?" blank":"")+'" onclick="Input.bindKey(event,\''+Ee[i][1]+"',1)\">"+s+"</div></div>",15==i&&(l+='</div><div class="right-binds">')):l+='<div class="item empty"></div>');l+="</div>",null==e&&$("#keybinds-list").html(l),Ie={},i=0;var n=0;for(var o in we){for(i=0;i<we[o].length;i++)null!=(n=Me[we[o][i]])&&(Ie[n]=o);null!=Se[o]&&$("#keybind-"+o.toLowerCase()).html(""==we[o]?"&nbsp;":"("+we[o]+")")}};Input.openKeybinds=function(){config.mobile||fe||(UI.closeAllPanels("keybinds"),Ne(),UI.showPanel("#keybinds"),fe=!0)},Input.closeKeybinds=function(){fe&&(UI.hidePanel("#keybinds",fe),fe=!1,ye=null)},Input.update=function(){if(ge&&null!=navigator.getGamepads){var t=navigator.getGamepads();if(null!=t&&null!=t.length&&0!=t.length&&null!=t[0]){var s=t[0];if(!(s.buttons.length<16)){var a=s.buttons[12].pressed,l=s.buttons[13].pressed,i=s.buttons[15].pressed,n=s.buttons[14].pressed,o=s.buttons[0].pressed||s.buttons[2].pressed,r=s.buttons[1].pressed||s.buttons[3].pressed;me.up!=a&&(Ge("UP",a),me.up=a),me.down!=l&&(Ge("DOWN",l),me.down=l),me.right!=i&&(Ge("RIGHT",i),me.right=i),me.left!=n&&(Ge("LEFT",n),me.left=n),me.fire!=o&&(Ge("FIRE",o),me.fire=o),me.special!=r&&(Ge("SPECIAL",r),me.special=r);var u=new e(s.axes[1],s.axes[0]),c=u.length(),p=-u.angle()+Math.PI/2,d=p=(p%de+de)%de;c>.2?(me.forward=!0,Oe(d,c)):(me.forward&&!a&&Ge("UP",!1),me.forward=!1)}}else ge=!1}},Input.unpressKey=function(e){delete ue[e]},Input.keyState=function(e){return oe[e]},Input.clearKeys=function(e){if(game.state===Network.STATE.PLAYING){for(var t of _e)if(oe[t]){if(e&&(re[38]||re[40]||re[37]||re[39]))continue;oe[t]=!1,Fe(t)}for(var s in re)(!e||38!=s&&40!=s&&37!=s&&39!=s)&&(re[s]=!1)}},Input.touchCloseAll=function(){game.state==Network.STATE.LOGIN?(Games.closeDropdowns(),UI.closeLogin()):game.state==Network.STATE.PLAYING&&(UI.closeAllPanels(),UI.closeTooltip())},Input.addTouchRejection=function(e){$(e).on("touchstart",(function(e){e.stopPropagation()})),$(e).on("touchmove",(function(e){e.preventDefault(),e.stopPropagation()}))},Input.setupLogin=function(){$(window).on("touchstart",(function(e){Input.touchCloseAll(),e.preventDefault()})),Input.addTouchRejection("#logon,#big-message,#loginselector")},Input.setupTouch=function(){$(window).on("touchcancel",(function(e){null!=he&&he.processOnEnd(e)})),Input.addTouchRejection("#settings,#sidebar,#roomnamecontainer,#menu,#gameselector,#mainmenu,#scoredetailed,#invitefriends,#msg-alert,#msg-information"),$("body").append('<div id="touch-joystick"></div><div id="touch-fire"><div class="circle"></div></div><div id="touch-special"><div class="circle"></div></div>'),$("#touch-fire").on("touchstart",(function(e){Ge("FIRE",!0),$("#touch-fire > .circle").css({"background-color":"rgba(255, 255, 255, 0.5)"}),e.preventDefault()})),$("#touch-fire").on("touchend",(function(e){Ge("FIRE",!1),$("#touch-fire > .circle").css({"background-color":"rgba(255, 255, 255, 0.2)"}),e.preventDefault()})),$("#touch-special").on("touchstart",(function(e){Ge("SPECIAL",!0),$("#touch-special > .circle").css({"background-color":"rgba(255, 255, 255, 0.5)"}),e.preventDefault()})),$("#touch-special").on("touchend",(function(e){Ge("SPECIAL",!1),$("#touch-special > .circle").css({"background-color":"rgba(255, 255, 255, 0.2)"}),e.preventDefault()}));var e={zone:$("#touch-joystick")[0],mode:"static",position:{bottom:"50%",left:"50%"}};(he=nipplejs.create(e)).on("end",Input.touchEnd),he.on("move",Input.touchMove)},Input.toggleMouse=function(e){if(!config.mobile)if($(window).off("mousedown"),$(window).off("mouseup"),config.mouse=!config.mouse,config.mouse){if($(window).on("mousedown",Input.mouseDown),$(window).on("mouseup",Input.mouseUp),e)return;UI.showMessage("alert",'<span class="info">MOUSE MODE</span>Enabled<div class="mousemode"><span class="info">LEFT CLICK</span>Fire&nbsp;&nbsp;&nbsp;<span class="info">RIGHT CLICK</span>Special&nbsp;&nbsp;&nbsp;<span class="info">WASD</span>Move</div>',7e3),Tools.setSettings({mousemode:!0})}else UI.showMessage("alert",'<span class="info">MOUSE MODE</span>Disabled',3e3),Tools.removeSetting("mousemode")},Input.mouseDown=function(e){var t=e.originalEvent;if((0==t.button||2==t.button)&&null!=t.target.tagName&&"canvas"==t.target.tagName.toLowerCase()){var s=0==t.button?"FIRE":"SPECIAL";Ge(s,!0),e.preventDefault()}},Input.mouseUp=function(e){var t=e.originalEvent;if(0==t.button||2==t.button)if(null!=t.target.tagName&&"canvas"==t.target.tagName.toLowerCase()){var s=0==t.button?"FIRE":"SPECIAL";Ge(s,!1),e.preventDefault()}else Ge("FIRE",!1),Ge("SPECIAL",!1)};var Ge=function(e,t){(oe[e]==!t||t&&null==oe[e])&&(Network.sendKey(e,t),oe[e]=t)},Oe=function(e,t){var s=Players.getMe();if(null!=s){var a=e-s.rot;a>Math.PI&&(a-=2*Math.PI),a<-Math.PI&&(a+=2*Math.PI);var l=Math.round(Math.abs(a)/(60*config.ships[s.type].turnFactor)*1e3);if(!((l-=Math.round(game.ping))<10||game.time-pe<100)){null!=ce&&clearTimeout(ce),pe=game.time;var i=a>0?"RIGHT":"LEFT",n=a<=0?"RIGHT":"LEFT";Ge("UP",!(null!=t&&t<.5)),Ge(i,!0),Ge(n,!1),ce=setTimeout((function(){Ge(i,!1)}),l)}}};Input.touchMove=function(e,t){var s=-t.angle.radian+Math.PI/2,a=s=(s%de+de)%de;Oe(a,t.force)},Input.touchEnd=function(e,t){Ge("UP",!1),Ge("LEFT",!1),Ge("RIGHT",!1)},Input.gameFocus=function(){game.focus=!0},Input.gameBlur=function(){game.focus=!1,Input.clearKeys()};var De=function(e){if(3==game.myType&&("STRAFELEFT"===e||"STRAFERIGHT"===e))return De("SPECIAL"),void De("STRAFELEFT"===e?"LEFT":"RIGHT");-1!==Pe.indexOf(e)&&Network.sendKey(e,!0)},Fe=function(e){3!=game.myType||"STRAFELEFT"!==e&&"STRAFERIGHT"!==e?-1!==_e.indexOf(e)&&Network.sendKey(e,!1):(Fe("STRAFELEFT"===e?"LEFT":"RIGHT"),oe["STRAFERIGHT"===e?"STRAFELEFT":"STRAFERIGHT"]||Fe("SPECIAL"))};const $e=class{constructor(t,s){t.type==MobType.PredatorMissile&&window.forceCarrot&&(t.type=MobType.CarrotMissile),this.id=t.id,this.type=t.type,this.pos=new e(t.posX,t.posY),this.spriteRot=0,this.missile=MissileMobTypeSet[this.type],this.missile&&t.c!==Network.SERVERPACKET.MOB_UPDATE_STATIONARY?(this.speed=new e(t.speedX,t.speedY),this.accel=new e(t.accelX,t.accelY),this.maxSpeed=t.maxSpeed,this.exhaust=config.mobs[this.type].exhaust,this.lastAccelX=0,this.lastAccelY=0,this.stationary=!1,this.spriteRot=this.speed.angle()+Math.PI):this.stationary=!0,this.sprites={},this.state={inactive:!1,despawnTicker:0,despawnType:0,baseScale:1,baseScaleShadow:1,luminosity:1},this.randomness=Tools.rand(0,1e5),this.culled=!1,this.visibility=!0,this.reducedFactor=!1,this.forDeletion=!1,this.spawnTime=game.time,this.lastPacket=game.timeNetwork,this.ownerId=s,this.setupSprite()}setupSprite(){switch(MissileMobTypeSet[this.type]&&(this.sprites.thrusterGlow=Textures.init("thrusterGlowSmall",{layer:"projectiles"}),this.sprites.smokeGlow=Textures.init("smokeGlow",{layer:"projectiles"}),this.sprites.thruster=Textures.init("missileThruster")),this.type){case MobType.PredatorMissile:case MobType.TornadoSingleMissile:case MobType.TornadoTripleMissile:case MobType.ProwlerMissile:this.sprites.sprite=Textures.init("missile"),this.sprites.shadow=Textures.init("missileShadow",{scale:[.25,.2]}),this.sprites.thrusterGlow.scale.set(3,2),this.sprites.thrusterGlow.alpha=.2,this.sprites.smokeGlow.scale.set(1.5,3),this.sprites.smokeGlow.alpha=.75;break;case MobType.GoliathMissile:case MobType.CarrotMissile:this.type==MobType.GoliathMissile?this.sprites.sprite=Textures.init("missileFat"):this.sprites.sprite=Textures.init("missileCarrot"),this.sprites.shadow=Textures.init("missileShadow",{scale:[.5,.25]}),this.sprites.thrusterGlow.scale.set(4,3),this.sprites.thrusterGlow.alpha=.25,this.sprites.smokeGlow.scale.set(2.5,3),this.sprites.smokeGlow.alpha=.75;break;case MobType.MohawkMissile:this.sprites.sprite=Textures.init("missileSmall",{scale:[.28,.2]}),this.sprites.shadow=Textures.init("missileShadow",{scale:[.18,.14]}),this.sprites.thrusterGlow.scale.set(3,2),this.sprites.thrusterGlow.alpha=.2,this.sprites.smokeGlow.scale.set(1,2),this.sprites.smokeGlow.alpha=.75;break;case MobType.Upgrade:case MobType.Shield:case MobType.Inferno:case MobType.MagicCrate:var e=CrateTextureNameByMobType[this.type];this.state.baseScale=.33,this.state.baseScaleShadow=2.4/config.shadowScaling*.33,this.sprites.sprite=Textures.init(e,{scale:this.state.baseScale}),this.sprites.shadow=Textures.init("crateShadow",{scale:this.state.baseScaleShadow})}this.setTeamColourOnMissiles()}setTeamColourOnMissiles(){if(game.gameType==GameType.CTF||game.server.config.tdmMode)switch(this.type){case MobType.PredatorMissile:case MobType.TornadoSingleMissile:case MobType.TornadoTripleMissile:case MobType.ProwlerMissile:case MobType.GoliathMissile:case MobType.MohawkMissile:let e=1==Players.getMe().team?2:1;if(this.ownerId){let t=Players.get(this.ownerId);t&&(e=t.team)}this.sprites.smokeGlow.tint=this.sprites.sprite.tint=this.sprites.thruster.tint=1==e?3289850:15352386}else if(game.gameType==GameType.FFA)switch(this.type){case MobType.PredatorMissile:case MobType.TornadoSingleMissile:case MobType.TornadoTripleMissile:case MobType.ProwlerMissile:case MobType.GoliathMissile:case MobType.MohawkMissile:if(this.ownerId){let e=Players.get(this.ownerId);e&&e.in_my_team&&(this.sprites.smokeGlow.tint=this.sprites.sprite.tint=this.sprites.thruster.tint=3289850)}}}despawn(e){if(this.state.inactive=!0,this.state.despawnTicker=0,CrateMobTypeSet[this.type])return this.state.despawnType=e,void(e==MobDespawnType.Collided&&this.type!=MobType.Upgrade&&Sound.powerup(this.type,this.pos));this.sprites.thruster.renderable=!1,this.sprites.thrusterGlow.renderable=!1,this.sprites.smokeGlow.renderable=!1,this.accel.x=0,this.accel.y=0,this.missile&&Sound.updateThruster(1,this,!1)}destroy(e){switch(this.type){case MobType.PredatorMissile:case MobType.GoliathMissile:case MobType.CarrotMissile:case MobType.MohawkMissile:case MobType.TornadoSingleMissile:case MobType.TornadoTripleMissile:case MobType.ProwlerMissile:game.graphics.layers.projectiles.removeChild(this.sprites.sprite),game.graphics.layers.shadows.removeChild(this.sprites.shadow),game.graphics.layers.thrusters.removeChild(this.sprites.thruster),game.graphics.layers.projectiles.removeChild(this.sprites.thrusterGlow),game.graphics.layers.projectiles.removeChild(this.sprites.smokeGlow),this.sprites.sprite.destroy(),this.sprites.shadow.destroy(),this.sprites.thruster.destroy(),this.sprites.thrusterGlow.destroy(),this.sprites.smokeGlow.destroy();break;case MobType.Upgrade:case MobType.Shield:case MobType.Inferno:case MobType.MagicCrate:game.graphics.layers.crates.removeChild(this.sprites.sprite),game.graphics.layers.shadows.removeChild(this.sprites.shadow)}e.c===Network.SERVERPACKET.MOB_DESPAWN_COORDS&&(Mobs.explosion(this.pos,e.type),this.missile&&Sound.updateThruster(1,this,!1))}network(e,t){this.lastPacket=game.timeNetwork,e.c===Network.SERVERPACKET.MOB_UPDATE&&(this.reducedFactor=Tools.reducedFactor()),this.pos.x=e.posX,this.pos.y=e.posY,null!=e.speedX&&(this.speed.x=e.speedX,this.speed.y=e.speedY),null!=e.accelX&&(this.accel.x=e.accelX,this.accel.y=e.accelY),t&&(this.ownerId=t,this.setTeamColourOnMissiles())}visible(e){e==this.visibility&&e!=this.culled||(this.sprites.sprite.visible=e,this.sprites.shadow.visible=e,MissileMobTypeSet[this.type]&&(this.sprites.thruster.visible=e,this.sprites.thrusterGlow.visible=e),this.visibility=e)}visibilityUpdate(){this.culled=!Graphics.inScreen(this.pos,128),this.visible(!this.culled)}update(e){if(this.visibilityUpdate(),!(!1!==this.reducedFactor&&(e-=this.reducedFactor,this.reducedFactor=!1,e<=0))){var t,s,a,l=e>.51?Math.round(e):1,i=e/l;for(t=0;t<l;t++)if(this.stationary)this.clientCalcs(i);else{s=this.speed.x,a=this.speed.y,this.speed.x+=this.accel.x*i,this.speed.y+=this.accel.y*i;var n=this.speed.length();n>this.maxSpeed&&this.speed.multiply(this.maxSpeed/n),this.state.inactive&&this.speed.multiply(1-.03*i),this.pos.x+=i*s+.5*(this.speed.x-s)*i,this.pos.y+=i*a+.5*(this.speed.y-a)*i,this.pos.x<-16384&&(this.pos.x+=32768),this.pos.x>16384&&(this.pos.x-=32768),this.pos.y<-8192&&(this.pos.y+=16384),this.pos.y>8192&&(this.pos.y-=16384),this.clientCalcs(i)}this.missile&&!this.state.inactive&&Sound.updateThruster(1,this,this.visibility)}}clientCalcs(e){if(!this.forDeletion)switch(this.state.luminosity-=.075*e,this.state.luminosity<0&&(this.state.luminosity=0),this.type){case MobType.PredatorMissile:case MobType.GoliathMissile:case MobType.CarrotMissile:case MobType.MohawkMissile:case MobType.TornadoSingleMissile:case MobType.TornadoTripleMissile:case MobType.ProwlerMissile:var t=1;if(this.state.inactive){if(this.state.despawnTicker+=.01*e,this.state.despawnTicker>.75){var s=1-4*(this.state.despawnTicker-.75);this.sprites.sprite.alpha=s,this.sprites.shadow.alpha=s}if(this.state.despawnTicker>1)return void(this.forDeletion=!0);t=Tools.clamp(1-this.state.despawnTicker,.3,1)}if(!this.culled&&t>.3){var a;this.type==MobType.CarrotMissile&&(a=40704);var l=this.speed.angle()+Math.PI;l-this.spriteRot>=Math.PI?this.spriteRot+=2*Math.PI:this.spriteRot-l>Math.PI&&(this.spriteRot-=2*Math.PI),this.spriteRot=Tools.converge(this.spriteRot,l,.1*e),Particles.missileSmoke(this,this.exhaust,t,a)}break;case MobType.Upgrade:case MobType.Shield:case MobType.Inferno:case MobType.MagicCrate:if(this.state.inactive&&(this.state.despawnTicker+=.05*e,this.state.despawnTicker>1))return void(this.forDeletion=!0)}}updateGraphics(e){var t=config.mobs[this.type];switch(this.type){case MobType.PredatorMissile:case MobType.GoliathMissile:case MobType.CarrotMissile:case MobType.MohawkMissile:case MobType.TornadoSingleMissile:case MobType.TornadoTripleMissile:case MobType.ProwlerMissile:var s=Graphics.shadowCoords(this.pos),a=Tools.oscillator(.1,.5,this.randomness),l=Tools.oscillator(.15,10,this.randomness);Graphics.transform(this.sprites.sprite,this.pos.x,this.pos.y,this.spriteRot),Graphics.transform(this.sprites.shadow,s.x,s.y,this.spriteRot),Graphics.transform(this.sprites.thrusterGlow,this.pos.x+Math.sin(-this.spriteRot)*(this.exhaust+20),this.pos.y+Math.cos(-this.spriteRot)*(this.exhaust+20),null,null,null,(.5*(t.thrusterGlowAlpha||1)*this.state.luminosity+.2)*l),Graphics.transform(this.sprites.smokeGlow,this.pos.x+Math.sin(-this.spriteRot)*(this.exhaust+20),this.pos.y+Math.cos(-this.spriteRot)*(this.exhaust+20),this.spriteRot,void 0,void 0,t.smokeGlowAlpha),Graphics.transform(this.sprites.thruster,this.pos.x+Math.sin(-this.spriteRot)*this.exhaust,this.pos.y+Math.cos(-this.spriteRot)*this.exhaust,this.spriteRot,t.thruster[0]*a,t.thruster[1]*a,t.thrusterAlpha);break;case MobType.Upgrade:case MobType.Shield:case MobType.Inferno:case MobType.MagicCrate:var i;s=Graphics.shadowCoords(this.pos),i=0==this.state.despawnType?1-this.state.despawnTicker:1+2*this.state.despawnTicker,i*=Tools.oscillator(.08,500,this.randomness),Graphics.transform(this.sprites.sprite,this.pos.x,this.pos.y+20*(Tools.oscillator(.08,330,this.randomness)-1.04),null,this.state.baseScale*i,this.state.baseScale*i,1-this.state.despawnTicker),Graphics.transform(this.sprites.shadow,s.x,s.y,null,this.state.baseScaleShadow*i,this.state.baseScaleShadow*i,1-this.state.despawnTicker)}}};var He={},Ye=[],Be={};let Xe=[];Mobs.add=function(e,t,s){He[e.id]=new $e(e,s),t&&He[e.id].network(e)},Mobs.update=function(){var e,t;for(e in He)(t=He[e]).update(game.timeFactor),t.forDeletion?Mobs.destroy(t):t.updateGraphics(game.timeFactor)},Mobs.network=function(e,t){var s=He[e.id];null==s?Mobs.add(e,!0,t):s.network(e,t)},Mobs.despawn=function(e){var t=He[e.id];null!=t&&t.despawn(e.type)},Mobs.destroy=function(e){var t=He[e.id];null!=t&&(t.destroy(e),delete He[e.id])},Mobs.explosion=function(e,t){switch(t){case MobType.PredatorMissile:case MobType.TornadoSingleMissile:case MobType.TornadoTripleMissile:case MobType.ProwlerMissile:Particles.explosion(e,Tools.rand(1,1.2));break;case MobType.GoliathMissile:Particles.explosion(e,Tools.rand(1.3,1.6));break;case MobType.MohawkMissile:case MobType.CarrotMissile:Particles.explosion(e,Tools.rand(.8,1))}Sound.mobExplosion(e,t)},Mobs.count=function(){let e=0,t=0;for(var s in He)e++,He[s].culled&&t++;return[e-t,e]},Mobs.mobs=function(){return He},Mobs.wipe=function(){for(var e in He)He[e].destroy({}),delete He[e]},Mobs.countDoodads=function(){return[Ye.length,Xe.length]},Mobs.setupDoodads=function(){Mobs.removeDoodads(),Xe=JSON.parse(JSON.stringify(config.doodads.concat(config.groundDoodads)));for(var e=0;e<Xe.length;e++)Mobs.addDoodad(Xe[e]);Tools.initBuckets(Xe)},Mobs.addDoodad=function(e){var t=Number.isInteger(e[2]),s=Textures.init((t?"mountain":"")+e[2]);s.scale.set(e[3]),s.position.set(e[0],e[1]),s.visible=!1,e[4]&&(s.rotation=e[4]),e[5]&&(s.alpha=e[5]),e[6]&&(s.tint=e[6]),e[7]=!1,e[8]=s,e[9]=t?0:1},Mobs.getClosestDoodad=function(e){for(var t,s,a=2,l=0;l<Ye.length;l++)0==(s=Ye[l])[5]&&Tools.distFastCheckFloat(e.x,e.y,s[0],s[1],256*s[3])&&(t=Tools.distance(e.x,e.y,s[0],s[1])/(256*s[3]))<a&&(a=t);return Tools.clamp(3.333*(a-.5),.2,1)},Mobs.updateDoodads=function(){for(var t,s=Tools.getBucketBounds(Graphics.getCamera(),512+game.halfScreenX/game.scale,512+game.halfScreenY/game.scale),a=s[0];a<=s[1];a++)for(var l=s[2];l<=s[3];l++)for(var i=0;i<game.buckets[a][l][0].length;i++){const s=game.buckets[a][l][0][i];t=Xe[s];const[n,o,r,u,,,,,c,p]=t;(game.state==Network.STATE.LOGIN&&!p||Graphics.inScreen(new e(n,o),256*u+config.overdraw))&&(t[7]||(c.visible=!0,t[7]=!0,Be[s]||(Be[s]=!0,Ye.push([n,o,r,u,s,p]))))}for(let t=Ye.length-1;t>=0;t--){const s=Ye[t][4],a=Xe[s];Graphics.inScreen(new e(a[0],a[1]),256*a[3]+config.overdraw)||a[7]&&(a[8].visible=!1,a[7]=!1,Ye.splice(t,1),delete Be[s])}},Mobs.removeDoodads=function(e){for(let t=0;t<Xe.length;t++){if(!Xe[t])continue;let[,,s,,,,,,a,l]=Xe[t];e&&l||(game.graphics.layers.doodads.removeChild(a),a.destroy(),Xe[t]=null)}for(let e=Ye.length-1;e>=0;e--){const t=Ye[e][4];Xe[t]||(Ye.splice(e,1),delete Be[t])}Tools.initBuckets(Xe)};var ze=null,Ke=null,We=!1,Ve="",je=!1,Je=null,Ze=-1,qe=-1,Qe=0,et={},tt=0,st=0,at=0,lt=!1;Network.sendKey=function(e,t){if(game.state==Network.STATE.PLAYING){st++;var s={c:bt.KEY,seq:st,key:ft[e],state:t};null!=game.spectatingID&&t&&("RIGHT"==e?Network.spectatePrev():"LEFT"==e&&Network.spectateNext()),mt(s),Ke&&We&&mt(s,!0)}},Network.sendChat=function(e){game.state==Network.STATE.PLAYING&&mt({c:bt.CHAT,text:e})},Network.sendWhisper=function(e,t){game.state==Network.STATE.PLAYING&&mt({c:bt.WHISPER,id:e,text:t})},Network.sendSay=function(e){game.state==Network.STATE.PLAYING&&mt({c:bt.SAY,text:e})},Network.sendTeam=function(e){game.state==Network.STATE.PLAYING&&mt({c:bt.TEAMCHAT,text:e})},Network.sendCommand=function(e,t){game.state==Network.STATE.PLAYING&&("flag"===e&&(game.lastFlagSet=t),mt({c:bt.COMMAND,com:e,data:t}))},Network.voteMute=function(e){game.state==Network.STATE.PLAYING&&mt({c:bt.VOTEMUTE,id:e})},Network.force=function(t){Players.network(vt.PLAYER_UPDATE,t);for(let e of t.players)Players.network(vt.PLAYER_UPDATE,e);for(let e of t.mobs)Mobs.network(e,t.id);let s=new e(t.posX,t.posY);Particles.spiritShockwave(s),Sound.effectRepel(s)},Network.getScores=function(){game.state==Network.STATE.PLAYING&&mt({c:bt.SCOREDETAILED})},Network.resizeHorizon=function(){game.state==Network.STATE.PLAYING&&mt({c:bt.HORIZON,horizonX:Math.ceil(game.halfScreenX/game.scale),horizonY:Math.ceil(game.halfScreenY/game.scale)})},Network.detectConnectivity=function(){game.lagging=game.timeNetwork-at>1300},Network.shutdown=function(){null!=Je&&clearInterval(Je),null!=ze&&ze.close(),null!=Ke&&Ke.close(),We=!1,je=!1,Ze=-1,qe=-1,Qe=0,et={},tt=0,st=0,at=0,lt=!1},Network.receivedError=function(e){lt=e},Network.spectateNext=function(){game.state==Network.STATE.PLAYING&&Network.sendCommand("spectate","-1")},Network.spectatePrev=function(){game.state==Network.STATE.PLAYING&&Network.sendCommand("spectate","-2")},Network.spectateForce=function(){game.state==Network.STATE.PLAYING&&(Players.amIAlive()?Network.sendCommand("spectate","-3"):Network.spectateNext())};var it=function(){game.lagging||game.state==Network.STATE.PLAYING&&(je?Ke&&We&&mt({c:bt.ACK},!0):mt({c:bt.ACK}),je=!je)},nt=function(e){Math.abs(e-Ze)>36e5&&(Ze=e,qe=performance.now(),Qe=0)},ot=function(t){if(game.state==Network.STATE.PLAYING||t.c==vt.LOGIN||t.c==vt.ERROR){if((t.c==vt.PLAYER_UPDATE||t.c==vt.PLAYER_FIRE||t.c==vt.EVENT_BOOST||t.c==vt.EVENT_BOUNCE)&&t.id==game.myID||t.c==vt.PING){if(t.c!=vt.PING&&pt(t))return;game.timeNetwork=performance.now(),at=game.timeNetwork,function(e){if(game.jitter=0,-1!=Ze){nt(e);var t=game.timeNetwork,s=e-Ze-(t-qe),a=s-(Qe=.8*Qe+s/5);Math.abs(a)<100&&(game.jitter=a)}}(t.clock/100)}else game.timeNetwork=performance.now(),at=game.timeNetwork,null!=t.clock&&(a=t.clock/100,-1!=Ze&&(nt(a),game.jitter=a-Ze-(game.timeNetwork-qe)-Qe));switch(t.c){case vt.PLAYER_UPDATE:case vt.PLAYER_FIRE:case vt.CHAT_SAY:case vt.PLAYER_RESPAWN:case vt.PLAYER_FLAG:case vt.EVENT_BOOST:case vt.EVENT_BOUNCE:if(Players.network(t.c,t),t.c===vt.PLAYER_FIRE){for(let e of t.projectiles)e.c=vt.PLAYER_FIRE,Mobs.add(e,!1,t.id);t.projectiles.length>0&&Sound.missileLaunch(new e(t.projectiles[0].posX,t.projectiles[0].posY),t.projectiles[0].type)}break;case vt.LOGIN:!function(e){Je=setInterval(it,50),game.myID=e.id,game.myTeam=e.team,game.myToken=e.token,game.state=Network.STATE.PLAYING,game.roomName=UI.escapeHTML(e.room),game.gameType=e.type,game.spectatingID=null,game.myLevel=0,ct(e.serverConfiguration),Games.prep(),Ze=e.clock/100,qe=performance.now(),dt()}(t),UI.loggedIn(t);let a=t.bots?t.bots.map((e=>e.id)):[];for(let e of t.players)e.isBot=a.includes(e.id),Players.add(e,!0);Players.updateFFATeams();break;case vt.ERROR:UI.errorHandler(t);break;case vt.PLAYER_NEW:Players.add(t);break;case vt.PLAYER_LEAVE:Players.destroy(t.id);break;case vt.PLAYER_TYPE:Players.changeType(t);break;case vt.PLAYER_HIT:Players.impact(t),200!=t.type&&Mobs.destroy(t);break;case vt.PLAYER_KILL:Players.kill(t);break;case vt.PLAYER_UPGRADE:UI.updateUpgrades([t.speed,t.defense,t.energy,t.missile],t.upgrades,t.type);break;case vt.PLAYER_POWERUP:Players.powerup(t);break;case vt.PLAYER_LEVEL:Players.updateLevel(t);break;case vt.PLAYER_RETEAM:Players.reteam(t);break;case vt.EVENT_REPEL:Network.force(t);break;case vt.EVENT_LEAVEHORIZON:0==t.type?Players.leaveHorizon(t):Mobs.destroy(t);break;case vt.EVENT_STEALTH:Players.stealth(t);break;case vt.MOB_UPDATE:case vt.MOB_UPDATE_STATIONARY:Mobs.network(t,t.ownerId);break;case vt.MOB_DESPAWN:Mobs.despawn(t);break;case vt.MOB_DESPAWN_COORDS:Mobs.destroy(t);break;case vt.GAME_FLAG:Games.networkFlag(t);break;case vt.GAME_PLAYERSALIVE:Games.playersAlive(t.players);break;case vt.SCORE_UPDATE:UI.newScore(t);break;case vt.SCORE_BOARD:UI.scoreboardUpdate(t.data,t.rankings,config.maxScoreboard),Players.updateBadges(t.data);break;case vt.SCORE_DETAILED:case vt.SCORE_DETAILED_CTF:case vt.SCORE_DETAILED_BTR:UI.updateScore(t);break;case vt.PING:s=t.num,mt({c:bt.PONG,num:s});break;case vt.PING_RESULT:UI.updateStats(t);break;case vt.CHAT_PUBLIC:if(config.mobile)return;Players.chat(t);break;case vt.CHAT_TEAM:if(config.mobile)return;Players.teamChat(t);break;case vt.CHAT_WHISPER:if(config.mobile)return;Players.whisper(t);break;case vt.CHAT_VOTEMUTEPASSED:if(config.mobile)return;Players.votemutePass(t);break;case vt.CHAT_VOTEMUTED:if(config.mobile)return;return void UI.chatMuted();case vt.SERVER_MESSAGE:UI.serverMessage(t);break;case vt.SERVER_CUSTOM:rt(t);break;case vt.GAME_SPECTATE:Games.spectate(t.id);break;case vt.GAME_FIREWALL:Games.handleFirewall(t);break;case vt.COMMAND_REPLY:UI.showCommandReply(t)}}var s,a},rt=function(e){try{var t=JSON.parse(e.data)}catch(e){return}switch(e.type){case 1:Games.showBTRWin(t);break;case 2:Games.showCTFWin(t);break;case 100:ut(t);break;case 200:const{player_id:e,custom_data:s}=t;s.url&&Players.get(e).changeSkin(s.url,s.hash);break;case 201:const{players:a,skins:l}=t;if(a)for(let{id:e,custom_data:t}of a)t.url&&Players.get(e).changeSkin(t.url,t.hash);else l&&localStorage.setItem("my_skins",JSON.stringify(l));break;case 202:game.myTeam=t.team,game.gameType=t.type,game.force_update_teams=!0,Games.prep()}},ut=function(e){if(e&&e.message&&e.button&&(t=e.server,/^[a-z0-9]+-[a-z0-9]+$/m.test(t))){const t=`${UI.escapeHTML(e.message)}<br><span class="button" onclick="Games.switchGame(&quot;${e.server}&quot;)">${UI.escapeHTML(e.button)}</span>`;UI.showMessage("alert",t,5e3)}var t},ct=function(e){let t={};try{t=JSON.parse(e)}catch(e){}game.server.config=t},pt=function(e){var t=e.c+"_"+e.clock+"_"+e.posX+"_"+e.posY+"_"+e.rot+"_"+e.speedX+"_"+e.speedY,s=performance.now();if(s-tt>15e3){for(var a in et)s-et[a]>3e4&&delete et[a];tt=s}return null!=et[t]||(et[t]=s,!1)};Network.reconnectMessage=function(){game.reloading||UI.showMessage("alert",'<span class="info">DISCONNECTED</span>Connection reset<br><span class="button" onclick="Network.reconnect()">RECONNECT</span>',6e5)},Network.reconnect=function(){UI.showMessage("alert","",100),Games.switchGame()},Network.setup=function(){Ve=DEVELOPMENT&&(game.customServerUrl||game.playHost.includes("127.0.0.1"))?game.customServerUrl||"ws://"+game.playHost+"/"+game.playPath:"wss://"+game.playHost+"/"+game.playPath,config.debug.mock_server&&function(){mt=function(e,t){t?Ke.send(e):ze.send(e)},gt=function(e){return e};let e=0;window.WebSocket=class{constructor(t){if(console.log("WebSocket",e,t),1===e?this.backup=!0:e>1&&(e=0),e++,t.includes("ffa"))this.type=window.GameType.FFA;else if(t.includes("ctf"))this.type=window.GameType.CTF;else{if(!t.includes("btr"))throw"todo";this.type=window.GameType.BTR}}set onopen(e){setTimeout(e,100)}set onclose(e){}set onerror(e){}set onmessage(e){this.callback=e}send(e){if(5!==e.c&&console.log("send"+(this.backup?"(backup)":""),e),5===e.c);else if(0===e.c){let e={c:0,success:!0,id:1033,team:1033,clock:100*performance.now(),token:"49b2d1793d1d2e68",type:this.type,room:"ab-ffa",players:[{id:1033,status:0,level:0,name:"a",type:1,team:1033,posX:2193,posY:-1814,rot:0,flag:11,upgrades:8}],serverConfiguration:'{"sf":5500,"botsNamePrefix":""}',bots:[]};this.callback({data:e})}}close(){}}}(),Ke&&We&&Ke.close(),(ze=new WebSocket(Ve)).binaryType="arraybuffer",ze.onopen=function(){let e={};config.auth.tokens&&config.auth.tokens.game&&(e.token=config.auth.tokens.game);{const t=localStorage.getItem("my_skins");e.custom_data={url:game.skin,my_skins_len:t&&JSON.parse(t).length}}mt({c:bt.LOGIN,protocol:game.protocol,name:game.myName,session:JSON.stringify(e),horizonX:Math.ceil(game.halfScreenX/game.scale),horizonY:Math.ceil(game.halfScreenY/game.scale),flag:game.myFlag.toUpperCase()})},ze.onclose=function(){null!=Je&&clearInterval(Je),game.state!==Network.STATE.CONNECTING&&(game.server={},game.state=Network.STATE.CONNECTING,!1===lt&&Network.reconnectMessage())},ze.onerror=function(e){console.error("WebSocket error observed:",e),UI.serverMessage({type:1,text:"WebSocket connection failed. Try disabling AdBlock!",duration:3e4})},config.debug.log_packets?ze.onmessage=function(e){let t=gt(e.data);!function(e){e.backup||["PING","PING_RESULT"].includes(It[e.c])||console.log(It[e.c],e)}(t),ot(t)}:ze.onmessage=function(e){ot(gt(e.data))}};var dt=function(){(Ke=new WebSocket(Ve)).binaryType="arraybuffer",Ke.onopen=function(){mt({c:bt.BACKUP,token:game.myToken},!0)},Ke.onclose=function(){We=!1},Ke.onerror=function(e){console.error("WebSocket error observed:",e),UI.serverMessage({type:1,text:"WebSocket connection failed. Try disabling AdBlock!",duration:3e4})},Ke.onmessage=function(e){var t=gt(e.data);t.c===vt.BACKUP&&(We=!0),t.backup=!0,ot(t)}},ht=function(e,t){var s,a=1,l=[],i=wt[e.c];if(null==i)return null;for(s=0;s<i.length;s++)switch(i[s][1]){case yt.text:var n=Tools.encodeUTF8(e[i[s][0]]);l.push(n),a+=1+n.length;break;case yt.array:case yt.arraysmall:break;case yt.uint8:a+=1;break;case yt.uint16:a+=2;break;case yt.uint32:case yt.float32:a+=4;break;case yt.float64:a+=8;break;case yt.boolean:a+=1}var o=new ArrayBuffer(a),r=new DataView(o),u=0,c=1;for(r.setUint8(0,e.c,!0),s=0;s<i.length;s++)switch(i[s][1]){case yt.text:var p=l[u].length;r.setUint8(c,p,!0),c+=1;for(var d=0;d<p;d++)r.setUint8(c+d,l[u][d],!0);l[u],u++,c+=p;break;case yt.array:case yt.arraysmall:break;case yt.uint8:r.setUint8(c,e[i[s][0]],!0),c+=1;break;case yt.uint16:r.setUint16(c,e[i[s][0]],!0),c+=2;break;case yt.uint32:r.setUint32(c,e[i[s][0]],!0),c+=4;break;case yt.float32:r.setFloat32(c,e[i[s][0]],!0),c+=4;break;case yt.float64:r.setFloat64(c,e[i[s][0]],!0),c+=8;break;case yt.boolean:r.setUint8(c,!1===e[i[s][0]]?0:1),c+=1}return o},gt=function(e,t){var s=new DataView(e),a={c:s.getUint8(0,!0)},l=1,i=Tt[a.c];if(null==i)return null;try{for(var n=0;n<i.length&&!(l>=s.byteLength);n++){var o=i[n][0];switch(i[n][1]){case yt.text:case yt.textbig:if(i[n][1]==yt.text){var r=s.getUint8(l,!0);l+=1}else r=s.getUint16(l,!0),l+=2;for(var u=new Uint8Array(r),c=0;c<r;c++)u[c]=s.getUint8(l+c,!0);var p=Tools.decodeUTF8(u);a[o]=p,l+=r;break;case yt.array:case yt.arraysmall:if(i[n][1]==yt.arraysmall){var d=s.getUint8(l,!0);l+=1}else d=s.getUint16(l,!0),l+=2;a[o]=[];for(var h=i[n][2],g=0;g<d;g++){for(var m={},f=0;f<h.length;f++){var y=h[f][0];switch(h[f][1]){case yt.text:case yt.textbig:for(h[f][1]==yt.text?(r=s.getUint8(l,!0),l+=1):(r=s.getUint16(l,!0),l+=2),u=new Uint8Array(r),c=0;c<r;c++)u[c]=s.getUint8(l+c,!0);p=Tools.decodeUTF8(u),m[y]=p,l+=r;break;case yt.uint8:m[y]=s.getUint8(l,!0),l+=1;break;case yt.uint16:m[y]=s.getUint16(l,!0),l+=2;break;case yt.uint24:var b=256*s.getUint16(l,!0);l+=2,a[y]=b+s.getUint8(l,!0),l+=1;break;case yt.uint32:m[y]=s.getUint32(l,!0),l+=4;break;case yt.float32:m[y]=s.getFloat32(l,!0),l+=4;break;case yt.float64:m[y]=s.getFloat64(l,!0),l+=8;break;case yt.boolean:m[y]=0!=s.getUint8(l,!0),l+=1;break;case yt.speed:m[y]=Tools.decodeSpeed(s.getUint16(l,!0)),l+=2;break;case yt.accel:m[y]=Tools.decodeAccel(s.getUint16(l,!0)),l+=2;break;case yt.coordx:m[y]=Tools.decodeCoordX(s.getUint16(l,!0)),l+=2;break;case yt.coordy:m[y]=Tools.decodeCoordY(s.getUint16(l,!0)),l+=2;break;case yt.coord24:b=256*s.getUint16(l,!0),l+=2,a[y]=Tools.decodeCoord24(b+s.getUint8(l,!0)),l+=1;break;case yt.rotation:m[y]=Tools.decodeRotation(s.getUint16(l,!0)),l+=2;break;case yt.regen:m[y]=Tools.decodeRegen(s.getUint16(l,!0)),l+=2;break;case yt.healthnergy:m[y]=Tools.decodeHealthnergy(s.getUint8(l,!0)),l+=1}}a[o].push(m)}break;case yt.uint8:a[o]=s.getUint8(l,!0),l+=1;break;case yt.uint16:a[o]=s.getUint16(l,!0),l+=2;break;case yt.uint24:b=256*s.getUint16(l,!0),l+=2,a[o]=b+s.getUint8(l,!0),l+=1;break;case yt.uint32:a[o]=s.getUint32(l,!0),l+=4;break;case yt.float32:a[o]=s.getFloat32(l,!0),l+=4;break;case yt.float64:a[o]=s.getFloat64(l,!0),l+=8;break;case yt.boolean:a[o]=0!=s.getUint8(l,!0),l+=1;break;case yt.speed:a[o]=Tools.decodeSpeed(s.getUint16(l,!0)),l+=2;break;case yt.accel:a[o]=Tools.decodeAccel(s.getUint16(l,!0)),l+=2;break;case yt.coordx:a[o]=Tools.decodeCoordX(s.getUint16(l,!0)),l+=2;break;case yt.coordy:a[o]=Tools.decodeCoordY(s.getUint16(l,!0)),l+=2;break;case yt.coord24:b=256*s.getUint16(l,!0),l+=2,a[o]=Tools.decodeCoord24(b+s.getUint8(l,!0)),l+=1;break;case yt.rotation:a[o]=Tools.decodeRotation(s.getUint16(l,!0)),l+=2;break;case yt.regen:a[o]=Tools.decodeRegen(s.getUint16(l,!0)),l+=2;break;case yt.healthnergy:a[o]=Tools.decodeHealthnergy(s.getUint8(l,!0)),l+=1;break;default:return null}}}catch(e){}return a},mt=function(e,t){t?Ke.send(ht(e)):ze.send(ht(e))},ft={UP:1,DOWN:2,LEFT:3,RIGHT:4,FIRE:5,SPECIAL:6},yt={text:1,textbig:2,array:3,arraysmall:4,uint8:5,uint16:6,uint24:7,uint32:8,float32:9,float64:10,boolean:11,speed:12,accel:13,coordx:14,coordy:15,coord24:16,rotation:17,healthnergy:18,regen:19},bt={LOGIN:0,BACKUP:1,HORIZON:2,ACK:5,PONG:6,KEY:10,COMMAND:11,SCOREDETAILED:12,CHAT:20,WHISPER:21,SAY:22,TEAMCHAT:23,VOTEMUTE:24,LOCALPING:255},wt={[bt.LOGIN]:[["protocol",yt.uint8],["name",yt.text],["session",yt.text],["horizonX",yt.uint16],["horizonY",yt.uint16],["flag",yt.text]],[bt.BACKUP]:[["token",yt.text]],[bt.HORIZON]:[["horizonX",yt.uint16],["horizonY",yt.uint16]],[bt.ACK]:[],[bt.PONG]:[["num",yt.uint32]],[bt.KEY]:[["seq",yt.uint32],["key",yt.uint8],["state",yt.boolean]],[bt.COMMAND]:[["com",yt.text],["data",yt.text]],[bt.SCOREDETAILED]:[],[bt.CHAT]:[["text",yt.text]],[bt.WHISPER]:[["id",yt.uint16],["text",yt.text]],[bt.SAY]:[["text",yt.text]],[bt.TEAMCHAT]:[["text",yt.text]],[bt.VOTEMUTE]:[["id",yt.uint16]],[bt.LOCALPING]:[["auth",yt.uint32]]},vt={LOGIN:0,BACKUP:1,PING:5,PING_RESULT:6,ACK:7,ERROR:8,COMMAND_REPLY:9,PLAYER_NEW:10,PLAYER_LEAVE:11,PLAYER_UPDATE:12,PLAYER_FIRE:13,PLAYER_HIT:14,PLAYER_RESPAWN:15,PLAYER_FLAG:16,PLAYER_KILL:17,PLAYER_UPGRADE:18,PLAYER_TYPE:19,PLAYER_POWERUP:20,PLAYER_LEVEL:21,PLAYER_RETEAM:22,GAME_FLAG:30,GAME_SPECTATE:31,GAME_PLAYERSALIVE:32,GAME_FIREWALL:33,EVENT_REPEL:40,EVENT_BOOST:41,EVENT_BOUNCE:42,EVENT_STEALTH:43,EVENT_LEAVEHORIZON:44,MOB_UPDATE:60,MOB_UPDATE_STATIONARY:61,MOB_DESPAWN:62,MOB_DESPAWN_COORDS:63,CHAT_PUBLIC:70,CHAT_TEAM:71,CHAT_SAY:72,CHAT_WHISPER:73,CHAT_VOTEMUTEPASSED:78,CHAT_VOTEMUTED:79,SCORE_UPDATE:80,SCORE_BOARD:81,SCORE_DETAILED:82,SCORE_DETAILED_CTF:83,SCORE_DETAILED_BTR:84,SERVER_MESSAGE:90,SERVER_CUSTOM:91},Tt={[vt.LOGIN]:[["success",yt.boolean],["id",yt.uint16],["team",yt.uint16],["clock",yt.uint32],["token",yt.text],["type",yt.uint8],["room",yt.text],["players",yt.array,[["id",yt.uint16],["status",yt.uint8],["level",yt.uint8],["name",yt.text],["type",yt.uint8],["team",yt.uint16],["posX",yt.coordx],["posY",yt.coordy],["rot",yt.rotation],["flag",yt.uint16],["upgrades",yt.uint8]]],["serverConfiguration",yt.textbig],["bots",yt.array,[["id",yt.uint16]]]],[vt.BACKUP]:[],[vt.PING]:[["clock",yt.uint32],["num",yt.uint32]],[vt.PING_RESULT]:[["ping",yt.uint16],["playerstotal",yt.uint32],["playersgame",yt.uint32]],[vt.ACK]:[],[vt.ERROR]:[["error",yt.uint8]],[vt.COMMAND_REPLY]:[["type",yt.uint8],["text",yt.textbig]],[vt.PLAYER_NEW]:[["id",yt.uint16],["status",yt.uint8],["name",yt.text],["type",yt.uint8],["team",yt.uint16],["posX",yt.coordx],["posY",yt.coordy],["rot",yt.rotation],["flag",yt.uint16],["upgrades",yt.uint8],["isBot",yt.boolean]],[vt.PLAYER_LEAVE]:[["id",yt.uint16]],[vt.PLAYER_UPDATE]:[["clock",yt.uint32],["id",yt.uint16],["keystate",yt.uint8],["upgrades",yt.uint8],["posX",yt.coord24],["posY",yt.coord24],["rot",yt.rotation],["speedX",yt.speed],["speedY",yt.speed]],[vt.PLAYER_FIRE]:[["clock",yt.uint32],["id",yt.uint16],["energy",yt.healthnergy],["energyRegen",yt.regen],["projectiles",yt.arraysmall,[["id",yt.uint16],["type",yt.uint8],["posX",yt.coordx],["posY",yt.coordy],["speedX",yt.speed],["speedY",yt.speed],["accelX",yt.accel],["accelY",yt.accel],["maxSpeed",yt.speed]]]],[vt.PLAYER_RESPAWN]:[["id",yt.uint16],["posX",yt.coord24],["posY",yt.coord24],["rot",yt.rotation],["upgrades",yt.uint8]],[vt.PLAYER_FLAG]:[["id",yt.uint16],["flag",yt.uint16]],[vt.PLAYER_HIT]:[["id",yt.uint16],["type",yt.uint8],["posX",yt.coordx],["posY",yt.coordy],["owner",yt.uint16],["players",yt.arraysmall,[["id",yt.uint16],["health",yt.healthnergy],["healthRegen",yt.regen]]]],[vt.PLAYER_KILL]:[["id",yt.uint16],["killer",yt.uint16],["posX",yt.coordx],["posY",yt.coordy]],[vt.PLAYER_UPGRADE]:[["upgrades",yt.uint16],["type",yt.uint8],["speed",yt.uint8],["defense",yt.uint8],["energy",yt.uint8],["missile",yt.uint8]],[vt.PLAYER_TYPE]:[["id",yt.uint16],["type",yt.uint8]],[vt.PLAYER_POWERUP]:[["type",yt.uint8],["duration",yt.uint32]],[vt.PLAYER_LEVEL]:[["id",yt.uint16],["type",yt.uint8],["level",yt.uint8]],[vt.PLAYER_RETEAM]:[["players",yt.array,[["id",yt.uint16],["team",yt.uint16]]]],[vt.GAME_FLAG]:[["type",yt.uint8],["flag",yt.uint8],["id",yt.uint16],["posX",yt.coord24],["posY",yt.coord24],["blueteam",yt.uint8],["redteam",yt.uint8]],[vt.GAME_SPECTATE]:[["id",yt.uint16]],[vt.GAME_PLAYERSALIVE]:[["players",yt.uint16]],[vt.GAME_FIREWALL]:[["type",yt.uint8],["status",yt.uint8],["posX",yt.coordx],["posY",yt.coordy],["radius",yt.float32],["speed",yt.float32]],[vt.EVENT_REPEL]:[["clock",yt.uint32],["id",yt.uint16],["posX",yt.coordx],["posY",yt.coordy],["rot",yt.rotation],["speedX",yt.speed],["speedY",yt.speed],["energy",yt.healthnergy],["energyRegen",yt.regen],["players",yt.arraysmall,[["id",yt.uint16],["keystate",yt.uint8],["posX",yt.coordx],["posY",yt.coordy],["rot",yt.rotation],["speedX",yt.speed],["speedY",yt.speed],["energy",yt.healthnergy],["energyRegen",yt.regen],["playerHealth",yt.healthnergy],["playerHealthRegen",yt.regen]]],["mobs",yt.arraysmall,[["id",yt.uint16],["type",yt.uint8],["posX",yt.coordx],["posY",yt.coordy],["speedX",yt.speed],["speedY",yt.speed],["accelX",yt.accel],["accelY",yt.accel],["maxSpeed",yt.speed]]]],[vt.EVENT_BOOST]:[["clock",yt.uint32],["id",yt.uint16],["boost",yt.boolean],["posX",yt.coord24],["posY",yt.coord24],["rot",yt.rotation],["speedX",yt.speed],["speedY",yt.speed],["energy",yt.healthnergy],["energyRegen",yt.regen]],[vt.EVENT_BOUNCE]:[["clock",yt.uint32],["id",yt.uint16],["keystate",yt.uint8],["posX",yt.coord24],["posY",yt.coord24],["rot",yt.rotation],["speedX",yt.speed],["speedY",yt.speed]],[vt.EVENT_STEALTH]:[["id",yt.uint16],["state",yt.boolean],["energy",yt.healthnergy],["energyRegen",yt.regen]],[vt.EVENT_LEAVEHORIZON]:[["type",yt.uint8],["id",yt.uint16]],[vt.MOB_UPDATE]:[["clock",yt.uint32],["id",yt.uint16],["type",yt.uint8],["posX",yt.coordx],["posY",yt.coordy],["speedX",yt.speed],["speedY",yt.speed],["accelX",yt.accel],["accelY",yt.accel],["maxSpeed",yt.speed],["ownerId",yt.uint16]],[vt.MOB_UPDATE_STATIONARY]:[["id",yt.uint16],["type",yt.uint8],["posX",yt.float32],["posY",yt.float32]],[vt.MOB_DESPAWN]:[["id",yt.uint16],["type",yt.uint8]],[vt.MOB_DESPAWN_COORDS]:[["id",yt.uint16],["type",yt.uint8],["posX",yt.coordx],["posY",yt.coordy]],[vt.SCORE_UPDATE]:[["id",yt.uint16],["score",yt.uint32],["earnings",yt.uint32],["upgrades",yt.uint16],["totalkills",yt.uint32],["totaldeaths",yt.uint32]],[vt.SCORE_BOARD]:[["data",yt.array,[["id",yt.uint16],["score",yt.uint32],["level",yt.uint8]]],["rankings",yt.array,[["id",yt.uint16],["x",yt.uint8],["y",yt.uint8]]]],[vt.SCORE_DETAILED]:[["scores",yt.array,[["id",yt.uint16],["level",yt.uint8],["score",yt.uint32],["kills",yt.uint16],["deaths",yt.uint16],["damage",yt.float32],["ping",yt.uint16]]]],[vt.SCORE_DETAILED_CTF]:[["scores",yt.array,[["id",yt.uint16],["level",yt.uint8],["captures",yt.uint16],["score",yt.uint32],["kills",yt.uint16],["deaths",yt.uint16],["damage",yt.float32],["ping",yt.uint16]]]],[vt.SCORE_DETAILED_BTR]:[["scores",yt.array,[["id",yt.uint16],["level",yt.uint8],["alive",yt.boolean],["wins",yt.uint16],["score",yt.uint32],["kills",yt.uint16],["deaths",yt.uint16],["damage",yt.float32],["ping",yt.uint16]]]],[vt.CHAT_TEAM]:[["id",yt.uint16],["text",yt.text]],[vt.CHAT_PUBLIC]:[["id",yt.uint16],["text",yt.text]],[vt.CHAT_SAY]:[["id",yt.uint16],["text",yt.text]],[vt.CHAT_WHISPER]:[["from",yt.uint16],["to",yt.uint16],["text",yt.text]],[vt.CHAT_VOTEMUTEPASSED]:[["id",yt.uint16]],[vt.CHAT_VOTEMUTED]:[],[vt.SERVER_MESSAGE]:[["type",yt.uint8],["duration",yt.uint32],["text",yt.textbig]],[vt.SERVER_CUSTOM]:[["type",yt.uint8],["data",yt.textbig]]};Network.KEYPACKET=ft,Network.KEYLOOKUP={1:"UP",2:"DOWN",3:"LEFT",4:"RIGHT",5:"FIRE",6:"SPECIAL"},Network.CLIENTPACKET=bt,Network.SERVERPACKET=vt,Network.STATE={LOGIN:1,CONNECTING:2,PLAYING:3};const It=Object.keys(vt).reduce(((e,t)=>(e[vt[t]]=t,e)),{});var St={MISSILE:0,MISSILE_FAT:1,MISSILE_SMALL:2,SHOCKWAVE_SMOKE:3,SHOCKWAVE_INNER:4,SHOCKWAVE_OUTER:5,EXPLOSION_FLASH:6,EXPLOSION_FLASH_BIG:7,EXPLOSION_SMOKE:8,EXPLOSION_HOT_SMOKE:9,EXPLOSION_SPARK:10,FRAGMENT_SMOKE:11,PLANE_DAMAGE:12,EMITTER_EXPLOSION_FRAGMENT:100},Et=[null,St.MISSILE,St.MISSILE_FAT,St.MISSILE_SMALL,null,St.MISSILE,St.MISSILE,St.MISSILE,null,null,null,null,St.PLANE_DAMAGE];class kt{constructor(e,t,s,a){this.maxParticles=t,this.container=new PIXI.Container,null!=s&&(this.container.blendMode=s),this.particles=[],this.first=-1,this.last=-1,this.emitters={},this.emitterId=0,this.shadow=a,e.addChild(this.container)}addParticle(e,t,s,a,l,i,n,o,r,u,c,p,d,h){if(!(game.timeFactorUncapped>20||this.particles.length>=this.maxParticles)){var g=Textures.sprite(t),m={type:e,sprite:g,speed:s,pos:a,scale:l,alpha:i,rotationSpeed:n,rotation:o,lastRotation:0,time:game.time,tint:r,life:0,data:null!=d?d:0,emitter:null!=h?h:null,_prev:-1,_next:-1};null!=r&&(g.tint=r),null!=c&&(g.blendMode=c),null!=p&&(m.life=p),null!=u?g.anchor.set(u.x,u.y):g.anchor.set(.5,.5),this.container.addChild(g);var f=this.particles.length;f>0?(this.particles[this.last]._next=f,m._prev=this.last,this.last=f):(this.first=f,this.last=f),this.particles.push(m)}}wipe(){this.emitters={},this.emitterId=0;for(var e=0;e<this.particles.length;e++)this.container.removeChild(this.particles[e].sprite),this.particles[e].sprite.destroy();this.particles=[],this.first=-1,this.last=-1}addEmitter(e,t,s,a,l){game.timeFactorUncapped>20||(this.emitters[this.emitterId]={type:e,pos:s,speed:t,life:null!=a?a:0,shadowLayer:l},this.emitterId++)}updateEmitters(t){for(var s in this.emitters){var a=this.emitters[s];if(a.type===St.EMITTER_EXPLOSION_FRAGMENT&&(a.life+=.02*t,a.speed.multiply(1-.02*t)),a.life>1)delete this.emitters[s];else if(a.pos.x+=a.speed.x*t,a.pos.y+=a.speed.y*t,a.type===St.EMITTER_EXPLOSION_FRAGMENT){var l=Tools.randInt(1,16),i=.5*(1-a.life),n=1-a.life,o=Tools.rand(-.1,.1),r=Tools.randCircle();this.addParticle(St.FRAGMENT_SMOKE,"smoke_"+l,e.zero(),a.pos.clone(),e.diag(i),1,o,r,null,null,null,null,n+.2),a.shadowLayer&&a.shadowLayer.addParticle(St.FRAGMENT_SMOKE,"smokeshadow_"+l,e.zero(),a.pos.clone(),e.diag(i),1,o,r,null,null,null,null,n+.2)}}}destroy(e){var t=this.particles.length;if(0!=t&&!(e>=t)){this.container.removeChild(this.particles[e].sprite),this.particles[e].sprite.destroy();var s=this.particles[e]._prev,a=this.particles[e]._next;return t--,-1!=s?this.particles[s]._next=a:this.first=a,-1!=a?this.particles[a]._prev=s:this.last=s,e!=t&&(this.particles[e]=this.particles[t],-1!=this.particles[e]._prev?this.particles[this.particles[e]._prev]._next=e:this.first=e,-1!=this.particles[e]._next?this.particles[this.particles[e]._next]._prev=e:this.last=e),this.particles.splice(t,1),a==t?e:a}}_updateMissile(e,t){t.type==St.MISSILE?(t.scale.add(.2*e),t.scale.ceil(2*t.data),t.life+=.05*e):t.type==St.MISSILE_FAT?(t.scale.add(.3*e),t.scale.ceil(3*t.data),t.life+=.05*e):(t.scale.add(.14*e),t.scale.ceil(1.4*t.data),t.life+=.08*e),t.speed.multiply(1-.05*e),t.alpha=.7*(1-t.life),t.sprite.tint=Tools.colorLerp(t.tint,16777215,2*(1-t.life))}_updateShockwaveSmoke(e,t){t.life+=.05*e,t.alpha=.7*Tools.easing.custom(t.life,"shockwave")}_updateShockwave(e,t){t.life+=.05*e;var s=Tools.easing.custom(t.life,"shockwave");t.alpha=.4*s,t.type==St.SHOCKWAVE_OUTER?t.scale.both(4*t.life):t.scale.both(3*t.life)}_updateExplosionFlash(e,t){t.life+=.1*e,t.alpha=1-t.life}_updateExplosionFlashBig(e,t){t.life+=.04*e,t.alpha=1-t.life}_updateExplosionHotSmoke(e,t){t.life+=.035*e,t.alpha=1-t.life,t.scale.add(.05*e),t.speed.multiply(1-.1*e),t.rotationSpeed*=1-.05*e}_updateExplosionSmoke(e,t){t.life+=.01*e,t.alpha=Tools.easing.custom(t.life,"explosionSmoke"),t.scale.add(.05*e),t.speed.multiply(1-.05*e),t.rotationSpeed*=1-.05*e}_updateExplosionSpark(e,t){t.life+=.02*e,t.alpha=2*(1-t.life),t.speed.multiply(1-.05*e),t.rotationSpeed*=1-.05*e}_updateFragmentSmoke(e,t){t.life+=.02*e,t.scale.add(.075*e*t.data),t.scale.ceil(2*t.data),t.rotationSpeed*=1-.05*e,t.alpha=.3*(1-t.life)}_updatePlaneDamage(e,t){t.life+=.02*e,t.alpha=2*(1-t.life),t.speed.multiply(1-.1*e)}update(e){this.updateEmitters(e);for(var t=this.first;-1!=t;){var s=this.particles[t],a=this.updateFuncMap[s.type];if(a&&a(e,s),s.life>1)t=this.destroy(t);else{if(s.pos.x+=s.speed.x*e,s.pos.y+=s.speed.y*e,s.rotation+=s.rotationSpeed*e,this.shadow){var l=Graphics.shadowCoords(s.pos);s.sprite.position.x=l.x,s.sprite.position.y=l.y,s.sprite.scale.x=s.scale.x/config.shadowScaling,s.sprite.scale.y=s.scale.y/config.shadowScaling,s.sprite.alpha=Tools.clamp(2*s.alpha,0,1)}else s.sprite.position.x=s.pos.x,s.sprite.position.y=s.pos.y,s.sprite.scale.x=s.scale.x,s.sprite.scale.y=s.scale.y,s.sprite.alpha=Tools.clamp(s.alpha,0,1);Math.abs(s.rotation-s.lastRotation)>.03&&(s.sprite.rotation=s.rotation,s.lastRotation=s.rotation),t=this.particles[t]._next}}}}kt.prototype.updateFuncMap={[St.MISSILE]:kt.prototype._updateMissile,[St.MISSILE_FAT]:kt.prototype._updateMissile,[St.MISSILE_SMALL]:kt.prototype._updateMissile,[St.SHOCKWAVE_SMOKE]:kt.prototype._updateShockwaveSmoke,[St.SHOCKWAVE_INNER]:kt.prototype._updateShockwave,[St.SHOCKWAVE_OUTER]:kt.prototype._updateShockwave,[St.EXPLOSION_FLASH]:kt.prototype._updateExplosionFlash,[St.EXPLOSION_FLASH_BIG]:kt.prototype._updateExplosionFlashBig,[St.EXPLOSION_HOT_SMOKE]:kt.prototype._updateExplosionHotSmoke,[St.EXPLOSION_SMOKE]:kt.prototype._updateExplosionSmoke,[St.EXPLOSION_SPARK]:kt.prototype._updateExplosionSpark,[St.FRAGMENT_SMOKE]:kt.prototype._updateFragmentSmoke,[St.PLANE_DAMAGE]:kt.prototype._updatePlaneDamage};var Mt={};Particles.setup=function(){Mt.smoke=new kt(game.graphics.layers.smoke,2e3),Mt.shadows=new kt(game.graphics.layers.shadows,2e3,null,!0),Mt.explosions=new kt(game.graphics.layers.explosions,2e3)},Particles.update=function(){for(var e=game.timeFactor>.51?Math.round(game.timeFactor):1,t=game.timeFactor/e,s=0;s<e;s++)Mt.smoke.update(t),Mt.explosions.update(t),Mt.shadows.update(t)},Particles.wipe=function(){Mt.smoke.wipe(),Mt.explosions.wipe(),Mt.shadows.wipe()},Particles.planeDamage=function(t){var s=2==t.type?2:1,a=Tools.randInt(1,4),l=Tools.randCircle(),i=Tools.rand(.5,2),n=Tools.rand(.2,.8),o=Tools.rand(0,.3),r=e.createOff(t.pos,l,Tools.rand(0,5*s)),u=e.create(l,i);Mt.explosions.addParticle(St.PLANE_DAMAGE,"spark_"+a,new e(u.x+t.speed.x,u.y+t.speed.y),r,e.diag(n),0,0,Tools.randCircle(),16739073,null,PIXI.BLEND_MODES.ADD,o)},Particles.explosion=function(t,s,a){for(var l=s>1?1+(s-1)/1.5:s,i=0;i<2;i++)Mt.explosions.addParticle(St.EXPLOSION_FLASH,"flash_"+Tools.randInt(1,4),e.zero(),t.clone(),e.diag(1.5*s),0,0,Tools.randCircle(),15987628,null,PIXI.BLEND_MODES.ADD);var n,o,r,u,c,p,d,h,g;for(n=Math.round(Tools.rand(20,30)*s),i=0;i<n;i++)o=Tools.randInt(1,4),r=Tools.randCircle(),c=Tools.rand(3,10)*l,p=Tools.rand(-.2,.2),d=Tools.rand(.4,1.5)*l,g=Tools.rand(0,.3),Mt.explosions.addParticle(St.EXPLOSION_SPARK,"spark_"+o,e.create(r,c),t.clone(),e.diag(d),0,p,Tools.randCircle(),16739073,null,PIXI.BLEND_MODES.ADD,g);for(i=0;i<a;i++)r=Tools.randCircle(),c=Tools.rand(3,7)*l,u=Tools.rand(15,30)*s,Mt.explosions.addEmitter(St.EMITTER_EXPLOSION_FRAGMENT,e.create(r,c),e.createOff(t,r,u),Tools.rand(0,.5),Mt.shadows);for(n=Math.round(Tools.rand(20,30)*s),i=0;i<n;i++)o=Tools.randInt(1,16),r=Tools.randCircle(),u=Tools.rand(0,10)*s,c=Tools.rand(0,3)*s,p=Tools.rand(-.1,.1),d=Tools.rand(.5,.8)*s,h=Tools.randCircle(),Mt.explosions.addParticle(St.EXPLOSION_SMOKE,"smoke_"+o,e.create(r,c),e.createOff(t,r,u),e.diag(d),0,p,h),Mt.shadows.addParticle(St.EXPLOSION_SMOKE,"smokeshadow_"+o,e.create(r,c),e.createOff(t,r,u),e.diag(d),0,p,h);for(Mt.explosions.addParticle(St.EXPLOSION_FLASH_BIG,"glowsmall",e.zero(),t.clone(),e.diag(6*s),0,0,0,null,null,PIXI.BLEND_MODES.ADD),n=Math.round(Tools.rand(5,10)*s),i=0;i<n;i++)o=Tools.randInt(1,4),r=Tools.randCircle(),c=Tools.rand(1,3)*s,p=Tools.rand(-.1,.1),d=Tools.rand(.1,.3)*s,Mt.explosions.addParticle(St.EXPLOSION_HOT_SMOKE,"hotsmoke_"+o,e.create(r,c),t.clone(),e.diag(d),0,p,Tools.randCircle(),16739073,null,PIXI.BLEND_MODES.ADD)},Particles.missileSmoke=function(t,s,a,l){var i=Et[t.type],n=t.spriteRot+Math.PI,o=e.createOff(t.pos,n,s),r=.2*(a=a||1),u=Tools.rand(-.1,.1),c=e.create(n+u,5*a),p=Tools.randInt(1,16),d=Tools.rand(-.1,.1);Tools.randCircle(),Mt.smoke.addParticle(i,"smoke_"+p,c.clone(),o.clone(),new e(1.25*r,4*r),1,d,n,l||16775590,null,null,null,a),Mt.shadows.addParticle(i,"smokeshadow_"+p,c.clone(),o.clone(),new e(1.25*r,4*r),1,d,n,null,null,null,null,a)},Particles.planeBoost=function(t,s){var a=t.rot+t.state.thrustDir/2+Math.PI,l=e.createOff(t.pos,a,s?40:-20),i=Tools.rand(-.1,.1),n=s?0:Math.PI,o=e.create(a+i+n,6),r=Tools.randInt(1,16),u=Tools.rand(-.1,.1);Tools.randCircle(),Mt.smoke.addParticle(St.MISSILE,"smoke_"+r,o.clone(),l.clone(),new e(.3,1.2),1,u,a,16775590,null,null,null,1.2),Mt.shadows.addParticle(St.MISSILE,"smokeshadow_"+r,o.clone(),l.clone(),new e(.3,1.2),1,u,a,null,null,null,null,1.2)},Particles.spiritShockwave=function(t){for(var s,a,l=0;l<40;l++)a=l/40*2*Math.PI,s=Tools.randInt(1,16),Mt.smoke.addParticle(St.SHOCKWAVE_SMOKE,"smoke_"+s,e.create(a,8),t.clone(),e.diag(2),0,.4,Tools.randCircle());Mt.smoke.addParticle(St.SHOCKWAVE_INNER,"shockwave",e.zero(),t.clone(),e.zero(),0,0,-.35+Math.PI),Mt.smoke.addParticle(St.SHOCKWAVE_OUTER,"shockwave",e.zero(),t.clone(),e.zero(),0,0,-.35)},Particles.count=function(){var e=0;for(var t in Mt)e+=Mt[t].particles.length;return e},Particles.PTYPE=St;class _t{constructor(t,s){this.id=t.id,this.status=t.status,this.spectate=!1,this.level=null==t.level||0==t.level?null:t.level,this.reel=1==t.reel,this.name=t.name,this.type=t.type,this.team=t.team,this.pos=new e(t.posX,t.posY),this.lowResPos=new e(t.posX,t.posY),this.speed=e.zero(),this.speedupgrade=0,this.rot=t.rot,this.flag=t.flag,this.speedLength=0,this.sprites={},this.randomness=Tools.rand(0,1e5),this.keystate={},this.lastKilled=0,this.health=1,this.energy=1,this.healthRegen=1,this.energyRegen=1,this.boost=!1,this.strafe=!1,this.flagspeed=!1,this.stealthed=!1,this.alpha=1,this.scale=1,this.powerups={shield:!1,rampage:!1},this.powerupsShown={shield:!1,rampage:!1},this.powerupActive=!1,this.render=!0,this.hidden=!1,this.culled=!1,this.timedout=!1,this.reducedFactor=!1,this.lastPacket=game.timeNetwork,this.state={thrustLevel:0,thrustDir:0,bubble:!1,bubbleProgress:0,bubbleFade:0,bubbleTime:0,bubbleTextWidth:0,hasBadge:!1,badge:0,stealthLevel:0,scaleLevel:1,powerupAngle:0,powerupFade:0,powerupFadeState:0,lastBounceSound:0},this.bot=t.isBot,this.bot&&(this.name=Tools.stripBotsNamePrefix(this.name)),this.name=Tools.mungeNonAscii(this.name,this.id),this.setupGraphics(),0==this.status?(Tools.decodeUpgrades(this,t.upgrades),this.updatePowerups()):(this.hidden=!0,this.me()&&UI.visibilityHUD(!1)),this.reel?(this._prevPos=null,this._offset=null):this.visibilityUpdate(),(!s&&this.render||this.me())&&(this.scale=0,this.state.scaleLevel=0),this.me()&&(game.myType=t.type,UI.aircraftSelected(t.type))}setupGraphics(e){var t=null;switch(this.me()&&(t={layer:"aircraftme"}),this.sprites.powerup=Textures.init("powerupShield",{visible:!1,alpha:.75}),this.sprites.powerupCircle=Textures.init("powerupCircle",{visible:!1,alpha:.75}),this.type){case PlaneType.Predator:this.state.baseScale=.25,this.state.nameplateDist=60,this.sprites.sprite=Textures.init("shipRaptor",t),this.skin&&this.changeSkin(this.skin.url,this.skin.hash),this.sprites.shadow=Textures.init("shipRaptorShadow",{scale:this.state.baseScale*(2.4/config.shadowScaling)}),this.sprites.thruster=Textures.init("shipRaptorThruster"),this.sprites.thrusterGlow=Textures.init("thrusterGlowSmall"),this.sprites.thrusterShadow=Textures.init("thrusterShadow");break;case PlaneType.Goliath:this.state.baseScale=.35,this.state.nameplateDist=60,this.sprites.sprite=Textures.init("shipSpirit",t),this.skin&&this.changeSkin(this.skin.url,this.skin.hash),this.sprites.shadow=Textures.init("shipSpiritShadow",{scale:this.state.baseScale*(2.4/config.shadowScaling)}),this.sprites.thruster1=Textures.init("shipRaptorThruster"),this.sprites.thruster2=Textures.init("shipRaptorThruster"),this.sprites.thruster1Glow=Textures.init("thrusterGlowSmall"),this.sprites.thruster2Glow=Textures.init("thrusterGlowSmall"),this.sprites.thruster1Shadow=Textures.init("thrusterShadow"),this.sprites.thruster2Shadow=Textures.init("thrusterShadow");break;case PlaneType.Mohawk:this.state.baseScale=.25,this.state.nameplateDist=60,this.sprites.sprite=Textures.init("shipComanche",t),this.skin&&this.changeSkin(this.skin.url,this.skin.hash),this.sprites.rotor=Textures.init("shipComancheRotor",t),this.sprites.shadow=Textures.init("shipComancheShadow",{scale:this.state.baseScale*(2.4/config.shadowScaling)}),this.sprites.rotorShadow=Textures.init("shipComancheRotorShadow",{scale:2*this.state.baseScale*(2.4/config.shadowScaling)});break;case PlaneType.Tornado:this.state.baseScale=.28,this.state.nameplateDist=60,this.sprites.sprite=Textures.init("shipTornado",t),this.skin&&this.changeSkin(this.skin.url,this.skin.hash),this.sprites.shadow=Textures.init("shipTornadoShadow",{scale:this.state.baseScale*(2.4/config.shadowScaling)}),this.sprites.thruster1=Textures.init("shipRaptorThruster"),this.sprites.thruster2=Textures.init("shipRaptorThruster"),this.sprites.thruster1Glow=Textures.init("thrusterGlowSmall"),this.sprites.thruster2Glow=Textures.init("thrusterGlowSmall"),this.sprites.thruster1Shadow=Textures.init("thrusterShadow"),this.sprites.thruster2Shadow=Textures.init("thrusterShadow");break;case PlaneType.Prowler:this.state.baseScale=.28,this.state.nameplateDist=60,this.sprites.sprite=Textures.init("shipProwler",t),this.skin&&this.changeSkin(this.skin.url,this.skin.hash),this.sprites.shadow=Textures.init("shipProwlerShadow",{scale:this.state.baseScale*(2.4/config.shadowScaling)}),this.sprites.thruster1=Textures.init("shipRaptorThruster"),this.sprites.thruster2=Textures.init("shipRaptorThruster"),this.sprites.thruster1Glow=Textures.init("thrusterGlowSmall"),this.sprites.thruster2Glow=Textures.init("thrusterGlowSmall"),this.sprites.thruster1Shadow=Textures.init("thrusterShadow"),this.sprites.thruster2Shadow=Textures.init("thrusterShadow")}this.reel||e||(this.setupNameplate(),this.setupChatBubbles(),(null!=this.level||this.bot)&&this.setupLevelPlate()),this.updateDebug()}updateDebug(){if(window.DEVELOPMENT){if(config.debug.collisions){if(!this.col){for(var e of(this.col=new PIXI.Graphics,config.ships[this.type].collisions))this.col.beginFill(16777215,.2),this.col.drawCircle(e[0],e[1],e[2]),this.col.endFill();game.graphics.layers.explosions.addChild(this.col)}}else this.col&&(game.graphics.layers.explosions.removeChild(this.col),this.col.destroy(),this.col=null);this.sprites.sprite.visible=!config.debug.hide_texture_player,this.sprites.shadow.visible=!config.debug.hide_texture_player,this.sprites.thruster&&(this.sprites.thruster.visible=!config.debug.hide_texture_thruster),this.sprites.thrusterGlow&&(this.sprites.thrusterGlow.visible=!config.debug.hide_texture_thruster),this.sprites.thrusterShadow&&(this.sprites.thrusterShadow.visible=!config.debug.hide_texture_thruster),this.sprites.thruster1&&(this.sprites.thruster1.visible=!config.debug.hide_texture_thruster),this.sprites.thruster2&&(this.sprites.thruster2.visible=!config.debug.hide_texture_thruster),this.sprites.thruster1Glow&&(this.sprites.thruster1Glow.visible=!config.debug.hide_texture_thruster),this.sprites.thruster2Glow&&(this.sprites.thruster2Glow.visible=!config.debug.hide_texture_thruster),this.sprites.thruster1Shadow&&(this.sprites.thruster1Shadow.visible=!config.debug.hide_texture_thruster),this.sprites.thruster2Shadow&&(this.sprites.thruster2Shadow.visible=!config.debug.hide_texture_thruster)}}reteam(e){this.team=e,GameType.CTF==game.gameType||game.server.config?.tdmMode?(this.sprites.name.style=new PIXI.TextStyle(this.nameplateTextStyle()),UI.changeMinimapTeam(this.id,this.team)):this.me()&&(game.myTeam=this.team)}nameplateTextStyle(){if(GameType.CTF==game.gameType||game.server.config.tdmMode)var e=1==this.team?"#4076E2":"#EA4242";else e=this.in_my_team?"#4076E2":this.in_team?this.in_team:this.team==game.myTeam?"#FFFFFF":"#FFEC52";return{fontFamily:"MontserratWeb, Helvetica, sans-serif",fontSize:33*config.airmashRefugees.fontSizeMul+"px",fill:e,dropShadow:!0,dropShadowBlur:10,dropShadowDistance:0,padding:4}}setupNameplate(){var e="";2==game.gameType&&(e="  ■"),this.sprites.name=new PIXI.Text(this.name+e,this.nameplateTextStyle()),this.sprites.name.scale.set(.5,.5),this.sprites.flag=Textures.sprite("flag_"+this.flag),this.sprites.flag.scale.set(.4,.4),this.sprites.flag.anchor.set(.5,.5),this.sprites.badge=Textures.sprite("badge_gold"),this.sprites.badge.scale.set(.3),this.sprites.badge.visible=!1,game.graphics.layers.playernames.addChild(this.sprites.badge),game.graphics.layers.playernames.addChild(this.sprites.flag),game.graphics.layers.playernames.addChild(this.sprites.name)}setupChatBubbles(){this.sprites.bubble=new PIXI.Container,this.sprites.bubbleLeft=Graphics.initSprite("chatbubbleleft",this.sprites.bubble,{scale:.5}),this.sprites.bubbleRight=Graphics.initSprite("chatbubbleright",this.sprites.bubble,{scale:.5}),this.sprites.bubbleCenter=Graphics.initSprite("chatbubblecenter",this.sprites.bubble,{scale:.5}),this.sprites.bubblePoint=Graphics.initSprite("chatbubblepoint",this.sprites.bubble,{scale:.5}),this.sprites.emote=Graphics.initSprite("emote_tf",this.sprites.bubble,{scale:.6,anchor:[.5,.5]}),this.sprites.bubbleText=new PIXI.Text("a",{fontFamily:"MontserratWeb, Helvetica, sans-serif",fontSize:12*config.airmashRefugees.fontSizeMul+"px",fill:"white"}),this.sprites.bubble.addChild(this.sprites.bubbleText),this.sprites.bubble.visible=!1,this.sprites.bubble.pivot.set(.5,34),game.graphics.layers.bubbles.addChild(this.sprites.bubble)}visibilityUpdate(e){this.culled=!Graphics.inScreen(this.pos,128);var t=!(this.hidden||this.culled||this.timedout);if(e||this.render!=t){switch(this.sprites.sprite.visible=t&&!config.debug.hide_texture_player,this.sprites.shadow.visible=t&&!config.debug.hide_texture_player,this.sprites.flag.visible=t,this.sprites.name.visible=t,null!=this.sprites.level&&(this.sprites.level.visible=t,this.sprites.levelBorder.visible=t),this.sprites.badge.visible=this.state.hasBadge&&t,this.sprites.powerup.visible=this.powerupActive&&t,this.sprites.powerupCircle.visible=this.powerupActive&&t,this.type){case PlaneType.Predator:this.sprites.thruster.visible=t&&!config.debug.hide_texture_thruster,this.sprites.thrusterGlow.visible=t&&!config.debug.hide_texture_thruster,this.sprites.thrusterShadow.visible=t&&!config.debug.hide_texture_thruster;break;case PlaneType.Goliath:case PlaneType.Tornado:case PlaneType.Prowler:this.sprites.thruster1.visible=t&&!config.debug.hide_texture_thruster,this.sprites.thruster1Glow.visible=t&&!config.debug.hide_texture_thruster,this.sprites.thruster1Shadow.visible=t&&!config.debug.hide_texture_thruster,this.sprites.thruster2.visible=t&&!config.debug.hide_texture_thruster,this.sprites.thruster2Glow.visible=t&&!config.debug.hide_texture_thruster,this.sprites.thruster2Shadow.visible=t&&!config.debug.hide_texture_thruster;break;case PlaneType.Mohawk:this.sprites.rotor.visible=t,this.sprites.rotorShadow.visible=t}this.render=t,t||Sound.clearThruster(this.id)}}stealth(e){this.lastPacket=game.timeNetwork,this.energy=e.energy,this.energyRegen=e.energyRegen,e.state?(this.stealthed=!0,this.state.stealthLevel=0,this.team!=game.myTeam&&(this.keystate.LEFT&&delete this.keystate.LEFT,this.keystate.RIGHT&&delete this.keystate.RIGHT)):this.unstealth()}unstealth(){this.stealthed=!1,this.state.stealthLevel=0,this.opacity(1)}opacity(e){this.alpha=e,this.sprites.sprite.alpha=e,this.sprites.shadow.alpha=e,this.sprites.flag.alpha=e,this.sprites.name.alpha=e,this.sprites.badge.alpha=e,this.sprites.powerup.alpha=.75*e,this.sprites.powerupCircle.alpha=.75*e,null!=this.sprites.level&&(this.sprites.level.alpha=e,this.sprites.levelBorder.alpha=.4*e),PlaneType.Prowler==this.type&&(this.sprites.thruster1.alpha=e,this.sprites.thruster1Glow.alpha=e,this.sprites.thruster2.alpha=e,this.sprites.thruster2Glow.alpha=e)}kill(t){if(this.status=1,this.spectate=!!t.spectate,this.keystate={},this.pos.x=t.posX,this.pos.y=t.posY,this.speed=e.zero(),this.me()&&UI.resetPowerups(),this.resetPowerups(),this.hidden=!0,this.visibilityUpdate(),this.stealthed&&this.unstealth(),!this.spectate&&(this.lastKilled=performance.now(),!this.culled)){switch(this.type){case PlaneType.Predator:Particles.explosion(this.pos.clone(),Tools.rand(1.5,2),Tools.randInt(2,3));break;case PlaneType.Goliath:Particles.explosion(this.pos.clone(),Tools.rand(2,2.5),Tools.randInt(4,7));break;case PlaneType.Mohawk:case PlaneType.Tornado:case PlaneType.Prowler:Particles.explosion(this.pos.clone(),Tools.rand(1.5,2),Tools.randInt(2,3))}Graphics.shakeCamera(this.pos,this.me()?20:10),Sound.clearThruster(this.id),Sound.playerKill(this)}}me(){return game.myID==this.id}destroy(e){e&&GameType.FFA==game.gameType&&this.reteam();var t=this.me()?game.graphics.layers.aircraftme:game.graphics.layers.aircraft;switch(window.DEVELOPMENT&&this.col&&(game.graphics.layers.explosions.removeChild(this.col),this.col.destroy(),this.col=null),t.removeChild(this.sprites.sprite),game.graphics.layers.shadows.removeChild(this.sprites.shadow),this.sprites.sprite.destroy(),this.sprites.shadow.destroy(),this.sprites.powerup.destroy(),this.sprites.powerupCircle.destroy(),this.type){case PlaneType.Predator:game.graphics.layers.thrusters.removeChild(this.sprites.thruster),game.graphics.layers.thrusters.removeChild(this.sprites.thrusterGlow),this.sprites.thruster.destroy(),this.sprites.thrusterGlow.destroy(),this.sprites.thrusterShadow.destroy();break;case PlaneType.Goliath:case PlaneType.Tornado:case PlaneType.Prowler:game.graphics.layers.thrusters.removeChild(this.sprites.thruster1,this.sprites.thruster2),game.graphics.layers.thrusters.removeChild(this.sprites.thruster1Glow,this.sprites.thruster2Glow),this.sprites.thruster1.destroy(),this.sprites.thruster2.destroy(),this.sprites.thruster1Glow.destroy(),this.sprites.thruster2Glow.destroy(),this.sprites.thruster1Shadow.destroy(),this.sprites.thruster2Shadow.destroy();break;case PlaneType.Mohawk:t.removeChild(this.sprites.rotor),this.sprites.rotor.destroy(),game.graphics.layers.shadows.removeChild(this.sprites.rotorShadow),this.sprites.rotorShadow.destroy()}e&&!this.reel&&(game.graphics.layers.playernames.removeChild(this.sprites.badge,this.sprites.name,this.sprites.flag),null!=this.sprites.level&&(game.graphics.layers.playernames.removeChild(this.sprites.level,this.sprites.levelBorder),this.sprites.level.destroy(),this.sprites.levelBorder.destroy()),game.graphics.layers.bubbles.removeChild(this.sprites.bubble),this.sprites.badge.destroy(),this.sprites.name.destroy(),this.sprites.flag.destroy(),this.sprites.bubble.destroy({children:!0}))}sayBubble(e){this.state.bubbleTime=game.time,this.state.bubbleFade=0,this.state.bubble||(this.state.bubble=!0,this.state.bubbleProgress=0,this.sprites.bubble.visible=this.render,this.sprites.bubble.alpha=0,this.sprites.bubble.scale.set(0,0)),this.sprites.bubble.cacheAsBitmap=!1;var t=UI.isEmote(e.text,!0);if(t){this.sprites.bubbleText.visible=!1,this.sprites.emote.texture=Textures.get("emote_"+t),this.sprites.emote.visible=!0;var s=26;this.sprites.emote.position.set(0,0)}else this.sprites.bubbleText.visible=!0,this.sprites.emote.visible=!1,this.sprites.bubbleText.text=e.text,s=this.sprites.bubbleText.width,this.sprites.bubbleText.position.set(-s/2,-7);this.sprites.bubbleLeft.position.set(-s/2-16,-21),this.sprites.bubbleRight.position.set(s/2+8,-21),this.sprites.bubbleCenter.position.set(-s/2-9,-21),this.sprites.bubbleCenter.scale.set(s/82+18/82,.5),this.sprites.bubblePoint.position.set(-9,18),this.sprites.bubble.cacheAsBitmap=!0,this.state.bubbleTextWidth=s}networkKey(e,t){this.lastPacket=game.timeNetwork,1==this.status&&this.revive(),null!=t.posX&&(this.reducedFactor=Tools.reducedFactor(),this.pos.x=t.posX,this.pos.y=t.posY,this.rot=t.rot,this.speed.x=t.speedX,this.speed.y=t.speedY);var s=this.stealthed;null!=t.keystate&&Tools.decodeKeystate(this,t.keystate),null!=t.upgrades&&(Tools.decodeUpgrades(this,t.upgrades),this.updatePowerups()),null!=t.energy&&(this.energy=t.energy,this.energyRegen=t.energyRegen),null!=t.boost&&(this.boost=t.boost),this.team!=game.myTeam&&(this.stealthed||s&&!this.stealthed)&&this.unstealth(),this.me()||!s||this.stealthed||this.unstealth(),t.c==Network.SERVERPACKET.EVENT_BOUNCE&&game.time-this.state.lastBounceSound>300&&(this.state.lastBounceSound=game.time,Sound.playerImpact(this.pos,this.type,this.speed.length()/config.ships[this.type].maxSpeed))}updateLevel(e){this.me()&&(1==e.type&&Games.showLevelUp(e.level),UI.updateMyLevel(e.level)),this.level=e.level,this.setupLevelPlate()}setupLevelPlate(){let e=this.bot?"bot":this.level+"";null==this.sprites.level?(this.sprites.level=new PIXI.Text(e,{fontFamily:"MontserratWeb, Helvetica, sans-serif",fontSize:(this.bot?24:28)*config.airmashRefugees.fontSizeMul+"px",fill:"rgb(200, 200, 200)",dropShadow:!0,dropShadowBlur:6,dropShadowDistance:0,padding:4}),this.sprites.level.scale.set(.5,.5),this.sprites.levelBorder=Textures.sprite("levelborder"),this.sprites.levelBorder.alpha=.4,game.graphics.layers.playernames.addChild(this.sprites.levelBorder),game.graphics.layers.playernames.addChild(this.sprites.level)):this.sprites.level.text=e,this.sprites.levelBorder.scale.set((this.sprites.level.width+10)/32,.65),this.sprites.level.visible=this.render,this.sprites.levelBorder.visible=this.render}powerup(e){UI.addPowerup(e.type,e.duration)}resetPowerups(){this.powerupActive&&(this.sprites.powerup.visible=!1,this.sprites.powerupCircle.visible=!1),this.powerups.shield=!1,this.powerupsShown.shield=!1,this.powerups.rampage=!1,this.powerupsShown.rampage=!1,this.powerupActive=!1,this.state.powerupFade=0,this.state.powerupFadeState=0}updatePowerups(){var e=!1;this.powerups.shield!=this.powerupsShown.shield&&(this.powerupsShown.shield=this.powerups.shield,this.powerups.shield&&(this.sprites.powerup.texture=Textures.get("powerup_shield"),this.sprites.powerupCircle.tint=16777215),e=!0),this.powerups.rampage!=this.powerupsShown.rampage&&(this.powerupsShown.rampage=this.powerups.rampage,this.powerups.rampage&&(this.sprites.powerup.texture=Textures.get("powerup_rampage"),this.sprites.powerupCircle.tint=16712448),e=!0),e&&(this.powerupActive=this.powerups.shield||this.powerups.rampage,this.powerupActive?(this.state.powerupFade=0,this.state.powerupFadeState=0,this.sprites.powerup.visible=!0,this.sprites.powerupCircle.visible=!0):(this.powerupActive=!0,this.state.powerupFade=0,this.state.powerupFadeState=1))}impact(e,t,s,a){this.health=s,this.healthRegen=a,this.stealthed&&this.unstealth(),200!=e&&Mobs.explosion(t,e),this.me()&&0==this.status&&Graphics.shakeCamera(t,8)}changeType(e){this.type!=e.type&&(this.destroy(!1),this.type=e.type,this.setupGraphics(!0),this.visibilityUpdate(!0))}respawn(e){this.lastPacket=game.timeNetwork,this.status=0,this.spectate=!1,this.keystate={},this.pos.x=e.posX,this.pos.y=e.posY,this.rot=e.rot,this.speed.x=0,this.speed.y=0,this.health=1,this.energy=1,this.healthRegen=1,this.energyRegen=1,this.boost=!1,this.strafe=!1,this.flagspeed=!1,this.state.thrustLevel=0,this.state.thrustDir=0,this.hidden=!1,this.timedout=!1,this.visibilityUpdate(),this.me()&&UI.resetPowerups(),Tools.decodeUpgrades(this,e.upgrades),this.updatePowerups(),(this.render||this.me())&&(this.scale=0,this.state.scaleLevel=0),this.stealthed&&this.unstealth(),this.me()&&(game.myType=this.type,game.spectatingID=null,UI.aircraftSelected(this.type),UI.visibilityHUD(!0),UI.hideSpectator()),this.updateGraphics(1),Sound.playerRespawn(this),UI.updateGameInfo()}revive(){this.status=0,this.spectate=!1,this.boost=!1,this.strafe=!1,this.flagspeed=!1,this.hidden=!1,this.health=1,this.energy=1,this.healthRegen=1,this.energyRegen=1,this.stealthed&&this.unstealth(),UI.updateGameInfo()}changeFlag(e){this.flag=e.flag,this.sprites.flag.texture=Textures.get("flag_"+e.flag)}changeBadge(e){this.sprites.badge.texture=Textures.get(e)}static async fetch_skin(e){try{console.log("fetching skin",e);const t=await fetch(`https://curly-hall-3ffc.yenel84660.workers.dev?url=${encodeURIComponent(e)}`).then((e=>e.arrayBuffer())),s="data:image/png;base64,"+btoa(new Uint8Array(t).reduce(((e,t)=>e+String.fromCharCode(t)),""));let{w:a,h:l}=await new Promise(((e,t)=>{const a=new Image;a.onload=function(){e({w:a.width,h:a.height})},a.onerror=t,a.src=s}));const i=await window.crypto.subtle.digest("SHA-1",t),n=Array.from(new Uint8Array(i)).map((e=>e.toString(16).padStart(2,"0"))).join("");return{dataURL:s,w:a,h:l,hashHex:n,byteLength:t.byteLength}}catch(e){return console.error(e),{}}}static async load_skin(e,t,s){const a={[PlaneType.Predator]:{w:256,h:256},[PlaneType.Goliath]:{w:512,h:256},[PlaneType.Mohawk]:{w:128,h:256},[PlaneType.Tornado]:{w:256,h:256},[PlaneType.Prowler]:{w:256,h:256}},l=t;let i=await caches.open("skin_cache"),n=await i.match(l);if(n){const{dataURL:t,w:s,h:l}=await n.json();if(s!==a[e].w||l!==a[e].h)return;return t}if(!n){const{dataURL:n,w:o,h:r,hashHex:u,byteLength:c}=await this.fetch_skin(t);if(!n)return;if(u!=s)return void console.error(`server hash:${s} != client hash ${u}`);if(c>config.skins.MAX_IMG_BYTES[o])return void console.error(`Image too big: ${c} > ${config.skins.MAX_IMG_BYTES[o]}`);if(await i.put(l,new Response(JSON.stringify({dataURL:n,w:o,h:r}))),o!==a[e].w||r!==a[e].h)return;return n}}async changeSkin(e,t){const s=this;s.skin={url:e,hash:t};const a=await _t.load_skin(s.type,e,t);if(!a)return;let l=s.me()?game.graphics.layers.aircraftme:game.graphics.layers.aircraft;l.removeChild(s.sprites.sprite);const i=new PIXI.Texture.fromImage(a);let n=new PIXI.Sprite(i);n.anchor.set(.5,.6),l.addChild(n),s.sprites.sprite=n}updateNameplate(){if(!this.reel){let e=(this.sprites.name.width+this.sprites.flag.width+10)/2,t=this.pos.x-e+(this.state.hasBadge?12:0)-(this.sprites.level?this.sprites.level.width/2+8:0),s=this.pos.y+this.state.nameplateDist*this.scale;this.sprites.flag.position.set(t+15,s+10),this.sprites.name.position.set(t+40,s),this.sprites.level&&(this.sprites.level.position.set(t+2*e+13,s+(this.bot?3:2)),this.sprites.levelBorder.position.set(t+2*e+7.75,s-.5)),this.state.hasBadge&&this.sprites.badge.position.set(t-28,s)}}updateBubble(){this.sprites.bubble.visible=this.render,this.state.bubbleProgress+=.015*game.timeFactor,this.state.bubbleProgress>=1&&(this.state.bubbleProgress=1),game.time-this.state.bubbleTime>4e3?(this.state.bubbleFade+=.08*game.timeFactor,this.state.bubbleFade>=1&&(this.state.bubbleFade=1),this.sprites.bubble.scale.set(1+.2*this.state.bubbleFade),this.sprites.bubble.alpha=1*(1-this.state.bubbleFade),this.state.bubbleFade>=1&&(this.state.bubble=!1,this.sprites.bubble.visible=!1)):(this.sprites.bubble.scale.set(Tools.easing.outElastic(this.state.bubbleProgress,.5)),this.sprites.bubble.alpha=1);var e=(this.state.bubbleTextWidth+game.screenX)%2==0?.5:0,t=game.screenY%2==0?0:.5,s=this.state.nameplateDist*this.scale;this.powerupActive&&(s+=60),this.sprites.bubble.position.set(this.pos.x*game.scale+e,(this.pos.y-s)*game.scale+t)}detectTimeout(){if(!this.me()){var t=this.timedout;this.timedout=!game.lagging&&game.timeNetwork-this.lastPacket>3e3,this.timedout&&!t&&(this.boost=!1,this.strafe=!1,this.flagspeed=!1,this.speed=e.zero(),this.keystate={},this.resetPowerups())}}leaveHorizon(){this.me()||this.timedout||(this.lastPacket=-1e4,this.timedout=!0,this.boost=!1,this.strafe=!1,this.flagspeed=!1,this.speed=e.zero(),this.keystate={},this.resetPowerups())}update(e){if(this.reel)this.clientCalcs(e);else{if(this.detectTimeout(),this.visibilityUpdate(),!this.render)return this.health+=e*this.healthRegen,void(this.health>=1&&(this.health=1));if(!(!1!==this.reducedFactor&&(e-=this.reducedFactor,this.reducedFactor=!1,e<=0))){for(var t=e>.51?Math.round(e):1,s=e/t,a=2*Math.PI,l=this.boost?1.5:1,i=0;i<t;i++){this.energy+=s*this.energyRegen,this.energy>=1&&(this.energy=1),this.health+=s*this.healthRegen,this.health>=1&&(this.health=1);var n=-999;this.strafe?(this.keystate.LEFT&&(n=this.rot-.5*Math.PI),this.keystate.RIGHT&&(n=this.rot+.5*Math.PI)):(this.keystate.LEFT&&(this.rot+=-s*config.ships[this.type].turnFactor),this.keystate.RIGHT&&(this.rot+=s*config.ships[this.type].turnFactor));var o=this.speed.x,r=this.speed.y;this.keystate.UP?-999==n?n=this.rot:n+=Math.PI*(this.keystate.RIGHT?-.25:.25):this.keystate.DOWN&&(-999==n?n=this.rot+Math.PI:n+=Math.PI*(this.keystate.RIGHT?.25:-.25)),-999!==n&&(this.speed.x+=Math.sin(n)*config.ships[this.type].accelFactor*s*l,this.speed.y-=Math.cos(n)*config.ships[this.type].accelFactor*s*l);var u=this.speed.length(),c=config.ships[this.type].maxSpeed*l*config.upgrades.speed.factor[this.speedupgrade],p=config.ships[this.type].minSpeed;this.powerups.rampage&&(c*=.75),this.flagspeed&&(c=5),u>c?this.speed.multiply(c/u):this.speed.x>p||this.speed.x<-p||this.speed.y>p||this.speed.y<-p?(this.speed.x*=1-config.ships[this.type].brakeFactor*s,this.speed.y*=1-config.ships[this.type].brakeFactor*s):(this.speed.x=0,this.speed.y=0),this.pos.x+=s*o+.5*(this.speed.x-o)*s*s,this.pos.y+=s*r+.5*(this.speed.y-r)*s*s,this.clientCalcs(s)}this.rot=(this.rot%a+a)%a,-1!=game.gameType?(this.pos.x<-16352&&(this.pos.x=-16352),this.pos.x>16352&&(this.pos.x=16352),this.pos.y<-8160&&(this.pos.y=-8160),this.pos.y>8160&&(this.pos.y=8160)):(this.pos.x<-16384&&(this.pos.x+=32768),this.pos.x>16384&&(this.pos.x-=32768),this.pos.y<-8192&&(this.pos.y+=16384),this.pos.y>8192&&(this.pos.y-=16384)),Sound.updateThruster(0,this)}}}clientCalcs(e){switch(this.type){case PlaneType.Predator:case PlaneType.Goliath:case PlaneType.Tornado:case PlaneType.Prowler:var t,s=!1,a=this.boost?1.5:1;!1!==(t=this.keystate.LEFT?.3:this.keystate.RIGHT?-.3:0)&&(this.state.thrustDir=Tools.converge(this.state.thrustDir,t,.1*e)),!1!==(s=this.keystate.UP?1:this.keystate.DOWN?-1:0)&&(this.state.thrustLevel=Tools.converge(this.state.thrustLevel,s*a,.2*e));break;case PlaneType.Mohawk:this.state.thrustDir+=(.2+this.speed.length()/50)*e}this.culled||this.render&&(!this.stealthed&&this.health<.4&&Particles.planeDamage(this),!this.stealthed&&this.health<.2&&Particles.planeDamage(this),this.boost&&Particles.planeBoost(this,s>=0),PlaneType.Prowler==this.type&&this.stealthed&&(this.state.stealthLevel+=.03*e,this.state.stealthLevel=Tools.clamp(this.state.stealthLevel,0,this.team==game.myTeam?.5:1),this.opacity(1-this.state.stealthLevel)),this.state.scaleLevel+=.005*e,this.state.scaleLevel>=1?(this.state.scaleLevel=1,this.scale=1):this.scale=Tools.easing.outElastic(this.state.scaleLevel,.5),this.powerupActive&&(this.state.powerupAngle+=.075*e,0==this.state.powerupFadeState?(this.state.powerupFade+=.05*e,this.state.powerupFade>=1&&(this.state.powerupFade=1)):(this.state.powerupFade+=.05*e,this.state.powerupFade>=1&&(this.powerupActive=!1,this.sprites.powerup.visible=!1,this.sprites.powerupCircle.visible=!1))))}updateGraphics(e){var t=Tools.oscillator(.025,1e3,this.randomness)*this.scale,s=1.5*this.state.thrustLevel,a=this.rot,l=Graphics.shadowCoords(this.pos);if(Graphics.transform(this.sprites.sprite,this.pos.x,this.pos.y,a,t*this.state.baseScale,t*this.state.baseScale),Graphics.transform(this.sprites.shadow,l.x,l.y,a,this.state.baseScale*(2.4/config.shadowScaling)*this.scale,this.state.baseScale*(2.4/config.shadowScaling)*this.scale),this.powerupActive){var i=.35*(0==this.state.powerupFadeState?2*(1-this.state.powerupFade)+1:1-this.state.powerupFade)*Tools.oscillator(.075,100,this.randomness),n=.75*(0==this.state.powerupFadeState?Tools.clamp(2*this.state.powerupFade,0,1):Tools.clamp(1-1.3*this.state.powerupFade,0,1))*this.alpha;Graphics.transform(this.sprites.powerup,this.pos.x,this.pos.y-80,0,i,i,n),Graphics.transform(this.sprites.powerupCircle,this.pos.x,this.pos.y-80,this.state.powerupAngle,1.35*i,1.35*i,n)}var o=Tools.oscillator(.1,.5,this.randomness),r=Math.abs(this.state.thrustLevel)<.01?0:this.state.thrustLevel/2+(this.state.thrustLevel>0?.5:-.5),u=Tools.clamp(2*Math.abs(this.state.thrustLevel)-.1,0,1);switch(this.type){case PlaneType.Predator:Graphics.transform(this.sprites.thruster,this.pos.x+Math.sin(-a)*(20*t),this.pos.y+Math.cos(-a)*(20*t),a+(this.state.thrustLevel>0?this.state.thrustDir:0),.3*o*r*this.scale,.5*o*r*this.scale,u),Graphics.transform(this.sprites.thrusterShadow,l.x+Math.sin(-a)*(20*t)/config.shadowScaling,l.y+Math.cos(-a)*(20*t)/config.shadowScaling,a+(this.state.thrustLevel>0?this.state.thrustDir:0),.4*o*r*this.scale*(4/config.shadowScaling),.5*o*r*this.scale*(4/config.shadowScaling),u/2.5),Graphics.transform(this.sprites.thrusterGlow,this.pos.x+Math.sin(-a-.5*this.state.thrustDir)*(40*t),this.pos.y+Math.cos(-a-.5*this.state.thrustDir)*(40*t),null,1.5*s*this.scale,1*s*this.scale,.3*this.state.thrustLevel);break;case PlaneType.Goliath:this.state.thrustLevel<0&&(o*=.7),Graphics.transform(this.sprites.thruster1,this.pos.x+Math.sin(-a-.5)*(32*t),this.pos.y+Math.cos(-a-.5)*(32*t),a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.4*o*r*this.scale,.6*o*r*this.scale,u),Graphics.transform(this.sprites.thruster2,this.pos.x+Math.sin(.5-a)*(32*t),this.pos.y+Math.cos(.5-a)*(32*t),a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.4*o*r*this.scale,.6*o*r*this.scale,u),Graphics.transform(this.sprites.thruster1Shadow,l.x+Math.sin(-a-.5)*(32*t)/config.shadowScaling,l.y+Math.cos(-a-.5)*(32*t)/config.shadowScaling,a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.5*o*r*this.scale*(4/config.shadowScaling),.6*o*r*this.scale*(4/config.shadowScaling),u/2.5),Graphics.transform(this.sprites.thruster2Shadow,l.x+Math.sin(.5-a)*(32*t)/config.shadowScaling,l.y+Math.cos(.5-a)*(32*t)/config.shadowScaling,a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.5*o*r*this.scale*(4/config.shadowScaling),.6*o*r*this.scale*(4/config.shadowScaling),u/2.5),Graphics.transform(this.sprites.thruster1Glow,this.pos.x+Math.sin(-a-.3)*(50*t),this.pos.y+Math.cos(-a-.3)*(50*t),null,2.5*this.scale,1.5*this.scale,.3*this.state.thrustLevel),Graphics.transform(this.sprites.thruster2Glow,this.pos.x+Math.sin(.3-a)*(50*t),this.pos.y+Math.cos(.3-a)*(50*t),null,2.5*this.scale,1.5*this.scale,.3*this.state.thrustLevel);break;case PlaneType.Mohawk:Graphics.transform(this.sprites.rotor,this.pos.x,this.pos.y,this.state.thrustDir,t*this.state.baseScale*2,t*this.state.baseScale*2,.8),Graphics.transform(this.sprites.rotorShadow,l.x,l.y,this.state.thrustDir,this.state.baseScale*(2.4/config.shadowScaling)*this.scale*2,this.state.baseScale*(2.4/config.shadowScaling)*this.scale*2);break;case PlaneType.Tornado:this.state.thrustLevel<0&&(o*=.7),Graphics.transform(this.sprites.thruster1,this.pos.x+Math.sin(-a-.15)*(28*t),this.pos.y+Math.cos(-a-.15)*(28*t),a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.3*o*r*this.scale,.5*o*r*this.scale,u),Graphics.transform(this.sprites.thruster2,this.pos.x+Math.sin(.15-a)*(28*t),this.pos.y+Math.cos(.15-a)*(28*t),a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.3*o*r*this.scale,.5*o*r*this.scale,u),Graphics.transform(this.sprites.thruster1Shadow,l.x+Math.sin(-a-.15)*(28*t)/config.shadowScaling,l.y+Math.cos(-a-.15)*(28*t)/config.shadowScaling,a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.3*o*r*this.scale*(4/config.shadowScaling),.5*o*r*this.scale*(4/config.shadowScaling),u/2.5),Graphics.transform(this.sprites.thruster2Shadow,l.x+Math.sin(.15-a)*(28*t)/config.shadowScaling,l.y+Math.cos(.15-a)*(28*t)/config.shadowScaling,a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.3*o*r*this.scale*(4/config.shadowScaling),.5*o*r*this.scale*(4/config.shadowScaling),u/2.5),Graphics.transform(this.sprites.thruster1Glow,this.pos.x+Math.sin(-a-.2)*(45*t),this.pos.y+Math.cos(-a-.2)*(45*t),null,2.5*this.scale,1.5*this.scale,.25*this.state.thrustLevel),Graphics.transform(this.sprites.thruster2Glow,this.pos.x+Math.sin(.2-a)*(45*t),this.pos.y+Math.cos(.2-a)*(45*t),null,2.5*this.scale,1.5*this.scale,.25*this.state.thrustLevel);break;case PlaneType.Prowler:this.state.thrustLevel<0&&(o*=.7),Graphics.transform(this.sprites.thruster1,this.pos.x+Math.sin(-a-.35)*(20*t),this.pos.y+Math.cos(-a-.35)*(20*t),a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.3*o*r*this.scale,.4*o*r*this.scale,u*this.alpha),Graphics.transform(this.sprites.thruster2,this.pos.x+Math.sin(.35-a)*(20*t),this.pos.y+Math.cos(.35-a)*(20*t),a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.3*o*r*this.scale,.4*o*r*this.scale,u*this.alpha),Graphics.transform(this.sprites.thruster1Shadow,l.x+Math.sin(-a-.35)*(20*t)/config.shadowScaling,l.y+Math.cos(-a-.35)*(20*t)/config.shadowScaling,a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.4*o*r*this.scale*(4/config.shadowScaling),.4*o*r*this.scale*(4/config.shadowScaling),u*this.alpha/2.5),Graphics.transform(this.sprites.thruster2Shadow,l.x+Math.sin(.35-a)*(20*t)/config.shadowScaling,l.y+Math.cos(.35-a)*(20*t)/config.shadowScaling,a+.5*(this.state.thrustLevel>0?this.state.thrustDir:0),.4*o*r*this.scale*(4/config.shadowScaling),.4*o*r*this.scale*(4/config.shadowScaling),u*this.alpha/2.5),Graphics.transform(this.sprites.thruster1Glow,this.pos.x+Math.sin(-a-.2-0*this.state.thrustDir)*(35*t),this.pos.y+Math.cos(-a-.2-0*this.state.thrustDir)*(35*t),null,2.5*this.scale,1.5*this.scale,.2*this.state.thrustLevel*this.alpha),Graphics.transform(this.sprites.thruster2Glow,this.pos.x+Math.sin(.2-a-0*this.state.thrustDir)*(35*t),this.pos.y+Math.cos(.2-a-0*this.state.thrustDir)*(35*t),null,2.5*this.scale,1.5*this.scale,.2*this.state.thrustLevel*this.alpha)}this.updateNameplate(),this.state.bubble&&this.updateBubble(),config.debug.collisions&&this.col&&(this.col.position.set(this.pos.x,this.pos.y),this.col.rotation=this.rot)}isSpectating(){return this.spectate}}const Pt=_t;var Ut={},xt=[-1,-1,-1],At=["badge_gold","badge_silver","badge_bronze"];Players.update=function(){var e,t;for(e in Ut)0==(t=Ut[e]).status&&(t.update(game.timeFactor),t.updateGraphics(game.timeFactor));if(null!=game.spectatingID){if(null==(t=Ut[game.spectatingID]))return;if(game.timeNetwork-t.lastPacket>3e3)return;Graphics.setCamera(t.pos.x,t.pos.y)}else if(null!=game.myID){if(null==(t=Ut[game.myID]))return;0==t.status&&UI.updateHUD(t.health,t.energy,t),Graphics.setCamera(t.pos.x,t.pos.y)}},Players.add=function(e,t){Ut[e.id]=new Pt(e,t),game.state===Network.STATE.PLAYING&&UI.updateGameInfo()},Players.get=function(e){return Ut[e]},Players.getMe=function(){return Ut[game.myID]},Players.amIAlive=function(){var e=Players.getMe();return null!=e&&0==e.status},Players.getIDs=function(){var e={};for(var t in Ut)e[t]=!0;return e},Players.getByName=function(e){var t;for(t in Ut)if(Ut[t].name===e)return Ut[t];return null},Players.network=function(e,t){let s=Ut[t.id];if(null!=s)switch(e){case Network.SERVERPACKET.PLAYER_UPDATE:case Network.SERVERPACKET.PLAYER_FIRE:case Network.SERVERPACKET.EVENT_BOOST:case Network.SERVERPACKET.EVENT_BOUNCE:s.networkKey(e,t);break;case Network.SERVERPACKET.CHAT_SAY:s.sayBubble(t);break;case Network.SERVERPACKET.PLAYER_RESPAWN:s.respawn(t),UI.updateGameInfo();break;case Network.SERVERPACKET.PLAYER_FLAG:t.id==game.myID&&(game.myFlag=game.lastFlagSet,Tools.setSettings({flag:game.lastFlagSet})),s.changeFlag(t)}},Players.stealth=function(e){var t=Ut[e.id];null!=t&&t.stealth(e)},Players.leaveHorizon=function(e){var t=Ut[e.id];null!=t&&t.leaveHorizon()},Players.updateBadges=function(e){for(var t,s=Tools.clamp(e.length,0,3),a=[],l=0;l<s;l++)null!=(t=Ut[e[l].id])&&(a.push(t.id),t.state.badge!=l&&(t.state.badge=l,t.changeBadge(At[l])),t.state.hasBadge||(t.state.hasBadge=!0,t.render&&(t.sprites.badge.visible=!0)));for(var i=0;i<xt.length;i++)if(-1==a.indexOf(xt[i])){if(null==(t=Ut[xt[i]]))continue;t.state.hasBadge&&(t.state.hasBadge=!1,t.sprites.badge.visible=!1)}xt=a},Players.chat=function(e){var t=Ut[e.id];null!=t&&UI.addChatLine(t,e.text,0)},Players.teamChat=function(e){var t=Ut[e.id];null!=t&&UI.addChatLine(t,e.text,3)},Players.votemutePass=function(e){var t=Ut[e.id];null!=t&&UI.chatVotemutePass(t)},Players.whisper=function(e){var t;if(e.to==game.myID){if(null==(s=Ut[e.from]))return;t=2}else{var s;if(null==(s=Ut[e.to]))return;t=1}UI.addChatLine(s,e.text,t)},Players.impact=function(t){for(var s=0;s<t.players.length;s++){var a=Ut[t.players[s].id];null!=a&&a.impact(t.type,new e(t.posX,t.posY),t.players[s].health,t.players[s].healthRegen)}},Players.powerup=function(e){Players.getMe().powerup(e)},Players.updateLevel=function(e){var t=Ut[e.id];null!=t&&t.updateLevel(e)},Players.reteam=function(e){for(let{id:t,team:s}of e.players){let e=Ut[t];null!=e&&e.reteam(s)}Players.updateFFATeams(),UI.updateGameInfo()},Players.kill=function(e){let t=Ut[e.id];if(t)if(0!=e.killer||0!=e.posX||0!=e.posY){if(t.kill(e),t.me()){UI.visibilityHUD(!1);let t=Ut[e.killer];t&&UI.killedBy(t),UI.showSpectator('<div onclick="Network.spectateNext()" class="spectate">ENTER SPECTATOR MODE</div>')}else e.killer===game.myID&&UI.killed(t);t.me()||t.id!==game.spectatingID||game.gameType===GameType.BTR||Games.spectatorSwitch(t.id)}else t.kill({posX:0,posY:0,spectate:!0}),UI.visibilityHUD(!1),UI.updateGameInfo()},Players.destroy=function(e){e==game.spectatingID&&($("#spectator-tag").html("Spectating"),Games.spectatorSwitch(e));let t=Ut[e];null!=t&&(t.destroy(!0),delete Ut[e],game.state===Network.STATE.PLAYING&&UI.updateGameInfo())},Players.changeType=function(e){var t=Ut[e.id];null!=t&&t.changeType(e)},Players.count=function(){var e,t=0,s=0;for(e in Ut)t++,Ut[e].culled&&s++;return[t-s,t]},Players.categoryCounts=function(){let e={players:0,bots:0,blueTeam:0,redTeam:0,spectators:0};for(let t in Ut){let s=Ut[t];s.bot?"Server"!==s.name&&e.bots++:(e.players++,s.isSpectating()?e.spectators++:1===s.team?e.blueTeam++:2===s.team&&e.redTeam++)}return e},Players.wipe=function(){for(let e in Ut)Ut[e].destroy(!0),delete Ut[e]},Players.all=function(){return Ut},Players.playersByTeam=function(){let e={};for(let[t,s]of Object.entries(Players.all()))e[s.team]=(e[s.team]||[]).concat(s);return e},Players.updateFFATeams=function(){if(GameType.CTF==game.gameType||game.server.config?.tdmMode)return;let e=Players.playersByTeam();for(let t in e){let s=e[t];for(let e of s){let{in_team:t,in_my_team:a}=e;e.in_team=s.length>1&&Games.assign_team_color(e.team)||Games.unassign_team_color(e.team),e.in_my_team=e.in_team&&e.team==game.myTeam,(game.force_update_teams||e.in_team!=t||e.in_my_team!=a)&&(e.sprites.name.style=new PIXI.TextStyle(e.nameplateTextStyle()),UI.changeMinimapTeam(e.id,e.in_my_team?1:e.team))}}game.force_update_teams=!1},s(469),s(448);const Ct=["id","hidpi"];var Rt={},Lt=0,Nt={started:!1,startX:200,startY:-2450,pan:0,dist:100,explosion:4e3,direction:1},Gt="";Tools.updateReel=function(){if(!Nt.started){Nt.pos=e.zero();for(var t,s=[3,1,2,4,5],a=[-270,-150,0,150,270],l=0;l<s.length;l++)Players.add({id:l+1,team:1,status:0,reel:!0,name:"",type:s[l],posX:0,posY:0,rot:0,flag:1}),(t=Players.get(l+1)).keystate.UP=!0,t._offset=a[l]}Nt.started=!0,Nt.dist>2e3?Nt.direction=-1:Nt.dist<100&&(Nt.direction=1),Nt.dist+=.5*Nt.direction*game.timeFactor,Nt.pan+=1/Nt.dist*game.timeFactor,Nt.pos.x=Nt.startX+Math.sin(Nt.pan)*Nt.dist,Nt.pos.y=Nt.startY-Math.cos(Nt.pan)*Nt.dist,Graphics.setCamera(Nt.pos.x,Nt.pos.y),Players.update(),Particles.update();for(var i,n=1;n<=5;n++)(i=Players.get(n)).pos.x=Nt.pos.x+i._offset,i.pos.y=Nt.pos.y+game.screenY/game.scale*.24,null!=i._prevPos?i.rot=new e(i.pos.x-i._prevPos.x,i.pos.y-i._prevPos.y).angle()+Math.PI:i._prevPos=i.pos.clone(),i._prevPos=new e((19*i._prevPos.x+i.pos.x)/20,(19*i._prevPos.y+i.pos.y)/20);if(game.time>Nt.explosion){var o=new e(Tools.rand(Nt.pos.x-game.halfScreenX/game.scale,Nt.pos.x+game.halfScreenX/game.scale),Tools.rand(Nt.pos.y-game.halfScreenY/game.scale,Nt.pos.y+game.halfScreenY/game.scale));Particles.explosion(o,Tools.rand(2,2.5),Tools.randInt(4,7)),Particles.explosion(new e(o.x+Tools.rand(-100,100),o.y+Tools.rand(-100,100)),Tools.rand(1,1.2)),Nt.explosion=game.time+Tools.rand(1e3,3e3)}},Tools.wipeReel=function(){Particles.wipe(),Players.wipe()},Tools.detectCapabilities=function(){Ot(),config.mobile&&!config.settings.mobileshown&&(UI.popBigMsg(1),config.settings.mobileshown=!0,Tools.setSettings({mobileshown:!0})),config.mobile&&Input.setupLogin()};var Ot=function(){config.mobile="ontouchstart"in document.documentElement&&void 0!==window.orientation||-1!==navigator.userAgent.indexOf("IEMobile"),config.ios=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,"#forcemobile"==window.location.hash&&(config.mobile=!0),"#nomobile"==window.location.hash&&(config.mobile=!1)};Tools.syncRemoteSettings=function(){if(config.auth.tokens&&config.auth.tokens.settings){var e={};Object.keys(config.settings).forEach((t=>{Ct.includes(t)||(e[t]=config.settings[t])}));var t=JSON.stringify(e);t!==Gt&&(Gt=t,Tools.ajaxPost("https://"+game.backendHost+"/settings",t,config.auth.tokens.settings,(function(e){e&&1==e.result||(Gt="")})))}};var Dt=function(e){if(null==window.localStorage)return{};var t=null,s={};try{t=localStorage.getItem(e)}catch(t){}if(null!=t)try{s=JSON.parse(t)}catch(t){}return s},Ft=function(e,t){if(null!=window.localStorage)try{localStorage.setItem(e,JSON.stringify(t))}catch(e){}};Tools.loadSettings=function(){var e=Dt("settings");for(var t in e)config.settings[t]=e[t];DEVELOPMENT&&console.log(e),Tools.applySettingsToGame()},Tools.applySettingsToGame=function(){if(null==config.settings.id){var e=Tools.randomID(16);config.settings.id=e,Tools.setSettings({id:e})}null!=config.settings.name&&$("#playername").val(config.settings.name),null!=config.settings.region&&(game.playRegion=config.settings.region),null!=config.settings.flag&&(game.myFlag=config.settings.flag),null==config.settings.sound&&(config.settings.sound=!0),config.settings.mousemode&&Input.toggleMouse(!0),UI.updateSound(),config.oldhidpi=config.settings.hidpi},Tools.randomID=function(e){var t=new Uint8Array(e);return window.crypto.getRandomValues(t),$t(t).substr(0,e)};var $t=function(e){for(var t,s="",a=0;a<e.length;a++)s+=t=1===(t=(255&e[a]).toString(16)).length?"0"+t:t;return s};Tools.setSettings=function(e){for(var t in e)config.settings[t]=e[t];Ft("settings",config.settings)},Tools.removeSetting=function(e){null!=config.settings[e]&&delete config.settings[e],Ft("settings",config.settings)},Tools.wipeSettings=function(){config.settings={},Ft("settings",config.settings)};var Ht=function(){void 0!==config.auth.tokens&&void 0!==config.auth.tokens.settings&&void 0!==config.auth.tokens.game&&void 0!==config.auth.identityprovider&&void 0!==config.auth.loginname||(config.auth={},Ft("auth",config.auth))};Tools.loadAuth=function(){return config.auth=Dt("auth"),Ht(),!$.isEmptyObject(config.auth)},Tools.setAuth=function(e){config.auth=e,Ft("auth",config.auth),Ht()},Tools.ajaxPost=function(e,t,s,a){$.ajax({url:e,method:"POST",data:t,dataType:"json",timeout:1e4,headers:null==s?{}:{Authorization:"Bearer "+s},success:function(e){null!=a&&a(e)},error:function(){null!=a&&a(null)}})},Tools.ajaxGet=function(e,t,s){$.ajax({url:e,method:"GET",dataType:"json",timeout:1e4,headers:null==t?{}:{Authorization:"Bearer "+t},success:function(e){null!=s&&s(e)},error:function(){null!=s&&s(null)}})},Tools.length=function(e,t){return Math.sqrt(e*e+t*t)},Tools.oscillator=function(e,t,s){return 1+Math.sin((game.time+(s||0))/t)*e},Tools.converge=function(e,t,s){return Math.abs(e-t)<.01?t:e+s*(t-e)},Tools.rand=function(e,t){return Math.random()*(t-e)+e},Tools.randCircle=function(){return Tools.rand(0,6.28318530718)},Tools.randInt=function(e,t){var s=Math.floor(Math.random()*(t+1-e)+e);return s>=t&&(s=t),s},Tools.clamp=function(e,t,s){return e<=t?t:e>=s?s:e},Tools.lerp=function(e,t,s){return s*(t-e)+e},Tools.colorLerp=function(e,t,s){s<=0&&(s=.001),s>=1&&(s=.999);var a=e>>16,l=e>>8&255,i=255&e;return(1<<24)+(a+s*((t>>16)-a)<<16)+(l+s*((t>>8&255)-l)<<8)+(i+s*((255&t)-i))|0},Tools.distance=function(e,t,s,a){var l=e-s,i=t-a;return Math.sqrt(l*l+i*i)},Tools.distFastCheck=function(e,t,s,a){return Math.abs(e.x-t.x)<=s&&Math.abs(e.y-t.y)<=a},Tools.distFastCheckFloat=function(e,t,s,a,l){return Math.abs(e-s)<=l&&Math.abs(t-a)<=l},Tools.updateTime=function(e){game.timeFactor=e<60?e:60,game.timeFactorUncapped=game.timeFactor,game.timeFactor>10&&(game.timeFactor=10),game.time=performance.now(),game.frames++},Tools.reducedFactor=function(){var e=(performance.now()-game.time)/16.666;return Math.abs(game.jitter)>.1&&(e+=game.jitter/16.666),e};var Yt={shockwave:[.1,.1,.11,.12,.12,.13,.14,.14,.15,.16,.17,.18,.2,.21,.22,.24,.26,.29,.31,.35,.38,.42,.47,.52,.58,.64,.71,.78,.84,.9,.95,.98,1,1,1,.98,.97,.94,.9,.85,.78,.7,.62,.52,.43,.34,.26,.18,.11,.05,0],explosionSmoke:[0,0,.02,.06,.13,.26,.45,.71,.91,.99,.99,.97,.94,.92,.89,.86,.83,.8,.77,.74,.71,.68,.65,.63,.6,.57,.54,.51,.48,.45,.42,.4,.37,.34,.31,.29,.26,.24,.21,.19,.16,.14,.12,.1,.08,.06,.04,.02,.01,0,0]};Tools.easing={outElastic:function(e,t){var s=1-(t||.7),a=2*e;if(0===e||1===e)return e;var l=s/(2*Math.PI)*Math.asin(1);return Math.pow(2,-10*a)*Math.sin((a-l)*(2*Math.PI)/s)+1},custom:function(e,t){var s=Yt[t],a=s.length,l=Math.floor(e*(a-1)),i=s[l];return l===a-1?i:Tools.lerp(i,s[l+1],e*(a-1)%1)}},Tools.setDebugOptions=function(e){let{collisions:t,hide_container_map:s,hide_container_sea:a,hide_container_shadows:l,hide_texture_player:i,hide_texture_thruster:n,hide_texture_mountains:o,disable_region_ping:r,log_packets:u,mock_server:c,remove_mountains:p,teleport:d}=e,h=JSON.parse(localStorage.getItem("debug_options")||"{}");for(let t in e)void 0!==e[t]&&(config.debug[t]=e[t],h[t]=e[t]);try{Graphics.updateDebug()}catch{}if("remove_mountains"in e&&(p?Network.sendCommand("server","test mountains_off"):Network.sendCommand("server","test mountains_on")),"hide_texture_mountains"in e&&(o?Mobs.removeDoodads(!0):game.graphics.layers&&Mobs.setupDoodads()),d){const e={"0,0":[0,0],red_base:[8502,-944],blue_base:[-9569,-1471]},[t,s]=e[d];Network.sendCommand("server",`test teleport ${t} ${s}`),document.getElementById("config_debug_teleport").value=""}localStorage.setItem("debug_options",JSON.stringify(h))},Tools.setupDebug=function(){if(DEVELOPMENT&&config.debug.show){UI.show("#debug"),game.debug={last:performance.now(),ticks:0,frames:game.frames},setInterval(Tools.updateDebug,2123);let e=JSON.parse(localStorage.getItem("debug_options")||"{}");Tools.setDebugOptions(e),document.getElementById("config_debug_collisions").checked=config.debug.collisions,document.getElementById("config_debug_hide_container_map").checked=config.debug.hide_container_map,document.getElementById("config_debug_hide_container_sea").checked=config.debug.hide_container_sea,document.getElementById("config_debug_hide_container_shadows").checked=config.debug.hide_container_shadows,document.getElementById("config_debug_hide_texture_player").checked=config.debug.hide_texture_player,document.getElementById("config_debug_hide_texture_thruster").checked=config.debug.hide_texture_thruster,document.getElementById("config_debug_log_packets").checked=config.debug.log_packets,document.getElementById("config_debug_mock_server").checked=config.debug.mock_server,UI.show("#debug_options")}},Tools.debugLine=function(e,t){return'<div class="line"><span class="attr">'+UI.escapeHTML(e)+'</span><span class="val">'+UI.escapeHTML(t)+"</span></div>"},Tools.updateDebug=function(){var e=performance.now(),t=1e3*(game.frames-game.debug.frames)/(e-game.debug.last),s=Players.count(),a=Mobs.count(),l=Mobs.countDoodads(),i="",n=Players.getMe();null!=n&&(i=Tools.debugLine("Coords",Math.round(n.pos.x)+", "+Math.round(n.pos.y)));var o=Tools.debugLine("FPS",Math.round(t))+Tools.debugLine("Ticks",(game.debug.ticks/(e-game.debug.last)*100).toFixed(2)+"%")+Tools.debugLine("Ping",game.ping.toFixed(2)+" ms")+Tools.debugLine("Res",game.screenX+" x "+game.screenY)+'<div class="spacer"></div>'+Tools.debugLine("Players",s[0]+" / "+s[1])+Tools.debugLine("Mobs",a[0]+" / "+a[1])+Tools.debugLine("Particles",Particles.count())+Tools.debugLine("Doodads",l[0]+" / "+l[1])+'<div class="spacer"></div>'+i+Tools.debugLine("Scale",game.scale.toFixed(2))+Tools.debugLine("Jitter",game.jitter.toFixed(3))+'<div class="close" onclick="Tools.hideDebug()">x</div>';$("#debug").html(o),game.debug.last=e,game.debug.ticks=0,game.debug.frames=game.frames},Tools.hideDebug=function(){UI.hide("#debug")},Tools.hideDebugOptions=function(){UI.hide("#debug_options")},Tools.minimizeDebugOptions=function(){UI.hide("#debug_options"),UI.show("#debug_options_minimized")},Tools.maximizeDebugOptions=function(){UI.show("#debug_options"),UI.hide("#debug_options_minimized")},Tools.debugStartFrame=function(){DEVELOPMENT&&config.debug.show&&(game.debug.startedFrame=performance.now())},Tools.debugEndFrame=function(){DEVELOPMENT&&config.debug.show&&null!=game.debug.startedFrame&&(game.debug.ticks+=performance.now()-game.debug.startedFrame)},Tools.earningsToRank=function(e){return Math.floor(.0111*Math.pow(e,.5))+1},Tools.rankToEarnings=function(e){return Math.pow((e-1)/.0111,2)},Tools.decodeKeystate=function(e,t){e.keystate.UP=!!(1&t),e.keystate.DOWN=!!(2&t),e.keystate.LEFT=!!(4&t),e.keystate.RIGHT=!!(8&t),e.boost=!!(16&t),e.strafe=!!(32&t),e.stealthed=!!(64&t),e.flagspeed=!!(128&t)},Tools.decodeUpgrades=function(e,t){e.speedupgrade=(1&t?1:0)+(2&t?2:0)+(4&t?4:0),e.powerups.shield=!!(8&t),e.powerups.rampage=!!(16&t)},Tools.decodeMinimapCoords=function(t,s){return new e(128*t-16384+64,Tools.clamp(128*s-16384,-8192,8192)+64)},Tools.decodeSpeed=function(e){return(e-32768)/1638.4},Tools.decodeCoordX=function(e){return(e-32768)/2},Tools.decodeCoordY=function(e){return(e-32768)/4},Tools.decodeCoord24=function(e){return(e-8388608)/512},Tools.decodeAccel=function(e){return(e-32768)/32768},Tools.decodeRotation=function(e){return e/6553.6},Tools.decodeHealthnergy=function(e){return e/255},Tools.decodeRegen=function(e){return(e-32768)/1e6};var Bt=function(e){return Tools.clamp(Math.floor(e/Rt.size)+Rt.bucketsHalfX,0,Rt.bucketsMaxX)};Tools.initBuckets=function(e){game.buckets=[],Rt={size:config.bucketSize,halfSize:parseInt(config.bucketSize/2),bucketsMaxX:parseInt(config.mapWidth/config.bucketSize)-1,bucketsMaxY:parseInt(config.mapHeight/config.bucketSize)-1,bucketsHalfX:parseInt(config.mapWidth/config.bucketSize/2),bucketsHalfY:parseInt(config.mapHeight/config.bucketSize/2)};for(var t=0;t<=Rt.bucketsMaxX;t++){game.buckets.push([]);for(var s=0;s<=Rt.bucketsMaxY;s++)game.buckets[t].push([[]])}for(var a=0;a<e.length;a++)e[a]&&(t=Bt(e[a][0]),l=e[a][1],s=Tools.clamp(Math.floor(l/Rt.size)+Rt.bucketsHalfY,0,Rt.bucketsMaxY),game.buckets[t][s][0].push(a));var l},Tools.getBucketBounds=function(e,t,s){return[Tools.clamp(Math.floor((e.x-t)/Rt.size)+Rt.bucketsHalfX,0,Rt.bucketsMaxX),Tools.clamp(Math.floor((e.x+t)/Rt.size)+Rt.bucketsHalfX,0,Rt.bucketsMaxX),Tools.clamp(Math.floor((e.y-s)/Rt.size)+Rt.bucketsHalfY,0,Rt.bucketsMaxY),Tools.clamp(Math.floor((e.y+s)/Rt.size)+Rt.bucketsHalfY,0,Rt.bucketsMaxY)]},Tools.deferUpdate=function(e){setTimeout(e,1)};var Xt=function(e,t){if(t instanceof Error){var s={};return Object.getOwnPropertyNames(t).forEach((function(e){s[e]=t[e]})),s}return t};Tools.handleError=function(e){if((Lt+=1)<=5){let t;null!=e.error&&(e.error=JSON.stringify(e.error,Xt)),game.server&&game.server.id&&(t=game.server.id),Tools.ajaxPost("https://"+game.backendHost+"/clienterror",{type:"runtime",error:JSON.stringify(e),version:game.version,state:game.state,server:t})}},Tools.encodeUTF8=function(e){for(var t=0,s=new Uint8Array(4*e.length),a=0;a!=e.length;a++){var l=e.charCodeAt(a);if(l<128)s[t++]=l;else{if(l<2048)s[t++]=l>>6|192;else{if(l>55295&&l<56320){if(++a==e.length)throw"UTF-8 encode: incomplete surrogate pair";var i=e.charCodeAt(a);if(i<56320||i>57343)throw"UTF-8 encode: second char code 0x"+i.toString(16)+" at index "+a+" in surrogate pair out of range";l=65536+((1023&l)<<10)+(1023&i),s[t++]=l>>18|240,s[t++]=l>>12&63|128}else s[t++]=l>>12|224;s[t++]=l>>6&63|128}s[t++]=63&l|128}}return s.subarray(0,t)},Tools.decodeUTF8=function(e){for(var t="",s=0;s<e.length;){var a=e[s++];if(a>127){if(a>191&&a<224){if(s>=e.length)throw"UTF-8 decode: incomplete 2-byte sequence";a=(31&a)<<6|63&e[s]}else if(a>223&&a<240){if(s+1>=e.length)throw"UTF-8 decode: incomplete 3-byte sequence";a=(15&a)<<12|(63&e[s])<<6|63&e[++s]}else{if(!(a>239&&a<248))throw"UTF-8 decode: unknown multibyte start 0x"+a.toString(16)+" at index "+(s-1);if(s+2>=e.length)throw"UTF-8 decode: incomplete 4-byte sequence";a=(7&a)<<18|(63&e[s])<<12|(63&e[++s])<<6|63&e[++s]}++s}if(a<=65535)t+=String.fromCharCode(a);else{if(!(a<=1114111))throw"UTF-8 decode: code point 0x"+a.toString(16)+" exceeds UTF-16 reach";a-=65536,t+=String.fromCharCode(a>>10|55296),t+=String.fromCharCode(1023&a|56320)}}return t},Tools.stripBotsNamePrefix=function(e){return game.server.config&&game.server.config.botsNamePrefix&&e.startsWith(game.server.config.botsNamePrefix)&&(e=e.substring(game.server.config.botsNamePrefix.length)),e},Tools.mungeNonAscii=function(e,t){return config.airmashRefugees.unicodeWorkaround?/^[a-z0-9!"#$%&'()*+,.\/:;<=>?@\[\] ^_`{|}~-]*$/i.test(e)?e:"player#"+t:e};var zt={},Kt={},Wt=null,Vt=!1,jt=0,Jt=!1,Zt=!1,qt=0,Qt=!1,es=null,ts=!1,ss=null,as=!1,ls=!1,is=!1,ns=null,os=0,rs=!1,us=!1,cs=null,ps=!1,ds=null,hs={x:0,y:0,width:0,height:0},gs={alert:null,information:null,default:null,destroyed:null},ms={alert:!1,information:!1,default:!1,destroyed:!1},fs={score:-1,upgrades:-1,earnings:-1,kills:-1,deaths:-1},ys=!1,bs={},ws=[],vs=0,Ts={1:["Predator",80,50,75,60,"BOOST","Temporarily increases speed by burning energy"],2:["Goliath",30,100,30,100,"REPEL","Repels enemy aircraft and missiles"],3:["Mohawk",100,40,100,40,"STRAFE","Enables sideways flight"],4:["Tornado",60,70,50,80,"MULTIFIRE","Launches 3 missiles at the same time"],5:["Prowler",50,70,40,60,"STEALTH","Becomes invisible to enemy aircraft"],101:["Speed"],102:["Defense"],103:["Energy Regen"],104:["Missile Speed"]},Is=["tf","pepe","clap","lol","bro","kappa","cry","rage"],Ss=["","Shield","Inferno"];UI.show=function(e,t){$(e).css({display:t?"inline-block":"block"})},UI.hide=function(e){$(e).css({display:"none"})},UI.isEmote=function(e,t){for(var s=0;s<Is.length;s++)if(t){if(e===":"+Is[s]+":")return Is[s]}else if(e===Is[s])return Is[s];return!1};UI.serverMessage=function(e){let t="alert";2==e.type&&(t="information"),UI.showMessage(t,function(e){let t=/^(<span class="info inline"><span class="(blueflag|redflag)"><\/span><\/span>(Captured|Returned|Taken) by )(.*)$/m.exec(e);if(t){let e=Tools.stripBotsNamePrefix(t[4]);return t[1]+function(e){return UI.escapeHTML(e.replace(/&#x2F;/g,"/").replace(/&#x27;/g,"'").replace(/&quot;/g,'"').replace(/&gt;/g,">").replace(/&lt;/g,"<").replace(/&amp;/g,"&"))}(e)}return UI.escapeHTML(e.replace(/<br>/g,"\n")).replace(/\n/g,"<br>")}(e.text),e.duration)},UI.showMessage=function(e,t,s){$("#msg-"+e).removeClass("hidemsg").removeClass("popmsg"),$("#msg-"+e).html(t);var a=$("#msg-"+e).height();"default"!=e&&"destroyed"!=e||$("#msg-"+e).css({"margin-top":"-"+Math.round(a/2)+"px"}),$("#msg-"+e).addClass("popmsg"),ms[e]=!0,clearTimeout(gs[e]),gs[e]=setTimeout(UI.hideMessage,s||2e3,e)},UI.hideMessage=function(e){$("#msg-"+e).addClass("hidemsg"),ms[e]=!1,gs[e]=setTimeout((function(t){$("#msg-"+e).removeClass("popmsg").removeClass("hidemsg"),$("#msg-"+t).html("")}),2500,e)},UI.wipeAllMessages=function(){for(var e in ms)ms[e]&&UI.showMessage(e,"",100)},UI.updateMyLevel=function(e){game.myLevel=e,$("#score-rank").html(e),$("#lifetime-rank").html(e)},UI.newScore=function(e){if(e.id!=game.myID)return!1;let t=e.score-game.myScore,s="";if(Math.abs(t)<1&&(t=!1),game.myScore=e.score,e.score!=fs.score&&(fs.score=e.score),$("#score-score").html(e.score),e.upgrades!=fs.upgrades){let t=e.upgrades-fs.upgrades,a=-1!=fs.upgrades;if(fs.upgrades=e.upgrades,$("#score-upgrades").html(e.upgrades),Ns(),a&&t>0){if(Sound.powerup(4,null),ys&&(ys.msg+="<br>"),ms.default)return s+='&nbsp;&nbsp;<span class="upgrade">+'+t+"</span>",void $("#alert-update").append(s);s+='<span id="alert-update"><span class="upgrade">+'+t+'<span class="bold"> upgrade</span></span></span>'}}if(e.earnings!=fs.earnings&&0!=game.myLevel){fs.earnings=e.earnings,$("#lifetime-totalbounty").html(e.earnings);let t=Math.ceil(Tools.rankToEarnings(game.myLevel+1)-e.earnings);$("#lifetime-nextbounty").html("+"+t)}if(e.totalkills!=fs.kills||e.totaldeaths!=fs.deaths){let t=0==e.totalkills||0==e.totaldeaths?"-":(e.totalkills/e.totaldeaths).toFixed(2);$("#lifetime-kdratio").html(t)}e.totalkills!=fs.kills&&(fs.kills=e.totalkills,$("#lifetime-kills").html(e.totalkills)),e.totaldeaths!=fs.deaths&&(fs.deaths=e.totaldeaths,$("#lifetime-deaths").html(e.totaldeaths)),t&&(ys&&(ys.msg+="<br>"),s+=UI.getScoreString(t)),ys?(UI.showMessage(ys.type,ys.msg+s,ys.duration),ys=!1):""!=s&&UI.showMessage("default",s,3e3)},UI.getScoreString=function(e,t,s){var a="positive",l="+";return e<0&&(a="negative",l="-"),t&&(a=t),'<span id="alert-update" class="'+a+'">'+l+Math.abs(e)+"</span>"};var Es=function(e){e.sprite.position.set(game.screenX-config.minimapPaddingX-config.minimapSize*((16384-e.x)/32768),game.screenY-config.minimapPaddingY-config.minimapSize/2*((8192-e.y)/16384))};UI.wipeAllMinimapMobs=function(){for(var e in zt)game.graphics.layers.ui1.removeChild(zt[e].sprite),zt[e].sprite.destroy(),delete zt[e]},UI.showSpectator=function(e){if(!ps){var t=config.mobile?' class="mobile"':"";$("body").append('<div id="spectator"'+t+"></div>"),ps=!0}$("#spectator").html(e),Input.addTouchRejection("#spectator")},UI.hideSpectator=function(){ps&&($("#spectator").remove(),ps=!1)},UI.addPowerup=function(e,t){null!=cs&&clearTimeout(cs);var s='<div class="powerup" id="powerup-'+e+'"><div class="percent '+(1==e?"shield":"rampage")+'" id="powerup-'+e+'-percent" style="transition: width '+t+'ms linear;"></div><div class="name">'+Ss[e]+"</div></div>";$("#powerups").html(s),$("#powerup-"+e+"-percent").width(),$("#powerup-"+e+"-percent").css({width:"7%"}),cs=setTimeout((function(){$("#powerup-"+e).remove()}),t)},UI.resetPowerups=function(){$("#powerups").html("")},UI.changeMinimapTeam=function(e,t){if(null!=zt[e]&&null!=zt[e].sprite){var s=1==t?"minimapBlue":"minimapMob";zt[e].sprite.texture=Textures.getNamed(s)}},UI.scoreboardUpdate=function(e,t,s){for(var a,l={},i=0,n=0;n<t.length;n++)if(null!=(a=Players.get(t[n].id))){var o=Tools.decodeMinimapCoords(t[n].x,t[n].y);if(a.lowResPos.x=o.x,a.lowResPos.y=o.y,t[n].id!=game.myID)if(0!=t[n].x||0!=t[n].y){if(l[a.id]=!0,null==zt[t[n].id]){var r="minimapMob";GameType.CTF!=game.gameType&&!game.server.config.tdmMode||1!=a.team||(r="minimapBlue"),zt[t[n].id]={sprite:Textures.init(r),x:o.x,y:o.y}}else zt[t[n].id].x=o.x,zt[t[n].id].y=o.y;Es(zt[t[n].id])}else{let e=Players.get(t[n].id);e&&performance.now()-e.lastKilled>3e3&&(e.spectate=!0)}else i=n+1}for(var u in zt)null==l[u]&&(game.graphics.layers.ui1.removeChild(zt[u].sprite),zt[u].sprite.destroy(),delete zt[u]);if(!i)return;s=s?Tools.clamp(s,1,e.length):e.length;var c=0,p=!1,d="";let h=[,0,0];for(n=0;n<s&&!p;n++){if(!(a=Players.get(e[n].id)))continue;var g;g=1==++c?'<span class="badge scoreboard gold"></span>':2==c?'<span class="badge scoreboard silver"></span>':3==c?'<span class="badge scoreboard bronze"></span>':c+".";var m=a.me()?" sel":"",f=e[n].score,y=a.bot?"bot":e[n].level;i>s&&c==s-1&&(d+='<div class="line dottedline">&middot; &middot; &middot;</div>',a=Players.get(game.myID),g=i+".",f=game.myScore,y=game.myLevel,m=" sel",p=!0);let t="",l="",o="";GameType.CTF==game.gameType||game.server.config.tdmMode?(t=" team-"+a.team,h[a.team]+=f):GameType.FFA==game.gameType&&a.in_team&&(a.in_my_team?t=" team-1":o=`color: ${a.in_team} !important`);let r="";4==(g+"").length&&(r=" bigger"),a.isSpectating()&&!a.bot&&(t+=" spectating",r+=" spectating",l=" spectating"),d+='<div class="line '+m+'"><span class="place '+r+'">'+g+'</span><span class="flag small flag-'+a.flag+'" title="'+Cs(a.flag)+'"></span>'+`<span class="nick ${t}" style="${o}">`+UI.escapeHTML(Tools.mungeNonAscii(a.name,a.id))+"</span>",y&&(d+='<span class="holder">&nbsp;<span class="rank'+(a.bot?" bot":"")+'">'+y+"</span></span>"),d+='<span class="score'+l+'">'+ks(f)+"</span></div>"}!p&&e.length>s&&(d+='<div class="line dottedline">&middot; &middot; &middot;</div>'),$("#scoreboard").html(d),game.server.config.tdmMode&&Games.updateTdmScore(h[1],h[2])};var ks=function(e){var t="";e+="";for(var s=0;s<e.length;s++)t+="<span>"+e[s]+"</span>";return t};UI.toggleChatBox=function(e){if(!config.mobile)if(Vt){if(Vt=!1,e){var t=$("#chatinput").val();""!==t&&""!==t.trim()&&(UI.parseCommand(t.trim())||Network.sendChat(t)),Ms()}UI.hide("#chatinput"),$("#chatinput").val(""),$("#chatinput").blur()}else Zt&&UI.maximizeChat(),Input.clearKeys(!0),Vt=!0,UI.show("#chatinput"),$("#chatinput").focus()},UI.shortcutChat=function(e){Vt||($("#chatinput").val(e),UI.toggleChatBox())};var Ms=function(){Jt||(Jt=!0,$("#chat-0").length&&$("#chat-0").remove())};UI.parseCommand=function(e){if("/"!==e[0])return!1;var t,s=e.split(" "),a=s[0].substr(1).toLowerCase();if(0==a.length)return!1;if("s"===a){var l=e.indexOf(" ");(i=e.substr(l+1)).length>0&&Network.sendSay(i)}else if("t"===a){var i;l=e.indexOf(" "),(i=e.substr(l+1)).length>0&&Network.sendTeam(i)}else if("ignore"===a)null==(t=Players.getByName(Ls(s[1])))?UI.addChatMessage("Unknown player"):UI.chatIgnore(t.id);else if("unignore"===a)null==(t=Players.getByName(Ls(s[1])))?UI.addChatMessage("Unknown player"):UI.chatUnignore(t);else if("votemute"===a)null==(t=Players.getByName(Ls(s[1])))?UI.addChatMessage("Unknown player"):UI.chatVotemute(t);else if("w"===a)s.length>=3?UI.chatWhisper(s[1],e.substr(4+s[1].length)):UI.addChatMessage("Usage: /w player message");else if("spectate"===a)null==(t=Players.getByName(Ls(s[1])))?UI.addChatMessage("Unknown player"):Network.sendCommand("spectate",t.id+"");else if("flag"===a||"flags"===a)2==s.length?Network.sendCommand("flag",e.substr(a.length+2)):UI.addChatMessage("Type /flag XX where XX is the 2-letter ISO code of a country",!0);else if("emotes"===a)UI.addChatMessage("Emotes available: /tf /pepe /clap /lol /bro /kappa /cry /rage",!0);else if("invite"===a)null==(t=Players.getByName(Ls(s.slice(1).join(" "))))?UI.addChatMessage("Unknown player"):Network.sendCommand("invite",t.id+"");else if("join"===a)null==(t=Players.getByName(Ls(s.slice(1).join(" "))))?UI.addChatMessage("Unknown player"):Network.sendCommand("join",t.id+"");else if("skin"===a){let[,e,t,...a]=s;a=a.join(" ");const l=a&&Players.getByName(Ls(a));if(a&&!l)UI.addChatMessage("Unknown player");else if("add"!=e&&"remove"!=e&&"transfer"!=e)UI.addChatMessage("Unknown subcommand");else{const s=config.skins.MAX_URL_LENGTH,a=config.skins.MAX_IMG_BYTES;(async()=>{if(t.length>s)return void UI.addChatMessage("Image url too long");const{dataURL:i,w:n,h:o,byteLength:r,hashHex:u}=await Pt.fetch_skin(t);i?256!==o||512!==n&&256!==n&&128!==n?UI.addChatMessage("Invalid image dimensions"):r>a[n]?UI.addChatMessage(`Image too big: ${r} > ${a[n]}`):Network.sendCommand("skin",JSON.stringify({cmd:e,url:t,hash:u,player_id:l&&l.id})):UI.addChatMessage("Invalid image")})()}}else"help"===a?UI.toggleHelp():"debug"!==a&&(UI.isEmote(a)?Network.sendSay(":"+a+":"):Network.sendCommand(a,e.substr(a.length+2)));return!0},UI.onChatlineClick=function(e){navigator.clipboard&&navigator.clipboard.writeText&&(navigator.clipboard.writeText(e.target.innerText),UI.serverMessage({type:1,text:"Copied to clipboard",duration:1e3}))},UI.addChatLine=function(e,t,s){if(!Kt[e.id]){if(jt++,0==s)var a='<div id="chat-'+jt+'" class="line"><span class="playersel" data-playerid="'+e.id+'"><span class="flag small flag-'+e.flag+'" title="'+Cs(e.flag)+'"></span><span class="nick">'+UI.escapeHTML(e.name)+'</span></span><span class="text">'+UI.escapeHTML(t,!0)+"</span></div>";else if(1==s||2==s){var l=1==s?"TO":"FROM";2==s&&(ds=Rs(Tools.mungeNonAscii(e.name,e.id))),a='<div id="chat-'+jt+'" class="line"><span class="tag whisper">'+l+'</span><span class="playersel" data-playerid="'+e.id+'"><span class="nick green">'+UI.escapeHTML(e.name)+'</span></span><span class="text green">'+UI.escapeHTML(t,!0)+"</span></div>"}else a='<div id="chat-'+jt+'" class="line"><span class="tag team">TEAM</span><span class="playersel" data-playerid="'+e.id+'"><span class="nick blue">'+UI.escapeHTML(e.name)+'</span></span><span class="text blue">'+UI.escapeHTML(t,!0)+"</span></div>";(a=$(a)).click(UI.onChatlineClick);var i="#chat-"+(jt-config.maxChatLines);if($(i).length&&$(i).remove(),$("#chatlines").append(a),Zt)qt++,$("#chatunreadlines").html(qt),1==qt&&UI.show("#chatunreadlines",!0);else{var n=$("#chatbox");1!=s&&2!=s&&e.id!=game.myID&&n.is(":hover")||n.scrollTop(n[0].scrollHeight)}}},UI.addChatMessage=function(e,t){var s='<div id="chat-'+ ++jt+'" class="line">'+(t?"":'<span class="nick">⚠</span>')+'<span class="text">'+e+"</span></div>",a="#chat-"+(jt-config.maxChatLines);$(a).length&&$(a).remove(),$("#chatlines").append(s);var l=$("#chatbox");l.scrollTop(l[0].scrollHeight)},UI.showChatLevel=function(e){var t=null;2==e?t="Type /flag XX where XX is the 2-letter ISO code of a country":3==e?t="Emotes available: /tf /pepe /clap /lol /bro /kappa /cry /rage":4==e&&(t="Flag Pack #1: communist confederate imperial rainbow jolly"),null!=t&&UI.addChatMessage(t,!0)},UI.updateGameInfo=function(){let e=Players.categoryCounts(),t="";t+='<div class="item">',e.bots>0&&(t+=`<span class="icon-container"><div class="icon bots"></div></span><span class="greyed">${e.bots}</span>`),t+=`<span class="icon-container padded"><div class="icon players"></div></span>${e.players}`,game.gameType===GameType.CTF?(t+='<span class="greyed">&nbsp;&nbsp;(',t+=`<span style="color: #4076E2">${e.blueTeam}</span>`,t+="&nbsp;/&nbsp;",t+=`<span style="color: #EA4242">${e.redTeam}</span>`,t+="&nbsp;/&nbsp;",t+=`${e.spectators}`,t+=")</span>"):game.gameType===GameType.FFA&&(t+='<span class="greyed">&nbsp;&nbsp;(',t+=`<span style="color: #FFEC52">${e.players-e.spectators}</span>`,t+="&nbsp;/&nbsp;",t+=`${e.spectators}`,t+=")</span>"),t+=`<span class="icon-container padded"><div class="icon ping"></div></span>${game.ping}<span class="millis">ms</span>`,t+="</div>",$("#gameinfo").html(t)},UI.updateStats=function(e){game.ping=e.ping,UI.updateGameInfo()},UI.sayLine=function(e){Players.say(e)},UI.escapeHTML=function(e,t){return e=(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;").replace(/`/g,"&#x60;"),t&&(e=e.replace(/\b(https?:|www\.|[\w.]+\.com)[^\s]*/gi,(function(e){var t=e;return 0!=t.toLowerCase().indexOf("http")&&(t="http://"+t),'<a target="_blank" href="'+t+'">'+e+"</a>"}))),e};var _s=function(){var e=window.innerWidth,t=window.innerHeight;e==game.screenX&&t==game.screenY||UI.scheduleGraphicsResize(250)};UI.controlKey=function(e,t,s){if(game.state!=Network.STATE.PLAYING)return!0;if(s)if(13!=e){if(27==e)return Vt&&UI.toggleChatBox(!1),void UI.closeAllPanels();if(191!=e)if(75!=e)switch(t){case"ALTZOOM":UI.toggleScaleAltMode();break;case"ZOOMIN":UI.scaleIncrease();break;case"ZOOMOUT":UI.scaleDecrease();break;case"DEFAULTZOOM":UI.scaleDefault();break;case"DROPUPGRADE":UI.dropUpgrade();break;case"DROPFLAG":UI.dropFlag();break;case"SHOWSCORE":UI.toggleScore();break;case"MAINMENU":UI.toggleMainMenu();break;case"SHOWGAMES":Games.toggleGames();break;case"FULLSCREEN":Graphics.toggleFullscreen(),Input.clearKeys();break;case"MINIMIZECHAT":UI.minimizeChat();break;case"MAXIMIZECHAT":UI.maximizeChat();break;case"SAY":UI.shortcutChat("/s ");break;case"TEAM":UI.shortcutChat("/t ");break;case"REPLY":null!=ds&&UI.shortcutChat("/w "+ds+" ");break;case"SPECTATE":Network.spectateForce();break;case"UPGRADE1":UI.selectUpgrade(1);break;case"UPGRADE2":UI.selectUpgrade(2);break;case"UPGRADE3":UI.selectUpgrade(3);break;case"UPGRADE4":UI.selectUpgrade(4);break;case"SOUND":Sound.toggle();break;case"HELP":UI.toggleHelp();break;case"INVITE":UI.toggleInvite();break;case"MOUSEMODE":Input.toggleMouse()}else Input.toggleKeybinds();else UI.shortcutChat("/")}else UI.toggleChatBox(!0)},UI.chatBoxOpen=function(){return Vt},UI.setupMinimap=function(){game.graphics.gui.minimap=Textures.init("minimap"),game.graphics.gui.minimap_box=Textures.init("minimapBox"),UI.resizeMinimap(),UI.visibilityMinimap(!1)},UI.visibilityMinimap=function(e){game.graphics.gui.minimap.visible=e,game.graphics.gui.minimap_box.visible=e},UI.resizeMinimap=function(){for(var e in game.graphics.gui.minimap.scale.set(config.minimapSize/512),game.graphics.gui.minimap.position.set(game.screenX-config.minimapPaddingX,game.screenY-config.minimapPaddingY),game.graphics.gui.minimap_box.scale.set(.03+2*config.minimapSize*(game.screenX/game.scale/32768)/64,.03+config.minimapSize*(game.screenY/game.scale/16384)/64),zt)Es(zt[e]);Games.update(!0)},UI.setupHUD=function(){game.graphics.gui.hudHealth_shadow=Textures.init("hudHealth_shadow"),game.graphics.gui.hudHealth=Textures.init("hudHealth"),game.graphics.gui.hudHealth_mask=Textures.init("hudHealth_mask"),game.graphics.gui.hudHealth_mask.blendMode=PIXI.BLEND_MODES.LUMINOSITY,game.graphics.gui.hudHealth.rotation=-1.5,game.graphics.gui.hudHealth.position.set(330,174),game.graphics.gui.hudHealth_mask.position.set(330,174),game.graphics.gui.hudEnergy_shadow=Textures.init("hudEnergy_shadow"),game.graphics.gui.hudEnergy=Textures.init("hudEnergy"),game.graphics.gui.hudEnergy_mask=Textures.init("hudEnergy_mask"),game.graphics.gui.hudEnergy_mask.blendMode=PIXI.BLEND_MODES.LUMINOSITY,game.graphics.gui.hudEnergy.position.set(-250,174),game.graphics.gui.hudEnergy_mask.position.set(-250,174),UI.resizeHUD(),UI.visibilityHUD(!1)},UI.visibilityHUD=function(e){game.graphics.gui.hudHealth_shadow.visible=e,game.graphics.gui.hudHealth.visible=e,game.graphics.gui.hudEnergy_shadow.visible=e,game.graphics.gui.hudEnergy.visible=e},UI.resizeHUD=function(){var e=.5*game.scale,t=game.halfScreenX-30*game.scale,s=game.halfScreenX+30*game.scale;game.graphics.gui.hudHealth_shadow.scale.set(e),game.graphics.gui.hudEnergy_shadow.scale.set(e),game.graphics.gui.hudHealth_shadow.position.set(t,game.halfScreenY),game.graphics.gui.hudEnergy_shadow.position.set(s,game.halfScreenY),game.graphics.gui.hudSpriteHealth.scale.set(e),game.graphics.gui.hudSpriteHealth.position.set(t,game.halfScreenY),game.graphics.gui.hudSpriteEnergy.scale.set(e),game.graphics.gui.hudSpriteEnergy.position.set(s,game.halfScreenY)},UI.selectAircraft=function(e){Network.sendCommand("respawn",e+"")},UI.aircraftSelected=function(e){e=parseInt(e);for(var t=1;t<=5;t++)t==e?$("#selectaircraft-"+t).addClass("sel"):$("#selectaircraft-"+t).removeClass("sel")},UI.killed=function(e){let t="";e.bot?t='<span class="level bot">bot</span>':e.level&&(t='<span class="level">'+e.level+"</span>"),(game.time-vs>1500||ws.length>=6)&&(ws=[]),vs=game.time,ws.push([e.flag,e.name,t]);for(var s="",a="",l=0;l<ws.length;l++)a=ws[l][1],1!=ws.length&&a.length>10&&(a=a.substr(0,10)+"..."),s+='<span class="player"><span class="flag big flag-'+ws[l][0]+'"></span>'+UI.escapeHTML(a)+ws[l][2]+"</span>";ys={type:"default",duration:3e3,msg:"You have destroyed"+s}},UI.killedBy=function(e){let t="";e.bot?t='<span class="level bot">bot</span>':e.level&&(t='<span class="level">'+e.level+"</span>"),ys={type:"destroyed",duration:3e3,msg:'Destroyed by<span class="playerbig"><span class="flag big flag-'+e.flag+'"></span>'+UI.escapeHTML(e.name)+t+"</span>"}},UI.errorHandler=function(e){switch(e.error){case 1:UI.showMessage("alert",'<span class="info">DISCONNECTED</span>Packet flooding detected<br><span class="button" onclick="Network.reconnect()">RECONNECT</span>',2e4),Network.receivedError(e.error);break;case 2:UI.showMessage("alert",`<span class="info">BANNED</span>You have been banned from this server (${UI.escapeHTML(game.server.id)}) for packet flooding`,2e4),Network.receivedError(e.error);break;case 3:UI.showMessage("alert",`<span class="info">BANNED</span>You have been banned from this server (${UI.escapeHTML(game.server.id)})`,2e4),Network.receivedError(e.error);break;case 4:Network.receivedError(e.error),Games.redirRoot();break;case 5:UI.showMessage("alert",'<span class="info">RESPAWN</span>Full health and 2 seconds of inactivity required',3e3);break;case 6:let t="AFK time exceeded the server limit";game.server.config&&game.server.config.afk&&(t=`AFK for more than ${UI.escapeHTML(game.server.config.afk)} minute${1!=game.server.config.afk?"s":""}`),UI.showMessage("alert",`<span class="info">DISCONNECTED</span>${t}<br><span class="button" onclick="Network.reconnect()">RECONNECT</span>`,72e5),Network.receivedError(e.error);break;case 7:UI.showMessage("alert",'<span class="info">DISCONNECTED</span>You have been kicked out',2e4),Network.receivedError(e.error);break;case 8:UI.showMessage("alert",'<span class="info">DISCONNECTED</span>Invalid login data',2e4),Network.receivedError(e.error);break;case 9:UI.showMessage("alert",'<span class="info">DISCONNECTED</span>Incorrect protocol level<br>Please clear your browser cache and refresh',2e4),Network.receivedError(e.error);break;case 10:UI.showMessage("alert",'<span class="info">BANNED</span>Account banned',2e4),Network.receivedError(e.error);break;case 11:UI.showMessage("alert",'<span class="info">DISCONNECTED</span>Account already logged in<br><span class="button" onclick="Network.reconnect()">RECONNECT</span>',2e4),Network.receivedError(e.error);break;case 12:UI.showMessage("alert",'<span class="info">RESPAWN</span>Cannot respawn or change aircraft in a Battle Royale game',3e3);break;case 13:UI.showMessage("alert",'<span class="info">SPECTATE</span>Full health and 2 seconds of inactivity required',3e3);break;case 20:UI.showMessage("information",'<span class="info">UPGRADE</span>Not enough upgrade points',3e3);break;case 30:UI.addChatMessage("Chat throttled to prevent spamming");break;case 31:UI.showMessage("alert",'<span class="info">THROTTLED</span>Flag change too fast');break;case 100:UI.addChatMessage("Unknown command")}},UI.showCommandReply=function(e){if(0==e.type)UI.addChatMessage(UI.escapeHTML(e.text,!0));else{var t=JSON.stringify(JSON.parse(e.text),null,"    "),s='<div class="close" onclick="$(this).parent().remove()"></div><div class="text"><pre>'+UI.escapeHTML(t,!0)+"</pre></div>";$("body").append('<div id="debugpopup" oncontextmenu="event.stopPropagation()">'+s+"</div>")}},UI.updateHUD=function(e,t,s){e=Tools.clamp(e,0,1),t=Tools.clamp(t,0,1),game.graphics.gui.hudHealth.rotation=-1.1*(1-e),game.graphics.gui.hudEnergy.rotation=Math.PI+1.1*(1-t),game.graphics.gui.hudHealth.tint=e>.5?Tools.colorLerp(13487404,2591785,2*(e-.5)):Tools.colorLerp(12201261,13487404,2*e);var a=3374821;s&&(a=t<config.ships[s.type].energyLight?2841755:3374821),game.graphics.gui.hudEnergy.tint=a},UI.minimizeChat=function(e){Zt||(Vt&&UI.toggleChatBox(),Zt=!0,qt=0,UI.hide("#chatbox"),UI.hide("#chatunreadlines"),UI.show("#maximizechat"),e&&e.stopPropagation())},UI.maximizeChat=function(){if(Zt){Zt=!1,UI.hide("#maximizechat"),UI.hide("#chatunreadlines"),UI.show("#chatbox");var e=$("#chatbox");e.scrollTop(e[0].scrollHeight)}},UI.closeScore=function(){Qt&&(UI.hidePanel("#scoredetailed"),Qt=!1,clearInterval(es))},UI.openScore=function(){Qt||(UI.closeAllPanels("score"),UI.showPanel("#scoredetailed"),Qt=!0,Network.getScores(),clearInterval(es),es=setInterval(Network.getScores,5e3))},UI.toggleScore=function(){Qt?UI.closeScore():UI.openScore()},UI.openLogin=function(){us||(UI.showPanel("#loginselector"),us=!0,Games.closeDropdowns())},UI.closeLogin=function(){us&&(UI.hidePanel("#loginselector"),us=!1)},UI.showPanel=function(e){var t=.9,s=1;config.phone&&(t*=.7,s*=.7),$(e).css({display:"block",opacity:"0",transform:"scale("+t+")","pointer-events":"auto"}),$(e).width(),$(e).css({opacity:"1",transform:"scale("+s+")",transition:"all 0.75s cubic-bezier(0.23, 1, 0.32, 1)"}),"#custom-msg"!=e&&Sound.UIClick()},UI.hidePanel=function(e,t,s,a){if("#custom-msg"!=e||$("#custom-msg").length){var l=.9;config.phone&&(l*=.7),a?$(e).css({transition:"all 1.5s cubic-bezier(0.23, 1, 0.32, 1)"}):$(e).css({transition:"all 0.75s cubic-bezier(0.23, 1, 0.32, 1)"}),$(e).css({opacity:"0",transform:"scale("+l+")","pointer-events":"none"}),a||Sound.UIClick(),setTimeout((function(e){let a={"#mainmenu":ls,"#scoredetailed":Qt,"#howtoplay":as,"#invitefriends":rs,"#loginselector":us}[e];if(void 0===a&&(a=t),!a){if(s)return void $(e).remove();$(e).css({display:"none",transform:"none",transition:"none"})}}),a?1600:800,e)}},UI.openInvite=function(){rs||(UI.closeAllPanels("invite"),game.inviteLink=document.URL+"#"+game.server.id,$("#invite-link").html(game.inviteLink),$("#invite-link").attr("href",game.inviteLink),UI.showPanel("#invitefriends"),rs=!0)},UI.closeInvite=function(){rs&&(UI.hidePanel("#invitefriends"),rs=!1)},UI.toggleInvite=function(){rs?UI.closeInvite():UI.openInvite()},UI.closeMainMenu=function(){ls&&(UI.hidePanel("#mainmenu"),ls=!1)},UI.updateMainMenuSettings=function(){config.settings.hidpi?$("#mainmenu-hidpi-tick").addClass("ticked"):$("#mainmenu-hidpi-tick").removeClass("ticked")},UI.openMainMenu=function(){ls||(UI.closeAllPanels("mainmenu"),UI.updateMainMenuSettings(),UI.showPanel("#mainmenu"),ls=!0)},UI.toggleMainMenu=function(){ls?UI.closeMainMenu():UI.openMainMenu()},UI.closeAllPanels=function(e){"mainmenu"!==e&&UI.closeMainMenu(),"score"!==e&&UI.closeScore(),"help"!==e&&UI.hideHelp(),"games"!==e&&Games.closeGames(),"invite"!==e&&UI.closeInvite(),"login"!==e&&UI.closeLogin(),"keybinds"!==e&&Input.closeKeybinds(),$("#custom-msg").length&&UI.hidePanel("#custom-msg",!1,!0)};var Ps=function(e){return(e=Math.round(e))<1e3?e:e<1e5?(e/1e3).toFixed(1)+" K":e<1e6?Math.round(e/1e3)+" K":(e/1e6).toFixed(1)+" M"},Us=[["name","&nbsp;"],["kills","Kills"],["deaths","Deaths"],["damage","Damage"],["bounty","Bounty"],["rank","Level"],["ping","Ping"]],xs=[["name","&nbsp;"],["wins","&nbsp;"],["kills","Kills"],["deaths","Deaths"],["bounty","Bounty"],["rank","Level"],["ping","Ping"]],As=[["name","&nbsp;"],["captures","&nbsp;"],["kills","Kills"],["deaths","Deaths"],["bounty","Bounty"],["rank","Level"],["ping","Ping"]],Cs=function(e){var t=FlagCodeById[e];if(!t)return"";var s=CountryNames[t];return s?s+" ("+t+")":t};UI.updateScore=function(e){if(Qt){var t,s=["gold","silver","bronze"],a=e.scores;a.sort((function(e,t){return t.score-e.score})),t=e.c==Network.SERVERPACKET.SCORE_DETAILED_BTR?xs:e.c==Network.SERVERPACKET.SCORE_DETAILED_CTF?As:Us;for(var l="",i=0;i<t.length;i++)l+='<div class="'+t[i][0]+'">'+t[i][1]+"</div>";for(var n="",o=-1,r=-1,u=0;u<a.length;u++){var c=Players.get(a[u].id);if(!c)continue;var p=u<=2?'&nbsp;<div class="badge detail '+s[u]+'"></div>':u+1+".",d=c.me()?" sel":"";let t="";e.c==Network.SERVERPACKET.SCORE_DETAILED_CTF&&(t+=` team-${c.team}`);let l="";e.c==Network.SERVERPACKET.SCORE_DETAILED_BTR?a[u].alive||(t+=" spectating",l+=" spectating"):c.isSpectating()&&!c.bot&&(t+=" spectating",l+=" spectating"),n+='<div class="item '+d+'"><div class="name"><div class="position">'+p+'</div><div class="flag small flag-'+c.flag+'" title="'+Cs(c.flag)+'"></div><div class="player'+t+'">'+UI.escapeHTML(c.name)+"</div>"+(c.bot?'<div class="bot">bot</div>':"")+"</div>",e.c==Network.SERVERPACKET.SCORE_DETAILED_BTR&&(0==a[u].wins?n+='<div class="wins">&nbsp;</div>':n+='<div class="wins '+l+'">'+a[u].wins+'<div class="wins-container">&nbsp;<div class="wins-icon '+l+'"></div></div></div>'),e.c==Network.SERVERPACKET.SCORE_DETAILED_CTF&&(0==a[u].captures?n+='<div class="captures">&nbsp;</div>':n+='<div class="captures '+l+'">'+a[u].captures+'<div class="captures-container">&nbsp;<div class="captures-icon '+l+'"></div></div></div>'),n+='<div class="kills '+l+'">'+a[u].kills+'</div><div class="deaths '+l+'">'+a[u].deaths+"</div>",e.c==Network.SERVERPACKET.SCORE_DETAILED&&(n+='<div class="damage '+l+'">'+Ps(a[u].damage)+"</div>"),n+='<div class="bounty '+l+'">'+a[u].score+'</div><div class="rank '+l+'">'+(0==a[u].level?"&nbsp;":a[u].level)+'</div><div class="ping '+l+'">'+a[u].ping+'<span class="ms">ms</span></div></div>',e.c==Network.SERVERPACKET.SCORE_DETAILED?a[u].damage>o&&(o=a[u].damage,r=c):e.c==Network.SERVERPACKET.SCORE_DETAILED_CTF?a[u].captures>o&&(o=a[u].captures,r=c):a[u].kills>o&&(o=a[u].kills,r=c)}var h="";a.length>1&&(h="&bull;&nbsp;&nbsp;"+a.length+" players");var g="";if(o>0){if(e.c==Network.SERVERPACKET.SCORE_DETAILED)var m=Ps(o),f=" damage";else m=o+"",f=e.c==Network.SERVERPACKET.SCORE_DETAILED_CTF?" capture":" kill",o>1&&(f+="s");g=`\n            <div class="mvpbadge">MVP</div>\n            <div class="flag flag-${r.flag}"></div>\n            <div class="name">${UI.escapeHTML(r.name)}</div>\n            <div class="damage">&nbsp;&nbsp;&bull;&nbsp;&nbsp;${m}${f}</div>\n        `}$("#scoreplayers").html(h),$("#scoretable").html(l),$("#scorecontainer").html(n),$("#scoremvp").html(g)}},UI.popMenu=function(e,t){if(game.state==Network.STATE.LOGIN)return Games.closeDropdowns(),void UI.closeLogin();game.state!=Network.STATE.PLAYING||t||UI.closeAllPanels();var s=$(e.target).parent().data("playerid");if(null==s&&(s=$(e.target).data("playerid")),null!=s&&s!=game.myID){var a=Players.get(s);if(null==a)return!0;var l={left:"20px",top:$(e.target).parent()[0].getBoundingClientRect().top-166+"px"};ts||(l.display="block",ts=!0);var i=null==Kt[a.id]?"Ignore":"Unignore",n='<div class="header">'+UI.escapeHTML(a.name)+'</div><div class="item" onclick="UI.contextWhisper()">Whisper</div><div class="item" onclick="UI.context'+i+'()">'+i+'</div><div class="item" onclick="UI.contextVotemute()">Vote mute</div><div class="arrow"></div>';return $("#contextmenu").html(n),$("#contextmenu").css(l),ss=a.id,e.stopPropagation(),!1}UI.closeMenu()};var Rs=function(e){return(e+"").replace(/&/g,"&a;").replace(/ /g,"&s;")},Ls=function(e){return(e+"").replace(/&s;/g," ").replace(/&a;/g,"&")};UI.chatWhisper=function(e,t){e=Ls(e);var s=Players.getByName(e);null!=s?Network.sendWhisper(s.id,t):UI.addChatMessage("Unknown player")},UI.chatIgnore=function(e){var t=Players.get(e);null!=t&&e!=game.myID&&null==Kt[t.id]&&(Kt[t.id]=!0,UI.addChatMessage("Ignoring player "+UI.escapeHTML(t.name)+"&nbsp;&nbsp;&bull;&nbsp;&nbsp;To unignore type /unignore "+UI.escapeHTML(Rs(t.name)),!0))},UI.chatUnignore=function(e){Kt[e.id]&&(delete Kt[e.id],UI.addChatMessage("Removed player "+UI.escapeHTML(e.name)+" from ignore list",!0))},UI.chatVotemute=function(e){if(e.id!=game.myID){Network.voteMute(e.id);var t=Math.floor(Math.sqrt(Players.count()[1]))+1;UI.addChatMessage("Voted to mute "+UI.escapeHTML(e.name)+"&nbsp;&nbsp;&bull;&nbsp;&nbsp;"+t+" total votes are required",!0)}},UI.chatVotemutePass=function(e){UI.addChatMessage("The vote to mute "+UI.escapeHTML(e.name)+" has passed",!0)},UI.chatMuted=function(){UI.addChatMessage("You have been muted")},UI.contextWhisper=function(){if(null!=ss){var e=Players.get(ss);null!=e&&ss!=game.myID&&UI.shortcutChat("/w "+Rs(e.name)+" ")}},UI.contextIgnore=function(){null!=ss&&ss!=game.myID&&UI.chatIgnore(ss)},UI.contextUnignore=function(){if(null!=ss){var e=Players.get(ss);null!=e&&ss!=game.myID&&UI.chatUnignore(e)}},UI.contextVotemute=function(){if(null!=ss){var e=Players.get(ss);null!=e&&ss!=game.myID&&UI.chatVotemute(e)}},UI.closeMenu=function(){ts&&(UI.hide("#contextmenu"),ts=!1)},UI.nameEntered=function(){var e=$("#playername").val().trim();e.length>0?(game.myOriginalName=e,Games.start(e,!0)):Games.highlightInput("#playername")},UI.dropUpgrade=function(e){Network.sendCommand("upgrades","drop")},UI.dropFlag=function(e){Network.sendCommand("drop","")},UI.selectUpgrade=function(e){Network.sendCommand("upgrade",e+"")};var Ns=function(){let e=["","speed","defense","energy","missile"];for(let t=1;t<5;t++)bs[e[t]]<5&&fs.upgrades>0?$("#selectupgrade-"+t).addClass("lighted"):$("#selectupgrade-"+t).removeClass("lighted")};UI.updateUpgrades=function(e,t,s){for(var a,l=["","speed","defense","energy","missile"],i=1;i<5;i++)a=i-1,null!=bs[l[i]]&&bs[l[i]]==e[a]||(bs[l[i]]=e[a],$("#selectupgrade-"+i+"-level").html(e[a]),is&&os-100==i&&UI.popTooltip(null,100+i));if(null!=s){if(0!=s){var n="+"+Math.round(100*(config.upgrades[l[s]].factor[bs[l[s]]]-1))+"% "+["","Speed","Defense","Energy Regen","Missile Speed"][s];UI.showMessage("information",'<span class="info">UPGRADE</span>'+n,3e3),Sound.playerUpgrade()}fs.upgrades=t,$("#score-upgrades").html(t)}Ns()},UI.resetUpgrades=function(){UI.updateUpgrades([0,0,0,0])},UI.popBigMsg=function(e){if(1==e)var t='<div id="big-message" onclick="UI.closeBigMsg()"><div class="msg">Mobile mode</div><div class="small">Mobile mode has touch controls and requires latest phone/tablet hardware.</div><div class="small nopadtop">For the full experience please play on a PC with a physical keyboard.</div><div class="greyed">Tap anywhere to close</div></div>';else t='<div id="big-message"><div class="msg">WebGL required</div><div class="small">This game requires a WebGL enabled browser in order to run.<br>Please allow WebGL for this domain to continue.</div>';$("body").append(t)},UI.closeBigMsg=function(){$("#big-message").remove()},UI.showHelp=function(e){as||(UI.closeAllPanels("help"),!0===e?$("#howtoplay").addClass("hide"):$("#howtoplay").removeClass("hide"),UI.showPanel("#howtoplay"),as=!0)},UI.hideHelp=function(){as&&(UI.hidePanel("#howtoplay"),as=!1)},UI.toggleHelp=function(){as?UI.hideHelp():UI.showHelp()},UI.updateSound=function(e){config.settings.sound?($("#settings-sound").addClass("soundon"),$("#settings-sound").removeClass("soundoff"),$("#mainmenu-sound-icon").addClass("soundon"),$("#mainmenu-sound-icon").removeClass("soundoff"),$("#mainmenu-sound-text").html("Disable Sound")):($("#settings-sound").addClass("soundoff"),$("#settings-sound").removeClass("soundon"),$("#mainmenu-sound-icon").addClass("soundoff"),$("#mainmenu-sound-icon").removeClass("soundon"),$("#mainmenu-sound-text").html("Enable Sound")),e&&UI.showMessage("alert",'<span class="info">SOUND</span>'+(config.settings.sound?"Enabled":"Disabled"),3e3)},UI.gameStart=function(e,t){t&&($("#login-ui").remove(),UI.show("#logosmall"),UI.show("#menu",!0),config.mobile||UI.show("#chatbox"),UI.show("#roomnamecontainer"),UI.show("#scoreboard"),UI.show("#scorebig"),UI.show("#settings"),UI.show("#sidebar"),UI.showScaleSlider(),config.mobile&&Gs(),config.settings.helpshown||(UI.showHelp(!0),config.settings.helpshown=!0,Tools.setSettings({helpshown:!0}))),UI.hide("#gamespecific"),$("#gameinfo").html("&nbsp;"),$("#gameinfo").addClass("ingame"),bs={},UI.resetUpgrades(),UI.hideSpectator(),UI.resetPowerups(),$("#open-menu").html("Connecting..."),game.myName=e,Network.setup()};var Gs=function(){Os(),Graphics.toggleFullscreen(),Input.setupTouch()},Os=function(){$("#howtoplay").addClass("mobile"),$("#howtoplay").html('<div class="header">HOW TO PLAY</div><div class="mobile-graphic"></div><div class="commands">For the best game experience play on a PC</div>')};UI.reconnection=function(){jt=0,fs={score:-1,upgrades:-1,earnings:-1,kills:-1,deaths:-1},ys=!1,bs={},Kt={},UI.resetUpgrades(),UI.resetPowerups(),UI.hideSpectator(),UI.wipeAllMinimapMobs(),UI.wipeAllMessages(),Games.wipe(),$("#gameinfo").html("&nbsp;"),$("#scoreboard").html(""),$("#chatlines").html(""),$("#score-score").html("&nbsp;"),$("#score-upgrades").html("&nbsp;"),$("#score-rank").html("-"),$("#roomname").html("&nbsp;"),$("#open-menu").html("Switching Game...")},UI.loggedIn=function(e){$("#roomname").html(game.roomName),$("#scoreheader").html(game.roomName+"&nbsp;&nbsp;"),$("#open-menu").html('<span class="arrowdown"></span>'+game.roomNameShort+'&nbsp;&nbsp;<span class="region">&bull;&nbsp;&nbsp;'+game.regionName+"</span>"),UI.visibilityHUD(!0),UI.visibilityMinimap(!0),UI.updateHUD(1,1)},UI.popTooltip=function(e,t){if(null==t)var s=e.data.t,a=e.currentTarget.getBoundingClientRect();else s=t;var l="";if(s<100){var i=Ts[s],n=["","Agility","Defense","Regen","Damage"];l+='<div class="header">'+i[0]+"</div>";for(var o=1;o<=4;o++)l+='<div class="item"><div class="name">'+n[o]+'</div><div class="val">&nbsp;<div class="bar"><div class="progress" style="width: '+i[o]+'%"></div></div></div></div>';l+='<div class="item"><div class="special">'+i[5]+'</div><div class="desc">'+i[6]+"</div></div>",l+='<div class="item"><div class="clickto">Click to respawn</div></div>'}else{var r=["","speed","defense","energy","missile"],u=s-100,c=bs[r[u]],p="+"+Math.round(100*(config.upgrades[r[u]].factor[bs[r[u]]]-1))+"%";l+='<div class="header">'+Ts[s][0]+"</div>",l+='<div class="item"><div class="level">'+c+" / "+(config.upgrades[r[u]].factor.length-1)+"</div>",c>0&&(l+='<div class="percent">'+p+"</div></div>"),c<config.upgrades[r[u]].factor.length-1?(l+='<div class="item smaller"><div class="requires">Requires 1 upgrade point</div></div>',l+='<div class="item smaller"><div class="clickto">Click to upgrade to '+(p="+"+Math.round(100*(config.upgrades[r[u]].factor[bs[r[u]]+1]-1))+"%")+"</div></div>"):l+='<div class="item smaller"><div class="clickto">Max upgrade reached</div></div>'}l+='<div class="arrow"></div>',null==t&&$("#tooltip").css({left:Math.round(a.left+60)+"px",top:Math.round(a.top-10)+"px"}),$("#tooltip").html(l),os=s,null!=ns&&clearTimeout(ns),is||(is=!0,UI.show("#tooltip"))},UI.closeTooltip=function(){is&&(null!=ns&&clearTimeout(ns),ns=setTimeout((function(){is&&(UI.hide("#tooltip"),$("#tooltip").html(""),is=!1,ns=null)}),250))},UI.startDragChat=function(e){hs.x=e.originalEvent.pageX,hs.y=e.originalEvent.pageY,hs.width=$("#chatbox").width()+16,hs.height=$("#chatbox").height()+16,$("#chatbox").addClass("hovered"),$(window).on("mousemove",UI.dragChat),$(window).on("mouseup",UI.endDragChat)},UI.dragChat=function(e){var t=e.originalEvent.pageX,s=e.originalEvent.pageY;if(0!=t&&0!=s){game.screenY-s<100&&(s=game.screenY-100);var a=t-hs.x,l=s-hs.y;$("#chatbox").css({width:hs.width+a+"px",height:hs.height-l+"px"}),$("#minimizechatcontainer").css({width:hs.width+a+"px",bottom:hs.height-l+"px"}),$("#chatinput").css({width:hs.width+a-12+"px",bottom:hs.height-l+20+"px"})}},UI.endDragChat=function(e){$("#chatbox").removeClass("hovered"),$(window).off("mousemove",UI.dragChat),$(window).off("mouseup",UI.endDragChat)},UI.setup=function(){var e;for($(window).resize(_s),$(window).on("orientationchange",_s),$(window).on("contextmenu",(function(e){return UI.popMenu(e,!0),e.preventDefault(),!1})),$(window).on("focus",Input.gameFocus),$(window).on("blur",Input.gameBlur),$(window).on("click",UI.popMenu),$("#minimizechat").on("click",UI.minimizeChat),$("#maximizechat").on("click",UI.maximizeChat),$("#viewscore").on("click",(function(e){game.state==Network.STATE.PLAYING&&(UI.openScore(),e.stopPropagation())})),$("#selectaircraft-1").on("click",(function(){UI.selectAircraft(1)})),$("#selectaircraft-2").on("click",(function(){UI.selectAircraft(2)})),$("#selectaircraft-3").on("click",(function(){UI.selectAircraft(3)})),$("#selectaircraft-4").on("click",(function(){UI.selectAircraft(4)})),$("#selectaircraft-5").on("click",(function(){UI.selectAircraft(5)})),$("#mainmenu-fullscreen").on("click",Graphics.toggleFullscreen),$("#mainmenu-invite").on("click",UI.openInvite),$("#mainmenu-score").on("click",UI.openScore),$("#mainmenu-game").on("click",Games.popGames),$("#mainmenu-hidpi").on("click",Graphics.toggleHiDPI),$("#mainmenu-sound").on("click",Sound.toggle),config.mobile?($("#mainmenu-keybinds-text").html("<br>How To Play"),$("#mainmenu-keybinds").on("click",UI.toggleHelp),$(".keybind").css({display:"none"})):$("#mainmenu-keybinds").on("click",Input.openKeybinds),$("#settings-mainmenu").on("click",(function(e){UI.toggleMainMenu(),e.stopPropagation()})),$("#settings-sound").on("click",(function(e){Sound.toggle(),e.stopPropagation()})),$("#mainmenu").on("click",(function(e){e.stopPropagation()})),$("#scoredetailed").on("click",(function(e){e.stopPropagation()})),$("#invitefriends").on("click",(function(e){e.stopPropagation()})),$("#keybinds").on("click",(function(e){e.stopPropagation()})),$("#invite-link").on("contextmenu",(function(e){e.stopPropagation()})),$("#resetbinds").on("click",Input.resetBinds),config.mobile||($("#chatinput").on("blur",(function(){Vt&&UI.toggleChatBox(!1)})),$("#resizechat").on("mousedown",UI.startDragChat)),$("#selectupgrade-1").on("click",(function(){UI.selectUpgrade(1)})),$("#selectupgrade-2").on("click",(function(){UI.selectUpgrade(2)})),$("#selectupgrade-3").on("click",(function(){UI.selectUpgrade(3)})),$("#selectupgrade-4").on("click",(function(){UI.selectUpgrade(4)})),e=1;e<=5;e++)$("#selectaircraft-"+e).on("mouseenter",{t:e},UI.popTooltip),$("#selectaircraft-"+e).on("mouseleave",UI.closeTooltip);for(e=1;e<=4;e++)$("#selectupgrade-"+e).on("mouseenter",{t:100+e},UI.popTooltip),$("#selectupgrade-"+e).on("mouseleave",UI.closeTooltip);$("#playbutton").on("click",(function(){Sound.UIClick(),UI.nameEntered()})),$("#playername").on("keypress",(function(e){13===e.which&&UI.nameEntered()})),window.onerror=function(e,t,s,a,l){game.state!==Network.STATE.PLAYING&&game.state!==Network.STATE.CONNECTING||Tools.handleError({msg:e,url:t,lineNo:s,columnNo:a,error:l})},UI.createScaleSlider(),UI.hideScaleSlider()};var Ds=null,Fs=null,$s=null,Hs=null,Ys=!1,Bs=-1;UI.createScaleSlider=function(){(Ds=document.createElement("div")).style.position="absolute",Ds.style.width="250px",Ds.style.background="white",Ds.style.borderRadius="5px",Ds.style.top="21px",Ds.style.left="320px",Ds.style.zIndex=110,Ds.style.height="10px",Ds.style.opacity=.07,(Fs=document.createElement("div")).style.position="absolute",Fs.style.width="22px",Fs.style.background="white",Fs.style.borderRadius="5px",Fs.style.top="21px",Fs.style.left="350px",Fs.style.zIndex=110,Fs.style.height="10px",Fs.style.opacity=.08,($s=document.createElement("div")).style.position="absolute",$s.style.width="24px",$s.style.height="24px",$s.style.top="14px",$s.style.left="580px",$s.style.zIndex=110,$s.style.borderRadius="5px";var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width",24),e.setAttribute("height",24),e.setAttribute("viewBox","0 0 24 24"),(Hs=document.createElementNS("http://www.w3.org/2000/svg","path")).setAttribute("d","M15 3l2.3 2.3-2.89 2.87 1.42 1.42L18.7 6.7 21 9V3zM3 9l2.3-2.3 2.87 2.89 1.42-1.42L6.7 5.3 9 3H3zm6 12l-2.3-2.3 2.89-2.87-1.42-1.42L5.3 17.3 3 15v6zm12-6l-2.3 2.3-2.87-2.89-1.42 1.42 2.89 2.87L15 21h6z"),Hs.setAttribute("stroke","white"),Hs.setAttribute("fill","white"),e.appendChild(Hs),$s.appendChild(e),document.body.appendChild(Ds),document.body.appendChild(Fs),document.body.appendChild($s),Fs.addEventListener("mousedown",UI.onScaleKnobMouseDown),$s.addEventListener("click",UI.onScaleAltClick),document.addEventListener("mousemove",UI.onScaleKnobMouseMove),document.addEventListener("mouseup",UI.onScaleKnobMouseUp),UI.updateScalingWidgetState()},UI.toggleScaleAltMode=function(){Tools.setSettings({scalingAltMode:!config.settings.scalingAltMode}),UI.updateScalingWidgetState(),UI.scheduleGraphicsResize(0)},UI.scaleIncrease=function(){UI.setScalingFactor(UI.getScalingFactor()+200),UI.updateScalingWidgetState()},UI.scaleDecrease=function(){UI.setScalingFactor(UI.getScalingFactor()-200),UI.updateScalingWidgetState()},UI.onScaleAltClick=function(e){UI.toggleScaleAltMode()},UI.scaleDefault=function(){UI.setScalingFactor(2500),UI.updateScalingWidgetState()},UI.hideScaleSlider=function(){Ds.style.display="none",Fs.style.display="none",$s.style.display="none"},UI.showScaleSlider=function(){Ds.style.display="block",Fs.style.display="block",$s.style.display="block"},UI.onScaleKnobMouseDown=function(e){console.log("drag start",e),Ys=!0,Bs=e.clientX-e.target.getBoundingClientRect().left},UI.getScalingFactor=function(){return config.settings.scalingAltMode?UI.capScalingFactor(config.settings.altScalingFactor||config.altScalingFactor):UI.capScalingFactor(config.settings.scalingFactor||config.scalingFactor)},UI.capScalingFactor=function(e){return Math.min(7e3,Math.max(800,e))},UI.scheduleGraphicsResize=function(e){clearTimeout(Wt),Wt=setTimeout((function(){Graphics.resizeRenderer(window.innerWidth,window.innerHeight)}),e||0)},UI.setScalingFactor=function(e){config.settings.scalingAltMode?Tools.setSettings({altScalingFactor:e}):Tools.setSettings({scalingFactor:e}),UI.scheduleGraphicsResize(100)},UI.onScaleKnobMouseMove=function(e){if(Ys){console.log("drag",e);var t=parseInt(Ds.style.left,10),s=t+(parseInt(Ds.style.width,10)-parseInt(Fs.style.width,10)),a=Math.max(t,Math.min(s,e.clientX-Bs));Fs.style.left=a+"px",UI.setScalingFactor(800+(a-t)/(s-t)*6200)}},UI.updateScalingWidgetState=function(){config.settings.scalingAltMode?$s.style.opacity=.15:$s.style.opacity=.08;var e=parseInt(Ds.style.left,10),t=e+(e+(parseInt(Ds.style.width,10)-parseInt(Fs.style.width,10))-e)/6200*(UI.getScalingFactor()-800);Fs.style.left=t+"px"},UI.onScaleKnobMouseUp=function(e){Ys&&(console.log("drag end",e),Ys=!1)}})()})();